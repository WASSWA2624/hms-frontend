---
alwaysApply: true
---

# Services & External Integrations Standards
## Purpose
Define how external systems and irreversible side effects are integrated.
Services are infrastructure, not business logic.

## What Is a Service?
A service module talks to external systems:
- Network APIs
- Device storage
- Third-party SDKs
- Other irreversible side effects

## Folder Ownership
```txt
src/services/
  index.js
  api/
    client.js
    endpoints.js
    interceptors.js
    index.js
  storage/
    async.js
    secure.js
    index.js
  analytics/
    tracker.js
    index.js
  [third-party-service]/
    client.js
    index.js
```

## Responsibilities
A service may:
- Perform network/storage/SDK calls
- Handle auth headers and retries
- Throw technical errors
- Emit technical logs through the centralized logger

A service must not:
- Contain business rules
- Import UI modules
- Dispatch Redux actions
- Perform navigation
- Own domain-model decisions

## API Services
### `client.js`
- Central fetch wrapper
- Timeout handling
- Header injection
- Technical error normalization

### `endpoints.js`
- Central endpoint registry
- Environment-aware values from config

### `interceptors.js`
- Attach credentials/tokens
- Handle 401/refresh integration
- Emit sanitized operational logs via `src/logging/`

Rules:
- No navigation logic
- No UI feedback
- No ad-hoc `console.*` logging

## Storage Services
- `async.js`: non-sensitive cached data
- `secure.js`: credentials/tokens
- Never mix secure and non-secure concerns
- Encryption primitives belong to `src/security/`

## Analytics Services
- Track events/screens/errors
- Fire-and-forget
- Must not block UI
- No business rule branching

## Dependency Rules
Allowed:
```txt
services -> utils
services -> config
services -> security
services -> logging
```

Forbidden:
```txt
services -> features
services -> platform
services -> store
services -> app
```

## Offline Compatibility
- Services must be stateless.
- Offline orchestration belongs to `offline/`, workers, and features.

## Forbidden Patterns
- Direct API calls in UI
- Redux logic in services
- Business logic in interceptors
- Feature-specific logic in shared clients
- Direct SDK calls outside service wrappers

## Related
- `features-domain.mdc`
- `state-management.mdc`
- `offline-sync.mdc`
- `errors-logging.mdc`
