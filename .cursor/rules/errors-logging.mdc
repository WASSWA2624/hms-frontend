---
alwaysApply: true
---

# Error Handling & Logging Standards
## Purpose
Define how errors are detected, normalized, stored, displayed, and logged.
Errors are signals, not UI.

## Error Ownership Model
| Layer | Responsibility |
| --- | --- |
| UI | Display safe fallback and recovery actions |
| Hooks | Expose semantic error states and retry APIs |
| Store | Store error codes only |
| Services | Detect technical failures |
| Errors Layer | Normalize and route errors |
| Logging | Record structured operational events |

## Folder Structure
```txt
src/errors/
  index.js
  ErrorBoundary.jsx
  error.handler.js
  fallback.ui.jsx
src/logging/
  index.js
  logger.js
  levels.js
```

## Error Boundary Rules
- A single global `ErrorBoundary` wraps the app.
- It is mounted only in `src/app/_layout.jsx`.
- It catches render/runtime errors, shows fallback UI, and reports fatal errors.

## Error Normalization
All errors must pass through a single normalization layer (`error.handler.js`).
Rules:
- UI never receives raw errors.
- Store keeps error codes only.
- Services never format user-facing messages.

## Service Error Rules
Services:
- Detect technical failures.
- Throw normalized technical errors/codes.
- Must not swallow errors silently.
- May emit technical logs only via `src/logging/` (no `console.*`, no UI messages).

## Hook Error Rules
Hooks:
- Catch service/store errors.
- Expose semantic error state + retry APIs.
- Must not show toasts/alerts directly.

## Redux Error Rules
- Store error codes only.
- No raw error objects.
- Clear errors explicitly.

## Logging Standards
Allowed:
- Errors
- Performance metrics
- State transitions
- Critical lifecycle events

Forbidden:
- Tokens
- PII
- Raw request bodies with sensitive data
- Secrets

## Logging Placement
Logging is allowed in:
- `errors/` handlers
- Store middleware
- Workers
- Bootstrap
- Service boundaries (API client/interceptors and SDK wrappers) through `src/logging/`

Logging is forbidden in:
- UI render code
- Pure utilities
- Ad-hoc `console.*` calls in production code

## Monitoring
External monitoring integrations must go through `src/logging/` with environment-aware configuration.

## Offline Error Handling
- Offline errors must be distinguishable from online failures.
- Sync failures must be recoverable.
- Network loss must not crash the app.

## Forbidden Patterns
- Raw errors leaking to UI
- Logging inside render functions
- Multiple competing error normalization pipelines
