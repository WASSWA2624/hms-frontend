Steps to review and implement (Phase 003: State Management and Theme System):
- **3.1** Create Color Tokens
- **3.2** Create Spacing Tokens
- **3.3** Create Typography Tokens
- **3.4** Create Border Radius Tokens
- **3.5** Create Shadow Tokens
- **3.6** Create Light Theme
- **3.7** Create Dark Theme
- **3.8** Create Responsive Breakpoints
- **3.9** Create Animation Tokens
- **3.10** Create Theme Provider
- **3.11** Create Redux Store

Review and implement all missing and non-compliant aspects of the selected Phase 003 step(s) per:
- `hms-frontend/dev-plan/P003_state-theme.md`

You must ensure 100% compliance with:
- All rules in `hms-frontend/.cursor/rules/*`
- `hms-frontend/write-up.md`
- If selected state wiring touches API/session bootstrap behavior, keep contracts consistent with mounted backend routes and auth/session semantics.
- Actual repository architecture and conventions already in `hms-frontend/src/**`

Only implement what is required for the selected Phase 003 step(s).

## Mobile UI Parity and Compact UX Contract (Mandatory)

For any selected step that touches UI (components, screens, layouts, route presentation, copy, interactions, or styling):
- Android and iOS must match mobile web UI for layout, spacing density, typography scale, component sizing, and interaction patterns.
- Use shared-first implementations by default. Only create .android or .ios overrides when required by hard platform constraints or accessibility requirements.
- When overrides are required, keep visual and interaction parity with mobile web.
- Prioritize simplicity and space economy: compact layouts, short labels, short helper text, and minimal non-essential copy.
- Add inline/in-app guidance for critical user actions using concise contextual hints and progressive disclosure.
- Avoid long instructional paragraphs in screens; guidance must be brief, actionable, and local to the current step.
- Keep full compliance with i18n, accessibility, and theme-token rules while applying this parity and compactness contract.

---

## Role-Based Visibility and Access Enforcement Contract (Mandatory)

For any selected step that touches auth, routing, navigation, data access, or UI:
- Users must never see or execute anything outside their role and permission scope.
- Enforce access at multiple layers: menu item visibility, route/screen guards, section-level rendering, component-level rendering, and action/function-level handlers.
- Hide unauthorized menu items, tabs, widgets, buttons, fields, cards, and screen sections by default; do not expose privileged controls unless explicitly required by approved requirements.
- Block unauthorized function/action execution even when UI is bypassed (direct URL entry, deep links, state tampering, manual event triggering).
- Use a single source of truth for access checks across web, Android, and iOS to prevent behavior drift.
- Provide deterministic denied-access UX (safe redirect, read-only fallback, or localized permission message) without leaking sensitive details.
- Add/update tests that verify all protected layers: menu visibility, route guards, screen/section/component rendering, and denied function/action paths.
---

## Rule Loading Contract (Mandatory)

Before coding, read and apply:
- `hms-frontend/.cursor/rules/index.mdc` (entry point)
- `hms-frontend/.cursor/rules/core-principles.mdc`
- `hms-frontend/.cursor/rules/tech-stack.mdc`
- `hms-frontend/.cursor/rules/dependency-policy.mdc`
- `hms-frontend/.cursor/rules/project-structure.mdc`
- `hms-frontend/.cursor/rules/app-router.mdc`
- `hms-frontend/.cursor/rules/platform-ui.mdc`
- `hms-frontend/.cursor/rules/component-structure.mdc`
- `hms-frontend/.cursor/rules/theme-design.mdc`
- `hms-frontend/.cursor/rules/state-management.mdc`
- `hms-frontend/.cursor/rules/features-domain.mdc`
- `hms-frontend/.cursor/rules/services-integration.mdc`
- `hms-frontend/.cursor/rules/hooks-utils.mdc`
- `hms-frontend/.cursor/rules/offline-sync.mdc`
- `hms-frontend/.cursor/rules/security.mdc`
- `hms-frontend/.cursor/rules/i18n.mdc`
- `hms-frontend/.cursor/rules/accessibility.mdc`
- `hms-frontend/.cursor/rules/performance.mdc`
- `hms-frontend/.cursor/rules/errors-logging.mdc`
- `hms-frontend/.cursor/rules/debug.mdc`
- `hms-frontend/.cursor/rules/bootstrap-config.mdc`
- `hms-frontend/.cursor/rules/coding-conventions.mdc`
- `hms-frontend/.cursor/rules/testing.mdc`

Conflict resolution order:
- Follow each rule file's declared single source of truth.
- If still unclear, prioritize: `index.mdc` references -> specific single-source files -> phase plan.

---

## Step Selection Contract (Mandatory)

- The request can target one or more step IDs from `3.1 to 3.11`.
- If specific step IDs are selected, implement only those selected IDs.
- If selected steps need minimal shared prerequisite wiring, implement only the minimum prerequisite changes required.
- Do NOT auto-implement unselected sibling steps.
- Apply strict gate execution from `P003_state-theme.md`: complete each selected step fully (implementation + tests + compliance checks) before moving to the next selected step.

---

## Scope

- Implement selected state/theme steps for tokens, themes, provider wiring, and Redux store setup.
- Keep Fluent-aligned, token-driven design with light/dark support only as defined in phase plan.
- Ensure store structure follows established slice and middleware conventions.

Primary areas for this phase:
- `src/theme/**` token files, theme definitions, and theme provider wiring
- `src/store/**` store setup, slices, and exports required by selected step(s)
- Any selected cross-cutting configuration files needed for theme/state bootstrapping

---

## Implementation Rules (Mandatory)

### Architecture and Boundaries
- Keep layer boundaries from `project-structure.mdc` and `core-principles.mdc`.
- Reuse existing modules/hooks/utilities before creating new abstractions.
- Keep code JavaScript-only (`.js`/`.jsx`) per `coding-conventions.mdc`.
- Follow alias/import/export conventions exactly.

### Styling, UX, and Accessibility
- UI files must use i18n keys for all user-facing copy.
- Enforce accessibility semantics, focus handling, and touch target requirements.
- Use theme tokens only; avoid hardcoded design values.

### Data, Security, and Reliability
- When APIs are involved, use only mounted backend routes and valid DTO/enum shapes.
- Handle loading, empty, error, success, and offline states where applicable.
- Avoid ad-hoc `console.*` and sensitive data exposure in logs/UI.
- Prevent duplicate submissions and race-condition regressions.

### Testing and Verification
- Add/update tests for all changed behavior and required edge paths.
- Respect coverage requirements defined by phase plan and `testing.mdc`.
- Run targeted tests/checks for selected step(s) and report results.

---

## Phase Constraints (Mandatory)

- Do NOT hardcode design values instead of tokens.
- Do NOT introduce additional theme modes beyond phase requirements.
- Do NOT add unrelated feature state/business reducers outside selected step scope.

---

## Step Gate Checklist (Mandatory per selected step)

1. Implement/fix only the selected step module/files with compliant structure.
2. Enforce i18n, accessibility, and token/rule compliance.
3. Add/update tests for the selected step behavior and edge cases.
4. Run relevant checks/tests and confirm pass/fail status.
5. Verify no architecture boundary violations.
6. Verify no unselected-step scope creep.

---

## Acceptance Criteria

- 100% compliance with all files in `hms-frontend/.cursor/rules/*`.
- Selected step(s) from `hms-frontend/dev-plan/P003_state-theme.md` are complete and production-ready.
- Backend integration (if applicable) matches mounted routes and contracts.
- `hms-frontend/write-up.md` alignment is preserved for selected scope.
- Tests and verification gates are satisfied for selected scope.
- No out-of-scope phase/step work was introduced.

---

## Deliverables

Return ONLY:

1. Implementation files changed for selected Phase 003 step(s).
2. Related export/config/wiring updates required by selected step(s) only.
3. i18n locale key updates required by selected step(s).
4. Tests/verification artifacts for selected step(s), including commands run and result summary.
5. A concise compliance report confirming:
   - selected step IDs implemented
   - rule compliance checks performed
   - backend/write-up alignment checks performed
   - any intentionally deferred work (must be out-of-scope and justified)

Do NOT include files or logic outside selected Phase 003 step(s).
