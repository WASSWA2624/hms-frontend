Steps to review and implement:
- **11.1.1** Landing + facility type selection -- `(public)/landing`
- **11.1.2** Register (minimal signup) -- `(auth)/register`
- **11.1.3** Resume link sent (check email) -- `(auth)/resume-link-sent`
- **11.1.4** Resume onboarding (token handler) -- `(onboarding)/resume`
- **11.1.5** Provisioning (tenant + modules + sample data) -- `(onboarding)/provisioning`
- **11.1.6** Welcome / activation summary -- `(onboarding)/welcome`
- **11.1.7** First-run checklist (facility-specific) -- `(onboarding)/checklist`
- **11.1.8** Module recommendations + progressive unlocks -- `(onboarding)/modules`
- **11.1.9** Trial status + limits -- `(onboarding)/trial`
- **11.1.10** Upgrade value (paywall messaging) -- `(onboarding)/upgrade`
- **11.1.11** Plan/modules selection -- `(onboarding)/plan`
- **11.1.12** Billing cycle selection -- `(onboarding)/billing-cycle`
- **11.1.13** Payment checkout -- `(onboarding)/payment`
- **11.1.14** Payment success + activation -- `(onboarding)/payment-success`


Review and implement all missing and non compliant aspects of the provided dev step(s) as per `hms-frontend/dev-plan/P011_screens-routes.md`.

You must ensure 100% compliance with:
- All rules in `hms-frontend/.cursor/rules/*`
- `hms-frontend/dev-plan/P011_screens-routes.md`
- `hms-frontend/special-features/onboarding-journey.md`
- Backend contracts in `hms-backend/dev-plan/P010_api_endpoints.mdc`
- Actual mounted backend routes in `hms-backend/src/app/router.js` and the referenced module route files
- If backend changes are required, full compliance with `hms-backend/.cursor/rules/*` is mandatory
- `hms-frontend/write-up.md`

Only implement what is required for this/these Tier 1 screen(s) to function correctly.

---

## Scope

Implement full functionality required for the selected Tier 1 step(s) (`11.1.1` to `11.1.14`):

- Route + screen wiring under `(public)/*`, `(auth)/*`, `(onboarding)/*`
- Backend-aligned onboarding/auth/subscription/payment integration for the selected step(s)
- Loading, empty, error, and success states
- Validation for all required inputs
- Onboarding state persistence and resume behavior after each completed step
- Resume from token/query/state context with no dead ends
- Navigation (Back / Cancel / Continue / Save / Retry) with no dead ends
- Prefill known fields from safe route/query/session/storage context where applicable
- Access control and route guarding for public vs authenticated onboarding states
- Accessibility control for all onboarding/auth/payment actions and route states

The selected step(s) can be one or more of:
- `11.1.1` Landing + facility type selection -- `(public)/landing`
- `11.1.2` Register (minimal signup) -- `(auth)/register`
- `11.1.3` Resume link sent (check email) -- `(auth)/resume-link-sent`
- `11.1.4` Resume onboarding (token handler) -- `(onboarding)/resume`
- `11.1.5` Provisioning (tenant + modules + sample data) -- `(onboarding)/provisioning`
- `11.1.6` Welcome / activation summary -- `(onboarding)/welcome`
- `11.1.7` First-run checklist (facility-specific) -- `(onboarding)/checklist`
- `11.1.8` Module recommendations + progressive unlocks -- `(onboarding)/modules`
- `11.1.9` Trial status + limits -- `(onboarding)/trial`
- `11.1.10` Upgrade value (paywall messaging) -- `(onboarding)/upgrade`
- `11.1.11` Plan/modules selection -- `(onboarding)/plan`
- `11.1.12` Billing cycle selection -- `(onboarding)/billing-cycle`
- `11.1.13` Payment checkout -- `(onboarding)/payment`
- `11.1.14` Payment success + activation -- `(onboarding)/payment-success`

Do NOT implement steps outside the selected Tier 1 step(s).

---

## Backend Reality Check (Mandatory)

- Treat `hms-backend/src/app/router.js` + module route files as source of truth for what can be called
- Do not call frontend endpoint constants that are not mounted by backend routes
- Specifically, do not use non-mounted shortcuts/actions such as:
  - `GET /api/v1/subscriptions/plans`
  - `GET /api/v1/subscriptions/current`
  - `POST /api/v1/subscriptions/:id/upgrade`
  - `POST /api/v1/subscriptions/:id/downgrade`
  - `POST /api/v1/payments/:id/refund`
  - `order-payment-methods/*` endpoints when not mounted
- If backend support does not exist for a selected write action, provide informational/read-only UX and block unsupported writes

---

## Backend Change Policy (Mandatory)

- Modify backend only when strictly required for the selected Tier 1 step(s)
- Any backend modification must follow existing backend rules in `hms-backend/.cursor/rules/*`
- Backend edits must preserve existing backend architecture and conventions (versioned routing, module structure, validation, response format, auth/security, and tests)
- Do not introduce ad-hoc backend behavior that bypasses backend rules or established module patterns

---

## Access Control (Mandatory)

- Enforce access using existing auth/session hooks/utilities/patterns already used in the app (`useAuth`, route guards, existing layouts)
- Use a single source of truth for auth/session + role-feature access
- Apply access checks to both:
  - UI actions (submit/retry/resend/continue/pay/activate)
  - Route navigation (including direct deep links to `(public)`, `(auth)`, `(onboarding)`)
- Never rely on UI hiding alone; route-level protection must prevent unauthorized access
- Block unauthorized data actions before API calls and handle backend `401/403` responses with clear feedback
- Public onboarding routes remain accessible before authentication where intended
- Auth-required onboarding routes (plan/payment/module-subscription writes, etc.) must be blocked without valid authenticated context

---

## Navigation + Routing Accessibility (Mandatory)

- Use semantic links for navigation and semantic buttons for actions; no clickable non-semantic containers
- Ensure current step/location is perceivable via visible and accessible state
- For visible-but-blocked actions, use `aria-disabled="true"` on web, prevent execution, and provide an accessible reason
- Ensure keyboard navigation order, focus visibility, and focus restoration after submit/redirect/error
- Provide screen-reader friendly feedback for loading, errors, denied actions, and successful actions

---

## Layout Rules (Strict)

- Reuse existing **Public/Auth Layout** and existing layout patterns for onboarding routes
- If `(onboarding)` group/layout is missing, create it using existing layout composition patterns (no redesign)
- No layout redesign
- No nested scroll containers
- No nested sidebars
- Match current public/auth/onboarding screens visually and structurally

---

## UI / UX Rules

- Clean, compact, modern UI
- Fully responsive (mobile, tablet, desktop, web, iOS, Android)
- Clear action hierarchy
- Human-friendly copy via i18n keys only
- No duplicate UI
- No oversized elements
- No dead-end navigation

Buttons:
- Use existing public/auth/onboarding button styles
- Compact and consistent

Forms:
- Clear labels and helpful placeholders
- Inline validation messages
- Required fields clearly indicated
- Logical field order
- Disable invalid submit actions while preserving accessible reason text

Onboarding UX:
- Persist onboarding progress after each completed step
- Reuse existing persistence helpers where applicable (`onboardingEntry`, `registrationContext`, `authResumeContext`)
- Resume flow must restore the exact actionable step from token/context
- Paywall must never block existing data; only block unsupported/new actions and show upgrade value
- Do not leak sensitive account or tenant state beyond backend-approved responses

---

## Simplicity + Self-Directed Flow (Mandatory)

- Design for first-time users arriving from online promotion/ads with no prior product knowledge
- The selected Tier 1 flow must be completable without a user manual
- Keep one clear primary action per step; secondary actions must not compete visually
- Use plain, non-technical language in i18n copy (no internal jargon/acronyms without explanation)
- Explain what happens next on each step (for example: what is being created, verified, or activated)
- Keep required inputs minimal; defer non-essential fields to later steps
- Provide sensible defaults and safe prefill from trusted context where available
- Show clear progress cues so users always know where they are and what remains
- Never trap users: every step must have safe forward and recovery paths (retry/back/cancel/continue)
- Error messages must be actionable and human-readable (what failed, what to do next)

---

## Security by Design (Mandatory)

- Apply secure-by-default behavior across all public/auth/onboarding steps
- Collect only data required for the selected step; do not request unnecessary sensitive data
- Never expose secrets/tokens/passwords/PII in logs, analytics, or UI debug text
- Do not leak account existence, tenant existence, or internal state through error wording
- Keep verification/reset/resume flows aligned to backend-approved security behavior
- Prevent duplicate or replay-like submissions with pending/disabled action states
- Validate and sanitize all query/route params before use; reject invalid tokens/context safely
- Use existing secure storage/auth utilities for sensitive state; avoid persisting secrets in plain storage
- Enforce route/action guards before API calls, not only via UI visibility
- For blocked/unauthorized states, show clear non-technical feedback without revealing sensitive details

---

## Reliability

- Handle API/network errors gracefully
- Human-readable, actionable error messages
- Clear success/failure feedback for every supported action
- Disable duplicate submissions while pending
- Preserve user state where possible
- Ensure all enabled actions are fully wired to backend endpoints/contracts (no placeholders)
- Keep behavior robust but simple: prefer existing hooks/components/patterns over new abstractions
- Use existing query/mutation patterns with proper loading, retry, cancellation, and stale-response safety

---

## Backend Linkage (Mandatory)

Every implemented feature/action must call real backend endpoints for the selected Tier 1 step(s):

- `11.1.1` Landing (`(public)/landing`)
  - No mandatory API call; use existing onboarding entry persistence and safe route context
- `11.1.2` Register (`(auth)/register`)
  - `POST /api/v1/auth/register`
  - Request must align with backend schema: `email`, `password`, `facility_name`, `admin_name`, `facility_type`, optional `phone`, `location`, `interests`
- `11.1.3` Resume link sent (`(auth)/resume-link-sent`)
  - Use registration/resume context
  - Resend when enabled: `POST /api/v1/auth/resend-verification` with `type=email`
- `11.1.4` Resume onboarding token handler (`(onboarding)/resume`)
  - `POST /api/v1/auth/verify-email`
  - Optional resend: `POST /api/v1/auth/resend-verification` with `type=email`
- `11.1.5` Provisioning (`(onboarding)/provisioning`)
  - Provisioning is performed by backend registration flow (`POST /api/v1/auth/register`) via tenant/facility/bootstrap transaction
  - Do not invent `/onboarding/provisioning` APIs
- `11.1.6` Welcome / activation summary (`(onboarding)/welcome`)
  - Use registration context and/or authenticated context from `GET /api/v1/auth/me` when session exists
- `11.1.7` Checklist (`(onboarding)/checklist`)
  - If no dedicated backend checklist endpoint exists, keep it informational/read-only or local non-authoritative progression only
- `11.1.8` Modules (`(onboarding)/modules`)
  - `GET /api/v1/modules`
  - `GET /api/v1/module-subscriptions` (filtered by `subscription_id` as needed)
  - Write operations only if selected step requires them and auth context exists: `POST/PUT /api/v1/module-subscriptions`
- `11.1.9` Trial (`(onboarding)/trial`)
  - `GET /api/v1/subscriptions` / `GET /api/v1/subscriptions/:id` for trial status (`TRIAL`, dates, status)
  - Do not use non-mounted subscription usage endpoints
- `11.1.10` Upgrade (`(onboarding)/upgrade`)
  - Value/paywall messaging based on existing subscription and plan/module data; no invented upgrade endpoint
- `11.1.11` Plan (`(onboarding)/plan`)
  - `GET /api/v1/subscription-plans`
  - `GET /api/v1/modules`
  - Optional creation/update flow if selected: `POST /api/v1/subscriptions`, `PUT /api/v1/subscriptions/:id`
- `11.1.12` Billing cycle (`(onboarding)/billing-cycle`)
  - Align selection to `subscription-plan` enum values (`MONTHLY`, `QUARTERLY`, `YEARLY`)
  - Use existing plan list/get endpoints only
- `11.1.13` Payment (`(onboarding)/payment`)
  - Use existing mounted billing endpoints only:
    - `POST /api/v1/invoices` (if invoice is required and missing)
    - `POST /api/v1/subscription-invoices` (link subscription to invoice when required)
    - `POST /api/v1/payments`
  - Keep DTOs aligned with backend schemas (UUIDs, enums, decimal strings, timestamps)
- `11.1.14` Payment success (`(onboarding)/payment-success`)
  - Verify post-payment activation state from existing endpoints (`subscriptions`, `subscription-invoices`, `payments`, and/or `auth/me` context)
  - No fake success screen without backend-backed state

Keep request/response fields strictly aligned with backend schema/validation rules.
Do not ship mock data, fake success states, or disconnected UI actions.
If backend intentionally lacks support for an action, expose read-only/informational UX and block unsupported writes.

All operations MUST match backend schema and endpoint behavior exactly.

---

## Constraints

Do NOT:

- Modify Tier 2/Tier 3+ screens or flows unless required by selected Tier 1 step(s)
- Break existing root entry behavior and `/welcome` flow unless explicitly required by selected Tier 1 step(s)
- Change layout or routing architecture outside required Tier 1 route wiring
- Add global components or new patterns
- Invent backend fields, endpoints, or behaviors
- Implement screens outside selected Tier 1 step(s)

---

## Acceptance Criteria

- 100% rules compliance
- Existing layout patterns reused
- Backend-aligned functionality for selected Tier 1 step(s)
- Responsive UI with clear validation and feedback
- No nested scroll
- Screen(s) work independently and integrate with current onboarding/auth navigation
- Access control is enforced for actions and routes (including deep links)
- Accessibility is preserved for all states, including unauthorized/disabled states
- The selected onboarding flow can be completed by a first-time user without a manual
- The selected onboarding flow remains secure by default (no data leakage, no insecure shortcuts)
- Resume flow restores progress correctly from token/context
- All applicable features/actions are fully functional and backend-linked
- Unauthorized users cannot execute restricted actions via URL, keyboard, or direct API-triggering UI paths

---

## Deliverables

Return ONLY:

1. Screen/Page component(s) for the selected Tier 1 step(s)
2. Form component(s) (if applicable)
3. API integration hook usage/updates (if applicable)
4. Validation logic (if applicable)
5. Onboarding state persistence/resume logic
6. Loading + empty + error UI
7. Success/failure feedback implementation
8. Navigation handlers
9. Backend contract alignment confirmation
10. Access control implementation confirmation (actions + routes)
11. Accessibility control confirmation for all states
12. Route-guard + navigation accessibility confirmation (keyboard/focus/blocked actions)
13. Action-to-backend linkage confirmation for all enabled features in the selected screen(s)
14. Explicit note for any selected action intentionally read-only due to missing backend support

Do NOT include files or logic outside the selected Tier 1 screen(s).
