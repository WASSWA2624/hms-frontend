Steps to review and implement:
- **11.6.1** Clinical (main) -- `(main)/clinical`
- **11.6.2** Encounter -- `(main)/clinical/encounters`
- **11.6.3** Clinical note -- `(main)/clinical/clinical-notes`
- **11.6.4** Diagnosis -- `(main)/clinical/diagnoses`
- **11.6.5** Procedure -- `(main)/clinical/procedures`
- **11.6.6** Vital sign -- `(main)/clinical/vital-signs`
- **11.6.7** Care plan -- `(main)/clinical/care-plans`
- **11.6.8** Referral -- `(main)/clinical/referrals`
- **11.6.9** Follow-up -- `(main)/clinical/follow-ups`

Review and implement all missing and non-compliant aspects of the provided dev step(s) as per `hms-frontend/dev-plan/P011_screens-routes.md`.

You must ensure 100% compliance with:
- All rules in `hms-frontend/.cursor/rules/*`
- `hms-frontend/dev-plan/P011_screens-routes.md`
- `hms-frontend/write-up.md`
- Backend contracts in `hms-backend/dev-plan/P010_api_endpoints.mdc` for selected clinical resources
- Actual mounted backend routes in `hms-backend/src/app/router.js` and clinical module route files:
  - `hms-backend/src/modules/encounter/routes/encounter.routes.js`
  - `hms-backend/src/modules/clinical-note/routes/clinical-note.routes.js`
  - `hms-backend/src/modules/diagnosis/routes/diagnosis.routes.js`
  - `hms-backend/src/modules/procedure/routes/procedure.routes.js`
  - `hms-backend/src/modules/vital-sign/routes/vital-sign.routes.js`
  - `hms-backend/src/modules/care-plan/routes/care-plan.routes.js`
  - `hms-backend/src/modules/referral/routes/referral.routes.js`
  - `hms-backend/src/modules/follow-up/routes/follow-up.routes.js`
- If backend changes are required, full compliance with `hms-backend/.cursor/rules/*` is mandatory

Only implement what is required for the selected Tier 6 screen(s) to function correctly.

---

## Step Selection Contract (Mandatory)

- The request can target one or more steps from `11.6.1` to `11.6.9`
- Implement only the explicitly selected step(s)
- If a selected step depends on shared clinical wiring, implement only the minimal shared wiring required
- Do NOT auto-implement unselected sibling steps

---

## Scope

Implement full functionality required for the selected Tier 6 step(s):

- Route + screen wiring under `(main)/clinical/*`
- Backend-aligned API integration for selected clinical resources
- Loading, empty, error, offline, and success states
- Validation for required create/edit inputs
- List, detail, create, edit, and delete flows where backend supports them
- Navigation (Back / Cancel / Save / Continue) with no dead ends
- Parent-child flow continuity from Clinical main screen to selected sub-resources
- Prefill and relationship handling from trusted context (`tenant_id`, `facility_id`, `patient_id`, `provider_user_id`, `encounter_id`, `author_user_id`, `from_department_id`, `to_department_id`)
- Role-feature access control for logged-in users on all selected clinical routes/actions
- Accessibility control for all selected clinical actions and route states

The selected step(s) can be one or more of:
- `11.6.1` Clinical (main) -- `(main)/clinical`
- `11.6.2` Encounter -- `(main)/clinical/encounters`
- `11.6.3` Clinical note -- `(main)/clinical/clinical-notes`
- `11.6.4` Diagnosis -- `(main)/clinical/diagnoses`
- `11.6.5` Procedure -- `(main)/clinical/procedures`
- `11.6.6` Vital sign -- `(main)/clinical/vital-signs`
- `11.6.7` Care plan -- `(main)/clinical/care-plans`
- `11.6.8` Referral -- `(main)/clinical/referrals`
- `11.6.9` Follow-up -- `(main)/clinical/follow-ups`

Do NOT implement steps outside the selected Tier 6 step(s).

---

## Backend Reality Check (Mandatory)

- Treat `hms-backend/src/app/router.js` + clinical module route files as source of truth
- Use only mounted top-level resources:
  - `/api/v1/encounters`
  - `/api/v1/clinical-notes`
  - `/api/v1/diagnoses`
  - `/api/v1/procedures`
  - `/api/v1/vital-signs`
  - `/api/v1/care-plans`
  - `/api/v1/referrals`
  - `/api/v1/follow-ups`
- Respect actual filter support:
  - Encounters: `tenant_id`, `facility_id`, `patient_id`, `provider_user_id`, `encounter_type`, `status`
  - Clinical notes: `encounter_id`, `author_user_id`
  - Diagnoses: `encounter_id`, `diagnosis_type`, `code`
  - Procedures: `encounter_id`, `code`
  - Vital signs: `encounter_id`, `vital_type`
  - Care plans: `encounter_id`, `start_date`, `end_date`
  - Referrals: `encounter_id`, `from_department_id`, `to_department_id`, `status`
  - Follow-ups: `encounter_id`
- Referrals status constraints differ by operation in backend schemas; follow backend schema exactly:
  - Create: `PENDING`, `APPROVED`, `REJECTED`, `COMPLETED`, `CANCELLED`
  - List/Update: `REQUESTED`, `APPROVED`, `IN_PROGRESS`, `COMPLETED`, `CANCELLED`
- Do not call frontend endpoint constants that are not mounted by backend routes
- Do not invent nested shortcut endpoints such as:
  - `/api/v1/encounters/:id/clinical-notes`
  - `/api/v1/encounters/:id/diagnoses`
  - `/api/v1/encounters/:id/procedures`
  - `/api/v1/encounters/:id/vital-signs`
  - `/api/v1/encounters/:id/care-plans`
  - `/api/v1/encounters/:id/referrals`
  - `/api/v1/encounters/:id/follow-ups`
  - `/api/v1/patients/:id/encounters`
- Do not expand scope into non-selected neighboring modules such as `clinical-alerts`, `nursing-notes`, or `medication-administrations` unless explicitly selected in a different task
- If backend support does not exist for a selected write action, provide read-only/informational UX and block unsupported writes

---

## Backend Change Policy (Mandatory)

- Modify backend only when strictly required for selected Tier 6 step(s)
- Any backend modification must follow `hms-backend/.cursor/rules/*`
- Preserve backend architecture and conventions (versioned routing, module structure, validation, response format, auth/security, tests)
- Do not introduce ad-hoc backend behavior that bypasses established module patterns

---

## Access Control (Mandatory)

- Enforce access using existing auth/session and role-feature hooks/utilities/patterns already used in the app
- Use a single source of truth for auth/session + role-feature access
- Apply access checks to both:
  - UI actions (view/create/edit/delete/retry where applicable)
  - Route navigation (including direct deep links to `(main)/clinical/*`)
- Never rely on UI hiding alone; route-level protection must prevent unauthorized access
- Block unauthorized data actions before API calls and handle backend `401/403` responses with clear feedback
- For unauthorized routes, redirect to nearest allowed main route and preserve safe navigation

---

## Navigation + Routing Accessibility (Mandatory)

- Use semantic links for navigation and semantic buttons for actions; no clickable non-semantic containers
- Ensure current location is perceivable via visible and accessible state
- For visible-but-blocked actions, use `aria-disabled="true"` on web, prevent execution, and provide an accessible reason
- Ensure keyboard navigation order, focus visibility, and focus restoration after submit/redirect/error
- Provide screen-reader friendly feedback for loading, errors, denied actions, and successful actions

---

## Layout Rules (Strict)

- Reuse existing **Main Layout** and existing route-group layout patterns for `(main)/clinical`
- If clinical route-group layout is missing, create it using existing composition patterns (no redesign)
- No layout redesign
- No nested scroll containers
- No nested sidebars
- Match current main/settings/dashboard screens visually and structurally

---

## UI / UX Rules

- Clean, compact, modern UI
- Fully responsive (mobile, tablet, desktop, web, iOS, Android)
- Clear action hierarchy
- Human-friendly copy via i18n keys only
- No duplicate UI
- No oversized elements
- No dead-end navigation

Buttons:
- Use existing main/clinical button styles
- Compact and consistent

Forms:
- Clear labels and helpful placeholders
- Inline validation messages
- Required fields clearly indicated
- Logical field order
- Disable invalid submit actions while preserving accessible reason text
- Enforce safe date-time ordering where required by backend contract (for example `started_at < ended_at`, `start_date <= end_date` when both are present)

Clinical flow UX:
- The selected Tier 6 flow must be self-directed for first-time staff users without a manual
- Keep primary actions obvious and reduce cognitive load
- Explain required relationship context (encounter linkage, author/provider linkage, department linkage) in plain language
- Minimize required data entry to backend-required fields only
- Preserve selected clinical context while navigating between related clinical sub-resources

---

## Security by Design (Mandatory)

- Apply secure-by-default behavior across selected clinical screens/actions
- Collect only data required for the selected step; do not request unnecessary sensitive data
- Never expose secrets/tokens/PII in logs, analytics, or UI debug text
- Prevent duplicate/replay-like submissions with pending/disabled action states
- Validate and sanitize all route/query params before use (`id`, `tenant_id`, `facility_id`, `patient_id`, `provider_user_id`, `encounter_id`, `author_user_id`, `from_department_id`, `to_department_id`, pagination/filter values)
- Use existing secure auth/session storage and request utilities
- Enforce route/action guards before API calls, not only via UI visibility
- For blocked/unauthorized states, show clear non-technical feedback without leaking sensitive details

---

## Reliability

- Handle API/network errors gracefully
- Human-readable, actionable error messages
- Clear success/failure feedback for every supported action
- Disable duplicate submissions while pending
- Preserve user state where possible (filters, selected context, pagination)
- Ensure all enabled actions are fully wired to backend endpoints/contracts (no placeholders)
- Keep behavior robust but simple: prefer existing hooks/components/patterns over new abstractions
- Use existing query/mutation patterns with proper loading, retry, cancellation, and stale-response safety

---

## Backend Linkage (Mandatory)

Every implemented feature/action must call real backend endpoints for the selected Tier 6 step(s):

- `11.6.1` Clinical (main) (`(main)/clinical`)
  - Use mounted clinical resource endpoints for primary list/context, at minimum: `GET /api/v1/encounters`
  - If showing summary cards, use mounted list endpoints (`clinical-notes`, `diagnoses`, `procedures`, `vital-signs`, `care-plans`, `referrals`, `follow-ups`) with valid filters
  - Do not invent aggregate/dashboard endpoints for clinical main

- `11.6.2` Encounter (`(main)/clinical/encounters`)
  - `GET /api/v1/encounters`
  - `GET /api/v1/encounters/:id`
  - `POST /api/v1/encounters`
  - `PUT /api/v1/encounters/:id`
  - `DELETE /api/v1/encounters/:id`

- `11.6.3` Clinical note (`(main)/clinical/clinical-notes`)
  - `GET /api/v1/clinical-notes`
  - `GET /api/v1/clinical-notes/:id`
  - `POST /api/v1/clinical-notes`
  - `PUT /api/v1/clinical-notes/:id`
  - `DELETE /api/v1/clinical-notes/:id`

- `11.6.4` Diagnosis (`(main)/clinical/diagnoses`)
  - `GET /api/v1/diagnoses`
  - `GET /api/v1/diagnoses/:id`
  - `POST /api/v1/diagnoses`
  - `PUT /api/v1/diagnoses/:id`
  - `DELETE /api/v1/diagnoses/:id`

- `11.6.5` Procedure (`(main)/clinical/procedures`)
  - `GET /api/v1/procedures`
  - `GET /api/v1/procedures/:id`
  - `POST /api/v1/procedures`
  - `PUT /api/v1/procedures/:id`
  - `DELETE /api/v1/procedures/:id`

- `11.6.6` Vital sign (`(main)/clinical/vital-signs`)
  - `GET /api/v1/vital-signs`
  - `GET /api/v1/vital-signs/:id`
  - `POST /api/v1/vital-signs`
  - `PUT /api/v1/vital-signs/:id`
  - `DELETE /api/v1/vital-signs/:id`

- `11.6.7` Care plan (`(main)/clinical/care-plans`)
  - `GET /api/v1/care-plans`
  - `GET /api/v1/care-plans/:id`
  - `POST /api/v1/care-plans`
  - `PUT /api/v1/care-plans/:id`
  - `DELETE /api/v1/care-plans/:id`

- `11.6.8` Referral (`(main)/clinical/referrals`)
  - `GET /api/v1/referrals`
  - `GET /api/v1/referrals/:id`
  - `POST /api/v1/referrals`
  - `PUT /api/v1/referrals/:id`
  - `DELETE /api/v1/referrals/:id`

- `11.6.9` Follow-up (`(main)/clinical/follow-ups`)
  - `GET /api/v1/follow-ups`
  - `GET /api/v1/follow-ups/:id`
  - `POST /api/v1/follow-ups`
  - `PUT /api/v1/follow-ups/:id`
  - `DELETE /api/v1/follow-ups/:id`

Keep request/response fields strictly aligned with backend schema/validation rules.
Do not ship mock data, fake success states, or disconnected UI actions.
If backend intentionally lacks support for an action, expose read-only/informational UX and block unsupported writes.

All operations MUST match backend schema and endpoint behavior exactly.

---

## Constraints

Do NOT:

- Modify Tier 1/Tier 2/Tier 3/Tier 4/Tier 5 screens or flows unless required by selected Tier 6 step(s)
- Change layout or routing architecture outside required Tier 6 route wiring
- Add global components or new patterns
- Invent backend fields, endpoints, or behaviors
- Implement screens outside selected Tier 6 step(s)

---

## Acceptance Criteria

- 100% rules compliance
- Existing layout patterns reused
- Backend-aligned functionality for selected Tier 6 step(s)
- Responsive UI with clear validation and feedback
- No nested scroll
- Screen(s) work independently and integrate with current main navigation
- Access control is enforced for actions and routes (including deep links)
- Accessibility is preserved for all states, including unauthorized/disabled states
- The selected clinical flow can be completed without a manual
- The selected clinical flow remains secure by default (no data leakage, no insecure shortcuts)
- All applicable features/actions are fully functional and backend-linked
- Unauthorized users cannot execute restricted actions via URL, keyboard, or direct API-triggering UI paths

---

## Deliverables

Return ONLY:

1. Screen/Page component(s) for selected Tier 6 step(s)
2. Form component(s) (if applicable)
3. API integration hook usage/updates (if applicable)
4. Validation logic (if applicable)
5. State handling logic
6. Loading + empty + error + offline UI
7. Success/failure feedback implementation
8. Navigation handlers
9. Backend contract alignment confirmation
10. Access control implementation confirmation (actions + routes)
11. Accessibility control confirmation for all states
12. Route-guard + navigation accessibility confirmation (keyboard/focus/blocked actions)
13. Action-to-backend linkage confirmation for all enabled features in selected screen(s)
14. Explicit note for any selected action intentionally read-only due to missing backend support

Do NOT include files or logic outside selected Tier 6 screen(s).
