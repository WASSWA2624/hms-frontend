Steps to review and implement:
- **11.9.1** Pharmacy (main) -- `(main)/pharmacy`
- **11.9.2.1** Drug -- `(main)/pharmacy/drugs`
- **11.9.2.2** Batch -- `(main)/pharmacy/drug-batches`
- **11.9.2.3** Formulary -- `(main)/pharmacy/formulary-items`
- **11.9.2.4** Order -- `(main)/pharmacy/pharmacy-orders`
- **11.9.2.5** Dispense -- `(main)/pharmacy/dispense-logs`
- **11.9.2.6** Adverse Event -- `(main)/pharmacy/adverse-events`
- **11.9.3** Inventory (main) -- `(main)/inventory`
- **11.9.4.1** Item -- `(main)/inventory/inventory-items`
- **11.9.4.2** Stock -- `(main)/inventory/inventory-stocks`
- **11.9.4.3** Movement -- `(main)/inventory/stock-movements`
- **11.9.4.4** Supplier -- `(main)/inventory/suppliers`
- **11.9.4.5** Purchase -- `(main)/inventory/purchase-orders`
- **11.9.4.6** Receipt -- `(main)/inventory/goods-receipts`
- **11.9.4.7** Adjustment -- `(main)/inventory/stock-adjustments`

Review and implement all missing and non-compliant aspects of the provided dev step(s) as per `hms-frontend/dev-plan/P011_screens-routes.md`.

You must ensure 100% compliance with:
- All rules in `hms-frontend/.cursor/rules/*`
- `hms-frontend/dev-plan/P011_screens-routes.md`
- `hms-frontend/write-up.md`
- Backend contracts in `hms-backend/dev-plan/P010_api_endpoints.mdc` for selected Tier 9 resources
- Actual mounted backend routes in `hms-backend/src/app/router.js` and these Tier 9 module route files:
  - `hms-backend/src/modules/drug/routes/drug.routes.js`
  - `hms-backend/src/modules/drug-batch/routes/drug-batch.routes.js`
  - `hms-backend/src/modules/formulary-item/routes/formulary-item.routes.js`
  - `hms-backend/src/modules/pharmacy-order/routes/pharmacy-order.routes.js`
  - `hms-backend/src/modules/dispense-log/routes/dispense-log.routes.js`
  - `hms-backend/src/modules/adverse-event/routes/adverse-event.routes.js`
  - `hms-backend/src/modules/inventory-item/routes/inventory-item.routes.js`
  - `hms-backend/src/modules/inventory-stock/routes/inventory-stock.routes.js`
  - `hms-backend/src/modules/stock-movement/routes/stock-movement.routes.js`
  - `hms-backend/src/modules/supplier/routes/supplier.routes.js`
  - `hms-backend/src/modules/purchase-order/routes/purchase-order.routes.js`
  - `hms-backend/src/modules/goods-receipt/routes/goods-receipt.routes.js`
  - `hms-backend/src/modules/stock-adjustment/routes/stock-adjustment.routes.js`
- Related mounted dependency resources (use only if required by selected step context):
  - `hms-backend/src/modules/pharmacy-order-item/routes/pharmacy-order-item.routes.js`
  - `hms-backend/src/modules/purchase-request/routes/purchase-request.routes.js`
- If backend changes are required, full compliance with `hms-backend/.cursor/rules/*` is mandatory

Only implement what is required for the selected Tier 9 screen(s) to function correctly.

---

## Step Selection Contract (Mandatory)

- The request can target one or more steps from `11.9.1` to `11.9.4.7`.
- Group labels `11.9.2` and `11.9.4` are collections, not single resources.
- If a request selects `11.9.2`, implement all child pharmacy tab steps `11.9.2.1` to `11.9.2.6`.
- If a request selects `11.9.4`, implement all child inventory tab steps `11.9.4.1` to `11.9.4.7`.
- If a request selects specific child tab step IDs, implement only those.
- `11.9.4.5` Purchase maps to `purchase-orders` for this tier command.
- If a selected step depends on shared Tier 9 wiring, implement only minimal shared wiring required.
- Do NOT auto-implement unselected sibling steps.

---

## Scope

Implement full functionality required for the selected Tier 9 step(s):

- Route + screen wiring under `(main)/pharmacy/*` and `(main)/inventory/*` (selected steps only)
- Backend-aligned API integration for selected resources
- Loading, empty, error, offline, and success states
- Validation for required create/edit inputs
- List, detail, create, edit, and delete flows where backend supports them
- Navigation (Back / Cancel / Save / Continue) with no dead ends
- Parent-child continuity from selected Tier 9 main screens to selected sub-resources
- Prefill and relationship handling from trusted context:
  - `tenant_id`, `facility_id`, `patient_id`, `encounter_id`, `drug_id`, `pharmacy_order_id`, `pharmacy_order_item_id`, `inventory_item_id`, `supplier_id`, `purchase_request_id`, `purchase_order_id`, `requested_by_user_id`
- Role-feature access control for logged-in users on all selected Tier 9 routes/actions
- Accessibility control for all selected Tier 9 actions and route states

Frontend integration requirements for alignment with the current codebase:
- Reuse existing feature modules under `src/features/<resource>/*` for selected resources.
- Existing feature modules are available for:
  - `drug`, `drug-batch`, `formulary-item`, `pharmacy-order`, `dispense-log`, `adverse-event`
  - `inventory-item`, `inventory-stock`, `stock-movement`, `supplier`, `purchase-order`, `goods-receipt`, `stock-adjustment`
- Related mounted dependency feature modules (use only if required by selected flow):
  - `pharmacy-order-item`, `purchase-request`
- If a selected Tier 9 resource hook is missing, create a minimal `useCrud` wrapper hook for that selected resource and export it in `src/hooks/index.js`.
- Do not create broad new abstractions unless inevitable; prefer existing route/list/detail/create/edit patterns already used in the app.
- Avoid introducing a heavy custom tab system unless inevitable.
- Avoid extra task/automation scaffolding ("tas") unless inevitable.

Do NOT implement steps outside the selected Tier 9 step(s).

---

## Backend Reality Check (Mandatory)

- Treat `hms-backend/src/app/router.js` + listed Tier 9 module route files as source of truth.
- Use only mounted top-level resources for selected Tier 9 routes:
  - `/api/v1/drugs`
  - `/api/v1/drug-batches`
  - `/api/v1/formulary-items`
  - `/api/v1/pharmacy-orders`
  - `/api/v1/dispense-logs`
  - `/api/v1/adverse-events`
  - `/api/v1/inventory-items`
  - `/api/v1/inventory-stocks`
  - `/api/v1/stock-movements`
  - `/api/v1/suppliers`
  - `/api/v1/purchase-orders`
  - `/api/v1/goods-receipts`
  - `/api/v1/stock-adjustments`

Respect actual filter support:
- Drugs: `tenant_id`, `name`, `code`, `form`, `strength`, `search`
- Drug batches: `drug_id`, `batch_number`, `expired`, `search`
- Formulary items: `tenant_id`, `drug_id`, `is_active`
- Pharmacy orders: `encounter_id`, `patient_id`, `status`, `ordered_at_from`, `ordered_at_to`
- Dispense logs: `pharmacy_order_item_id`, `status`, `dispensed_at_from`, `dispensed_at_to`
- Adverse events: `patient_id`, `drug_id`, `severity`, `reported_at_from`, `reported_at_to`, `search`
- Inventory items: `tenant_id`, `name`, `category`, `sku`, `unit`, `search`
- Inventory stocks: `inventory_item_id`, `facility_id`, `min_quantity`, `max_quantity`, `below_reorder`
- Stock movements: `inventory_item_id`, `facility_id`, `movement_type`, `reason`, `from_date`, `to_date`
- Suppliers: `tenant_id`, `name`, `contact_email`, `search`
- Purchase orders: `purchase_request_id`, `supplier_id`, `status`, `search`
- Goods receipts: `purchase_order_id`, `status`, `search`
- Stock adjustments: `inventory_item_id`, `facility_id`, `reason`, `search`

Status/enum constraints that must match backend schema:
- Pharmacy order `status`: `ORDERED`, `DISPENSED`, `PARTIALLY_DISPENSED`, `CANCELLED`
- Dispense log `status`: `PENDING`, `DISPENSED`, `RETURNED`, `CANCELLED`
- Adverse event `severity`: `MILD`, `MODERATE`, `SEVERE`
- Inventory item `category`: `MEDICATION`, `SUPPLY`, `EQUIPMENT`, `OTHER`
- Stock movement `movement_type`: `INBOUND`, `OUTBOUND`, `ADJUSTMENT`, `TRANSFER`
- Stock movement `reason`: `PURCHASE`, `DISPENSE`, `RETURN`, `DAMAGE`, `EXPIRY`, `OTHER`
- Stock adjustment `reason`: `DAMAGED`, `EXPIRED`, `LOST`, `FOUND`, `CORRECTION`, `OTHER`

Non-enum notes:
- Purchase order `status` is free text (`string`, max 60), not a fixed enum.
- Goods receipt `status` is free text (`string`, max 60), not a fixed enum.
- Drug batch `expired` filter is boolean-like (`'true'|'false'` query transformed server-side).

Do not call frontend endpoint constants that are not mounted by backend routes.
Do not invent nested shortcut endpoints such as:
- `/api/v1/pharmacy/drugs`
- `/api/v1/pharmacy-orders/:id/items`
- `/api/v1/pharmacy-orders/:id/dispense-logs`
- `/api/v1/inventory/items/:id/stocks`
- `/api/v1/inventory-items/:id/movements`
- `/api/v1/purchase-orders/:id/receipts`

Out-of-scope mounted resources for this command unless explicitly selected as dependency wiring:
- `/api/v1/pharmacy-order-items`
- `/api/v1/purchase-requests`

If backend support does not exist for a selected write action, provide read-only/informational UX and block unsupported writes.

---

## Backend Change Policy (Mandatory)

- Modify backend only when strictly required for selected Tier 9 step(s).
- Any backend modification must follow `hms-backend/.cursor/rules/*`.
- Preserve backend architecture and conventions (versioned routing, module structure, validation, response format, auth/security, tests).
- Do not introduce ad-hoc backend behavior that bypasses established module patterns.

---

## Access Control (Mandatory)

- Enforce access using existing auth/session and role-feature hooks/utilities/patterns already used in the app.
- Use one source of truth per selected module for auth/session + role-feature access.
- Apply access checks to both:
  - UI actions (view/create/edit/delete/retry and action endpoints where applicable)
  - Route navigation (including direct deep links to selected Tier 9 routes)
- Never rely on UI hiding alone; route-level protection must prevent unauthorized access.
- Block unauthorized data actions before API calls and handle backend `401/403` responses with clear feedback.
- For unauthorized routes, redirect to nearest allowed main route and preserve safe navigation.

---

## Navigation + Routing Accessibility (Mandatory)

- Use semantic links for navigation and semantic buttons for actions; no clickable non-semantic containers.
- Ensure current location is perceivable via visible and accessible state.
- For visible-but-blocked actions, use `aria-disabled="true"` on web, prevent execution, and provide an accessible reason.
- Ensure keyboard navigation order, focus visibility, and focus restoration after submit/redirect/error.
- Provide screen-reader friendly feedback for loading, errors, denied actions, and successful actions.

---

## Layout Rules (Strict)

- Reuse existing Main Layout and route-group layout patterns for selected pharmacy/inventory groups.
- If `(main)/pharmacy` or `(main)/inventory` group/layout is missing, create it using existing composition patterns (no redesign).
- No layout redesign.
- No nested scroll containers.
- No nested sidebars.
- Match current main/settings/dashboard/patients/scheduling/clinical screens visually and structurally.

---

## UI / UX Rules

- Clean, compact, modern UI.
- Fully responsive (mobile, tablet, desktop, web, iOS, Android).
- Clear action hierarchy.
- Human-friendly copy via i18n keys only.
- No duplicate UI.
- No oversized elements.
- No dead-end navigation.

Buttons:
- Use existing module button styles.
- Compact and consistent.

Forms:
- Clear labels and helpful placeholders.
- Inline validation messages.
- Required fields clearly indicated.
- Logical field order.
- Disable invalid submit actions while preserving accessible reason text.
- Enforce safe date-time ordering where required by backend contract, including:
  - `ordered_at_from <= ordered_at_to` (pharmacy orders list filters)
  - `dispensed_at_from <= dispensed_at_to` (dispense logs list filters)
  - `reported_at_from <= reported_at_to` (adverse events list filters)
  - `from_date <= to_date` (stock movements list filters)

Tier 9 flow UX:
- Selected Tier 9 flow(s) must be self-directed for first-time pharmacy/store staff users without a manual.
- Keep primary actions obvious and reduce cognitive load.
- Explain required relationship context in plain language (drug, order, order item, inventory item, supplier, purchase order).
- Minimize required data entry to backend-required fields only.
- Preserve selected context while navigating between selected sub-resources.

---

## Security by Design (Mandatory)

- Apply secure-by-default behavior across selected Tier 9 screens/actions.
- Collect only data required for the selected step; do not request unnecessary sensitive data.
- Never expose secrets/tokens/PII in logs, analytics, or UI debug text.
- Prevent duplicate/replay-like submissions with pending/disabled action states.
- Validate and sanitize all route/query params before use:
  - `id`, `tenant_id`, `facility_id`, `patient_id`, `encounter_id`, `drug_id`, `pharmacy_order_id`, `pharmacy_order_item_id`, `inventory_item_id`, `supplier_id`, `purchase_request_id`, `purchase_order_id`, pagination/filter values
- Use existing secure auth/session storage and request utilities.
- Enforce route/action guards before API calls, not only via UI visibility.
- For blocked/unauthorized states, show clear non-technical feedback without leaking sensitive details.

---

## Reliability

- Handle API/network errors gracefully.
- Human-readable, actionable error messages.
- Clear success/failure feedback for every supported action.
- Disable duplicate submissions while pending.
- Preserve user state where possible (filters, selected context, pagination).
- Ensure all enabled actions are fully wired to backend endpoints/contracts (no placeholders).
- Keep behavior robust but simple: prefer existing hooks/components/patterns over new abstractions.
- Use existing query/mutation patterns with proper loading, retry, cancellation, and stale-response safety.

---

## Backend Linkage (Mandatory)

Every implemented feature/action must call real backend endpoints for the selected Tier 9 step(s):

- `11.9.1` Pharmacy (main) (`(main)/pharmacy`)
  - At minimum: `GET /api/v1/pharmacy-orders`
  - If showing summary cards, use mounted pharmacy endpoints (`drugs`, `drug-batches`, `formulary-items`, `dispense-logs`, `adverse-events`) with valid filters
  - Do not invent aggregate dashboard endpoints

- `11.9.2.1` Drug (`(main)/pharmacy/drugs`)
  - `GET /api/v1/drugs`
  - `GET /api/v1/drugs/:id`
  - `POST /api/v1/drugs`
  - `PUT /api/v1/drugs/:id`
  - `DELETE /api/v1/drugs/:id`

- `11.9.2.2` Batch (`(main)/pharmacy/drug-batches`)
  - `GET /api/v1/drug-batches`
  - `GET /api/v1/drug-batches/:id`
  - `POST /api/v1/drug-batches`
  - `PUT /api/v1/drug-batches/:id`
  - `DELETE /api/v1/drug-batches/:id`

- `11.9.2.3` Formulary (`(main)/pharmacy/formulary-items`)
  - `GET /api/v1/formulary-items`
  - `GET /api/v1/formulary-items/:id`
  - `POST /api/v1/formulary-items`
  - `PUT /api/v1/formulary-items/:id`
  - `DELETE /api/v1/formulary-items/:id`

- `11.9.2.4` Order (`(main)/pharmacy/pharmacy-orders`)
  - `GET /api/v1/pharmacy-orders`
  - `GET /api/v1/pharmacy-orders/:id`
  - `POST /api/v1/pharmacy-orders`
  - `PUT /api/v1/pharmacy-orders/:id`
  - `DELETE /api/v1/pharmacy-orders/:id`

- `11.9.2.5` Dispense (`(main)/pharmacy/dispense-logs`)
  - `GET /api/v1/dispense-logs`
  - `GET /api/v1/dispense-logs/:id`
  - `POST /api/v1/dispense-logs`
  - `PUT /api/v1/dispense-logs/:id`
  - `DELETE /api/v1/dispense-logs/:id`

- `11.9.2.6` Adverse Event (`(main)/pharmacy/adverse-events`)
  - `GET /api/v1/adverse-events`
  - `GET /api/v1/adverse-events/:id`
  - `POST /api/v1/adverse-events`
  - `PUT /api/v1/adverse-events/:id`
  - `DELETE /api/v1/adverse-events/:id`

- `11.9.3` Inventory (main) (`(main)/inventory`)
  - At minimum: `GET /api/v1/inventory-items`
  - If showing summary cards, use mounted inventory endpoints (`inventory-stocks`, `stock-movements`, `suppliers`, `purchase-orders`, `goods-receipts`, `stock-adjustments`) with valid filters
  - Do not invent aggregate dashboard endpoints

- `11.9.4.1` Item (`(main)/inventory/inventory-items`)
  - `GET /api/v1/inventory-items`
  - `GET /api/v1/inventory-items/:id`
  - `POST /api/v1/inventory-items`
  - `PUT /api/v1/inventory-items/:id`
  - `DELETE /api/v1/inventory-items/:id`

- `11.9.4.2` Stock (`(main)/inventory/inventory-stocks`)
  - `GET /api/v1/inventory-stocks`
  - `GET /api/v1/inventory-stocks/:id`
  - `POST /api/v1/inventory-stocks`
  - `PUT /api/v1/inventory-stocks/:id`
  - `DELETE /api/v1/inventory-stocks/:id`

- `11.9.4.3` Movement (`(main)/inventory/stock-movements`)
  - `GET /api/v1/stock-movements`
  - `GET /api/v1/stock-movements/:id`
  - `POST /api/v1/stock-movements`
  - `PUT /api/v1/stock-movements/:id`
  - `DELETE /api/v1/stock-movements/:id`

- `11.9.4.4` Supplier (`(main)/inventory/suppliers`)
  - `GET /api/v1/suppliers`
  - `GET /api/v1/suppliers/:id`
  - `POST /api/v1/suppliers`
  - `PUT /api/v1/suppliers/:id`
  - `DELETE /api/v1/suppliers/:id`

- `11.9.4.5` Purchase (`(main)/inventory/purchase-orders`)
  - `GET /api/v1/purchase-orders`
  - `GET /api/v1/purchase-orders/:id`
  - `POST /api/v1/purchase-orders`
  - `PUT /api/v1/purchase-orders/:id`
  - `DELETE /api/v1/purchase-orders/:id`

- `11.9.4.6` Receipt (`(main)/inventory/goods-receipts`)
  - `GET /api/v1/goods-receipts`
  - `GET /api/v1/goods-receipts/:id`
  - `POST /api/v1/goods-receipts`
  - `PUT /api/v1/goods-receipts/:id`
  - `DELETE /api/v1/goods-receipts/:id`

- `11.9.4.7` Adjustment (`(main)/inventory/stock-adjustments`)
  - `GET /api/v1/stock-adjustments`
  - `GET /api/v1/stock-adjustments/:id`
  - `POST /api/v1/stock-adjustments`
  - `PUT /api/v1/stock-adjustments/:id`
  - `DELETE /api/v1/stock-adjustments/:id`

Keep request/response fields strictly aligned with backend schema/validation rules.
Do not ship mock data, fake success states, or disconnected UI actions.
If backend intentionally lacks support for an action, expose read-only/informational UX and block unsupported writes.

All operations MUST match backend schema and endpoint behavior exactly.

---

## Constraints

Do NOT:

- Modify Tier 1, Tier 2, Tier 3, Tier 4, Tier 5, Tier 6, Tier 7, Tier 8, Tier 10, or Tier 11 screens/flows unless required by selected Tier 9 step(s)
- Change layout or routing architecture outside required Tier 9 route wiring
- Add global components or new platform patterns
- Invent backend fields, endpoints, or behaviors
- Implement screens outside selected Tier 9 step(s)

---

## Acceptance Criteria

- 100% rules compliance
- Existing layout patterns reused
- Backend-aligned functionality for selected Tier 9 step(s)
- Responsive UI with clear validation and feedback
- No nested scroll
- Screen(s) work independently and integrate with current main navigation
- Access control is enforced for actions and routes (including deep links)
- Accessibility is preserved for all states, including unauthorized/disabled states
- Selected Tier 9 flow can be completed without a manual
- Selected Tier 9 flow remains secure by default (no data leakage, no insecure shortcuts)
- All applicable features/actions are fully functional and backend-linked
- Unauthorized users cannot execute restricted actions via URL, keyboard, or direct API-triggering UI paths

---

## Deliverables

Return ONLY:

1. Screen/Page component(s) for selected Tier 9 step(s)
2. Form component(s) (if applicable)
3. API integration hook usage/updates (if applicable)
4. Validation logic (if applicable)
5. State handling logic
6. Loading + empty + error + offline UI
7. Success/failure feedback implementation
8. Navigation handlers
9. Backend contract alignment confirmation
10. Access control implementation confirmation (actions + routes)
11. Accessibility control confirmation for all states
12. Route-guard + navigation accessibility confirmation (keyboard/focus/blocked actions)
13. Action-to-backend linkage confirmation for all enabled features in selected screen(s)
14. Explicit note for any selected action intentionally read-only due to missing backend support

Do NOT include files or logic outside selected Tier 9 screen(s).