d00346c303a440b3386fe98816e8115f
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _react = _interopRequireDefault(require("react"));
var _reactNative = require("@testing-library/react-native");
var _reactTestRenderer = require("react-test-renderer");
var _useAsyncState = _interopRequireDefault(require("../../hooks/useAsyncState"));
var _jsxRuntime = require("react/jsx-runtime");
var TestComponent = function TestComponent(_ref) {
  var onResult = _ref.onResult;
  var api = (0, _useAsyncState.default)();
  _react.default.useEffect(function () {
    onResult(api);
  });
  return null;
};
describe('useAsyncState', function () {
  it('initial → start → succeed', (0, _asyncToGenerator2.default)(function* () {
    var api;
    (0, _reactNative.render)((0, _jsxRuntime.jsx)(TestComponent, {
      onResult: function onResult(v) {
        return api = v;
      }
    }));
    yield (0, _reactNative.waitFor)(function () {
      expect(api.isLoading).toBe(false);
      expect(api.errorCode).toBeNull();
      expect(api.data).toBeNull();
    });
    (0, _reactTestRenderer.act)(function () {
      api.start();
    });
    yield (0, _reactNative.waitFor)(function () {
      return expect(api.isLoading).toBe(true);
    });
    (0, _reactTestRenderer.act)(function () {
      api.succeed({
        ok: true
      });
    });
    yield (0, _reactNative.waitFor)(function () {
      expect(api.isLoading).toBe(false);
      expect(api.errorCode).toBeNull();
      expect(api.data).toEqual({
        ok: true
      });
    });
  }));
  it('initial → start → fail (stores error codes only)', (0, _asyncToGenerator2.default)(function* () {
    var api;
    (0, _reactNative.render)((0, _jsxRuntime.jsx)(TestComponent, {
      onResult: function onResult(v) {
        return api = v;
      }
    }));
    (0, _reactTestRenderer.act)(function () {
      api.start();
      api.fail('NETWORK_ERROR');
    });
    yield (0, _reactNative.waitFor)(function () {
      expect(api.isLoading).toBe(false);
      expect(api.errorCode).toBe('NETWORK_ERROR');
    });
    (0, _reactTestRenderer.act)(function () {
      api.fail({
        message: 'nope'
      });
    });
    yield (0, _reactNative.waitFor)(function () {
      expect(api.errorCode).toBe('UNKNOWN_ERROR');
    });
  }));
  it('fail → reset', (0, _asyncToGenerator2.default)(function* () {
    var api;
    (0, _reactNative.render)((0, _jsxRuntime.jsx)(TestComponent, {
      onResult: function onResult(v) {
        return api = v;
      }
    }));
    (0, _reactTestRenderer.act)(function () {
      api.start();
      api.fail('SERVER_ERROR');
    });
    yield (0, _reactNative.waitFor)(function () {
      return expect(api.errorCode).toBe('SERVER_ERROR');
    });
    (0, _reactTestRenderer.act)(function () {
      api.reset();
    });
    yield (0, _reactNative.waitFor)(function () {
      expect(api.isLoading).toBe(false);
      expect(api.errorCode).toBeNull();
      expect(api.data).toBeNull();
    });
  }));
  it('start() is idempotent and deterministic', (0, _asyncToGenerator2.default)(function* () {
    var api;
    (0, _reactNative.render)((0, _jsxRuntime.jsx)(TestComponent, {
      onResult: function onResult(v) {
        return api = v;
      }
    }));
    (0, _reactTestRenderer.act)(function () {
      api.start();
      api.start();
    });
    yield (0, _reactNative.waitFor)(function () {
      expect(api.isLoading).toBe(true);
      expect(api.errorCode).toBeNull();
    });
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9yZWFjdE5hdGl2ZSIsIl9yZWFjdFRlc3RSZW5kZXJlciIsIl91c2VBc3luY1N0YXRlIiwiX2pzeFJ1bnRpbWUiLCJUZXN0Q29tcG9uZW50IiwiX3JlZiIsIm9uUmVzdWx0IiwiYXBpIiwidXNlQXN5bmNTdGF0ZSIsIlJlYWN0IiwidXNlRWZmZWN0IiwiZGVzY3JpYmUiLCJpdCIsIl9hc3luY1RvR2VuZXJhdG9yMiIsImRlZmF1bHQiLCJyZW5kZXIiLCJqc3giLCJ2Iiwid2FpdEZvciIsImV4cGVjdCIsImlzTG9hZGluZyIsInRvQmUiLCJlcnJvckNvZGUiLCJ0b0JlTnVsbCIsImRhdGEiLCJhY3QiLCJzdGFydCIsInN1Y2NlZWQiLCJvayIsInRvRXF1YWwiLCJmYWlsIiwibWVzc2FnZSIsInJlc2V0Il0sInNvdXJjZXMiOlsidXNlQXN5bmNTdGF0ZS50ZXN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiB1c2VBc3luY1N0YXRlIEhvb2sgVGVzdHNcclxuICogRmlsZTogdXNlQXN5bmNTdGF0ZS50ZXN0LmpzXHJcbiAqL1xyXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgeyByZW5kZXIsIHdhaXRGb3IgfSBmcm9tICdAdGVzdGluZy1saWJyYXJ5L3JlYWN0LW5hdGl2ZSc7XHJcbmltcG9ydCB7IGFjdCB9IGZyb20gJ3JlYWN0LXRlc3QtcmVuZGVyZXInO1xyXG5pbXBvcnQgdXNlQXN5bmNTdGF0ZSBmcm9tICdAaG9va3MvdXNlQXN5bmNTdGF0ZSc7XHJcblxyXG5jb25zdCBUZXN0Q29tcG9uZW50ID0gKHsgb25SZXN1bHQgfSkgPT4ge1xyXG4gIGNvbnN0IGFwaSA9IHVzZUFzeW5jU3RhdGUoKTtcclxuICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgb25SZXN1bHQoYXBpKTtcclxuICB9KTtcclxuICByZXR1cm4gbnVsbDtcclxufTtcclxuXHJcbmRlc2NyaWJlKCd1c2VBc3luY1N0YXRlJywgKCkgPT4ge1xyXG4gIGl0KCdpbml0aWFsIOKGkiBzdGFydCDihpIgc3VjY2VlZCcsIGFzeW5jICgpID0+IHtcclxuICAgIGxldCBhcGk7XHJcbiAgICByZW5kZXIoPFRlc3RDb21wb25lbnQgb25SZXN1bHQ9eyh2KSA9PiAoYXBpID0gdil9IC8+KTtcclxuXHJcbiAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcclxuICAgICAgZXhwZWN0KGFwaS5pc0xvYWRpbmcpLnRvQmUoZmFsc2UpO1xyXG4gICAgICBleHBlY3QoYXBpLmVycm9yQ29kZSkudG9CZU51bGwoKTtcclxuICAgICAgZXhwZWN0KGFwaS5kYXRhKS50b0JlTnVsbCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgYWN0KCgpID0+IHtcclxuICAgICAgYXBpLnN0YXJ0KCk7XHJcbiAgICB9KTtcclxuICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4gZXhwZWN0KGFwaS5pc0xvYWRpbmcpLnRvQmUodHJ1ZSkpO1xyXG5cclxuICAgIGFjdCgoKSA9PiB7XHJcbiAgICAgIGFwaS5zdWNjZWVkKHsgb2s6IHRydWUgfSk7XHJcbiAgICB9KTtcclxuICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xyXG4gICAgICBleHBlY3QoYXBpLmlzTG9hZGluZykudG9CZShmYWxzZSk7XHJcbiAgICAgIGV4cGVjdChhcGkuZXJyb3JDb2RlKS50b0JlTnVsbCgpO1xyXG4gICAgICBleHBlY3QoYXBpLmRhdGEpLnRvRXF1YWwoeyBvazogdHJ1ZSB9KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBpdCgnaW5pdGlhbCDihpIgc3RhcnQg4oaSIGZhaWwgKHN0b3JlcyBlcnJvciBjb2RlcyBvbmx5KScsIGFzeW5jICgpID0+IHtcclxuICAgIGxldCBhcGk7XHJcbiAgICByZW5kZXIoPFRlc3RDb21wb25lbnQgb25SZXN1bHQ9eyh2KSA9PiAoYXBpID0gdil9IC8+KTtcclxuXHJcbiAgICBhY3QoKCkgPT4ge1xyXG4gICAgICBhcGkuc3RhcnQoKTtcclxuICAgICAgYXBpLmZhaWwoJ05FVFdPUktfRVJST1InKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xyXG4gICAgICBleHBlY3QoYXBpLmlzTG9hZGluZykudG9CZShmYWxzZSk7XHJcbiAgICAgIGV4cGVjdChhcGkuZXJyb3JDb2RlKS50b0JlKCdORVRXT1JLX0VSUk9SJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBhY3QoKCkgPT4ge1xyXG4gICAgICBhcGkuZmFpbCh7IG1lc3NhZ2U6ICdub3BlJyB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xyXG4gICAgICBleHBlY3QoYXBpLmVycm9yQ29kZSkudG9CZSgnVU5LTk9XTl9FUlJPUicpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCdmYWlsIOKGkiByZXNldCcsIGFzeW5jICgpID0+IHtcclxuICAgIGxldCBhcGk7XHJcbiAgICByZW5kZXIoPFRlc3RDb21wb25lbnQgb25SZXN1bHQ9eyh2KSA9PiAoYXBpID0gdil9IC8+KTtcclxuXHJcbiAgICBhY3QoKCkgPT4ge1xyXG4gICAgICBhcGkuc3RhcnQoKTtcclxuICAgICAgYXBpLmZhaWwoJ1NFUlZFUl9FUlJPUicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgYXdhaXQgd2FpdEZvcigoKSA9PiBleHBlY3QoYXBpLmVycm9yQ29kZSkudG9CZSgnU0VSVkVSX0VSUk9SJykpO1xyXG5cclxuICAgIGFjdCgoKSA9PiB7XHJcbiAgICAgIGFwaS5yZXNldCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XHJcbiAgICAgIGV4cGVjdChhcGkuaXNMb2FkaW5nKS50b0JlKGZhbHNlKTtcclxuICAgICAgZXhwZWN0KGFwaS5lcnJvckNvZGUpLnRvQmVOdWxsKCk7XHJcbiAgICAgIGV4cGVjdChhcGkuZGF0YSkudG9CZU51bGwoKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBpdCgnc3RhcnQoKSBpcyBpZGVtcG90ZW50IGFuZCBkZXRlcm1pbmlzdGljJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgbGV0IGFwaTtcclxuICAgIHJlbmRlcig8VGVzdENvbXBvbmVudCBvblJlc3VsdD17KHYpID0+IChhcGkgPSB2KX0gLz4pO1xyXG5cclxuICAgIGFjdCgoKSA9PiB7XHJcbiAgICAgIGFwaS5zdGFydCgpO1xyXG4gICAgICBhcGkuc3RhcnQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xyXG4gICAgICBleHBlY3QoYXBpLmlzTG9hZGluZykudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KGFwaS5lcnJvckNvZGUpLnRvQmVOdWxsKCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcblxyXG4iXSwibWFwcGluZ3MiOiI7O0FBSUEsSUFBQUEsTUFBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsWUFBQSxHQUFBRCxPQUFBO0FBQ0EsSUFBQUUsa0JBQUEsR0FBQUYsT0FBQTtBQUNBLElBQUFHLGNBQUEsR0FBQUosc0JBQUEsQ0FBQUMsT0FBQTtBQUFpRCxJQUFBSSxXQUFBLEdBQUFKLE9BQUE7QUFFakQsSUFBTUssYUFBYSxHQUFHLFNBQWhCQSxhQUFhQSxDQUFBQyxJQUFBLEVBQXFCO0VBQUEsSUFBZkMsUUFBUSxHQUFBRCxJQUFBLENBQVJDLFFBQVE7RUFDL0IsSUFBTUMsR0FBRyxHQUFHLElBQUFDLHNCQUFhLEVBQUMsQ0FBQztFQUMzQkMsY0FBSyxDQUFDQyxTQUFTLENBQUMsWUFBTTtJQUNwQkosUUFBUSxDQUFDQyxHQUFHLENBQUM7RUFDZixDQUFDLENBQUM7RUFDRixPQUFPLElBQUk7QUFDYixDQUFDO0FBRURJLFFBQVEsQ0FBQyxlQUFlLEVBQUUsWUFBTTtFQUM5QkMsRUFBRSxDQUFDLDJCQUEyQixNQUFBQyxrQkFBQSxDQUFBQyxPQUFBLEVBQUUsYUFBWTtJQUMx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