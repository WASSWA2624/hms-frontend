{"version":3,"names":["_getJestObj","mock","changePasswordUseCase","jest","fn","forgotPasswordUseCase","loginUseCase","registerUseCase","logoutUseCase","refreshSessionUseCase","loadCurrentUserUseCase","resendVerificationUseCase","resetPasswordUseCase","verifyEmailUseCase","verifyPhoneUseCase","_interopRequireDefault","require","default","_asyncToGenerator2","_toolkit","_auth","_auth2","_require","createStore","configureStore","reducer","auth","describe","beforeEach","mockResolvedValue","id","accessToken","refreshToken","verified","sent","reset","changed","it","store","dispatch","actions","login","email","password","tenant_id","expect","getState","isAuthenticated","toBe","register","user","toEqual","logout","toBeNull","refreshSession","loadCurrentUser","mockRejectedValueOnce","code","errorCode","verifyEmail","token","verifyPhone","phone","resendVerification","type","forgotPassword","resetPassword","new_password","confirm_password","changePassword","old_password","isLoading","state","lastUpdated","clearAuth","clearedError","clearAuthError"],"sources":["auth.slice.test.js"],"sourcesContent":["/**\r\n * Auth Slice Tests\r\n * File: auth.slice.test.js\r\n */\r\nimport { configureStore } from '@reduxjs/toolkit';\r\n\r\njest.mock('@features/auth', () => ({\r\n  changePasswordUseCase: jest.fn(),\r\n  forgotPasswordUseCase: jest.fn(),\r\n  loginUseCase: jest.fn(),\r\n  registerUseCase: jest.fn(),\r\n  logoutUseCase: jest.fn(),\r\n  refreshSessionUseCase: jest.fn(),\r\n  loadCurrentUserUseCase: jest.fn(),\r\n  resendVerificationUseCase: jest.fn(),\r\n  resetPasswordUseCase: jest.fn(),\r\n  verifyEmailUseCase: jest.fn(),\r\n  verifyPhoneUseCase: jest.fn(),\r\n}));\r\n\r\nimport { actions, reducer } from '@store/slices/auth.slice';\r\nimport {\r\n  loginUseCase,\r\n  registerUseCase,\r\n  logoutUseCase,\r\n  refreshSessionUseCase,\r\n  loadCurrentUserUseCase,\r\n  verifyEmailUseCase,\r\n  verifyPhoneUseCase,\r\n  resendVerificationUseCase,\r\n  forgotPasswordUseCase,\r\n  resetPasswordUseCase,\r\n  changePasswordUseCase,\r\n} from '@features/auth';\r\n\r\nconst createStore = () =>\r\n  configureStore({\r\n    reducer: {\r\n      auth: reducer,\r\n    },\r\n  });\r\n\r\ndescribe('auth.slice', () => {\r\n  beforeEach(() => {\r\n    loginUseCase.mockResolvedValue({ id: '1' });\r\n    registerUseCase.mockResolvedValue({ id: '2' });\r\n    logoutUseCase.mockResolvedValue(true);\r\n    refreshSessionUseCase.mockResolvedValue({ accessToken: 'a', refreshToken: 'b' });\r\n    loadCurrentUserUseCase.mockResolvedValue({ id: '3' });\r\n    verifyEmailUseCase.mockResolvedValue({ verified: true });\r\n    verifyPhoneUseCase.mockResolvedValue({ verified: true });\r\n    resendVerificationUseCase.mockResolvedValue({ sent: true });\r\n    forgotPasswordUseCase.mockResolvedValue({ sent: true });\r\n    resetPasswordUseCase.mockResolvedValue({ reset: true });\r\n    changePasswordUseCase.mockResolvedValue({ changed: true });\r\n  });\r\n\r\n  it('handles login/register/logout flows', async () => {\r\n    const store = createStore();\r\n    await store.dispatch(actions.login({\r\n      email: 'user@example.com',\r\n      password: 'pass',\r\n      tenant_id: '550e8400-e29b-41d4-a716-446655440000'\r\n    }));\r\n    expect(store.getState().auth.isAuthenticated).toBe(true);\r\n    await store.dispatch(actions.register({ email: 'user' }));\r\n    expect(store.getState().auth.user).toEqual({ id: '2' });\r\n    await store.dispatch(actions.logout());\r\n    expect(store.getState().auth.user).toBeNull();\r\n  });\r\n\r\n  it('handles refresh and load current user', async () => {\r\n    const store = createStore();\r\n    await store.dispatch(actions.refreshSession());\r\n    expect(store.getState().auth.isAuthenticated).toBe(true);\r\n    await store.dispatch(actions.loadCurrentUser());\r\n    expect(store.getState().auth.user).toEqual({ id: '3' });\r\n  });\r\n\r\n  it('stores error codes on failures', async () => {\r\n    const store = createStore();\r\n    loginUseCase.mockRejectedValueOnce({ code: 'UNAUTHORIZED' });\r\n    await store.dispatch(actions.login({\r\n      email: 'user@example.com',\r\n      password: 'pass',\r\n      tenant_id: '550e8400-e29b-41d4-a716-446655440000'\r\n    }));\r\n    expect(store.getState().auth.errorCode).toBe('UNAUTHORIZED');\r\n  });\r\n\r\n  it('handles verification and password flows', async () => {\r\n    const store = createStore();\r\n    await store.dispatch(actions.verifyEmail({ token: 'token' }));\r\n    await store.dispatch(actions.verifyPhone({ token: 'token', phone: '1234567890' }));\r\n    await store.dispatch(actions.resendVerification({ type: 'email', email: 'user@example.com' }));\r\n    await store.dispatch(actions.forgotPassword({ email: 'user@example.com', tenant_id: 'tenant' }));\r\n    await store.dispatch(actions.resetPassword({ token: 'token', new_password: 'Pass123!', confirm_password: 'Pass123!' }));\r\n    await store.dispatch(actions.changePassword({ old_password: 'Pass123!', new_password: 'Pass456!', confirm_password: 'Pass456!' }));\r\n    expect(store.getState().auth.isLoading).toBe(false);\r\n    expect(store.getState().auth.errorCode).toBeNull();\r\n  });\r\n\r\n  it('stores error codes on verification failures', async () => {\r\n    const store = createStore();\r\n    verifyEmailUseCase.mockRejectedValueOnce({ code: 'FORBIDDEN' });\r\n    await store.dispatch(actions.verifyEmail({ token: 'token' }));\r\n    expect(store.getState().auth.errorCode).toBe('FORBIDDEN');\r\n  });\r\n\r\n  it('clears auth state', () => {\r\n    const state = reducer(\r\n      { user: { id: '1' }, isAuthenticated: true, isLoading: false, errorCode: 'ERROR', lastUpdated: null },\r\n      actions.clearAuth()\r\n    );\r\n    expect(state.user).toBeNull();\r\n    expect(state.isAuthenticated).toBe(false);\r\n    const clearedError = reducer(state, actions.clearAuthError());\r\n    expect(clearedError.errorCode).toBeNull();\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}