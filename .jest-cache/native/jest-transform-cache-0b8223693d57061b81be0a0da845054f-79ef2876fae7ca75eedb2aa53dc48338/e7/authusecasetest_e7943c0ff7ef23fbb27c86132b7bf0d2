9f6b63a179967636395d0d4dc6ea2362
_getJestObj().mock("../../../features/auth/auth.api", function () {
  return {
    loginApi: jest.fn(),
    logoutApi: jest.fn(),
    refreshApi: jest.fn(),
    registerApi: jest.fn(),
    getCurrentUserApi: jest.fn(),
    verifyEmailApi: jest.fn(),
    verifyPhoneApi: jest.fn(),
    resendVerificationApi: jest.fn(),
    forgotPasswordApi: jest.fn(),
    resetPasswordApi: jest.fn(),
    changePasswordApi: jest.fn()
  };
});
_getJestObj().mock("../../../security", function () {
  return {
    tokenManager: {
      setTokens: jest.fn(),
      clearTokens: jest.fn(),
      getRefreshToken: jest.fn()
    }
  };
});
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _auth = require("../../../features/auth");
var _security = require("../../../security");
var _auth2 = require("../../../features/auth/auth.api");
function _getJestObj() {
  var _require = require("@jest/globals"),
    jest = _require.jest;
  _getJestObj = function _getJestObj() {
    return jest;
  };
  return jest;
}
describe('auth.usecase', function () {
  beforeEach(function () {
    _auth2.loginApi.mockResolvedValue({
      data: {
        user: {
          id: '1'
        },
        tokens: {
          accessToken: 'a',
          refreshToken: 'b'
        }
      }
    });
    _auth2.registerApi.mockResolvedValue({
      data: {
        user: {
          id: '2'
        }
      }
    });
    _auth2.logoutApi.mockResolvedValue({
      data: {}
    });
    _auth2.refreshApi.mockResolvedValue({
      data: {
        tokens: {
          accessToken: 'a',
          refreshToken: 'b'
        }
      }
    });
    _auth2.getCurrentUserApi.mockResolvedValue({
      data: {
        user: {
          id: '3'
        }
      }
    });
    _security.tokenManager.setTokens.mockResolvedValue(true);
    _security.tokenManager.clearTokens.mockResolvedValue(true);
    _security.tokenManager.getRefreshToken.mockResolvedValue('refresh');
  });
  it('logs in and stores tokens', (0, _asyncToGenerator2.default)(function* () {
    var user = yield (0, _auth.loginUseCase)({
      email: 'user',
      password: 'pass'
    });
    expect(user).toEqual({
      id: '1'
    });
    expect(_security.tokenManager.setTokens).toHaveBeenCalledWith('a', 'b');
  }));
  it('registers and loads current user', (0, _asyncToGenerator2.default)(function* () {
    var user = yield (0, _auth.registerUseCase)({
      email: 'user'
    });
    expect(user).toEqual({
      id: '2'
    });
    var current = yield (0, _auth.loadCurrentUserUseCase)();
    expect(current).toEqual({
      id: '3'
    });
  }));
  it('refreshes session and logs out', (0, _asyncToGenerator2.default)(function* () {
    var tokens = yield (0, _auth.refreshSessionUseCase)();
    expect(tokens).toEqual({
      accessToken: 'a',
      refreshToken: 'b'
    });
    yield (0, _auth.logoutUseCase)();
    expect(_security.tokenManager.clearTokens).toHaveBeenCalled();
  }));
  it('throws normalized errors', (0, _asyncToGenerator2.default)(function* () {
    _auth2.loginApi.mockRejectedValueOnce({
      code: 'UNAUTHORIZED'
    });
    yield expect((0, _auth.loginUseCase)({
      email: 'user',
      password: 'pass'
    })).rejects.toMatchObject({
      code: 'UNAUTHORIZED'
    });
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZ2V0SmVzdE9iaiIsIm1vY2siLCJsb2dpbkFwaSIsImplc3QiLCJmbiIsImxvZ291dEFwaSIsInJlZnJlc2hBcGkiLCJyZWdpc3RlckFwaSIsImdldEN1cnJlbnRVc2VyQXBpIiwidmVyaWZ5RW1haWxBcGkiLCJ2ZXJpZnlQaG9uZUFwaSIsInJlc2VuZFZlcmlmaWNhdGlvbkFwaSIsImZvcmdvdFBhc3N3b3JkQXBpIiwicmVzZXRQYXNzd29yZEFwaSIsImNoYW5nZVBhc3N3b3JkQXBpIiwidG9rZW5NYW5hZ2VyIiwic2V0VG9rZW5zIiwiY2xlYXJUb2tlbnMiLCJnZXRSZWZyZXNoVG9rZW4iLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsImRlZmF1bHQiLCJfYXN5bmNUb0dlbmVyYXRvcjIiLCJfYXV0aCIsIl9zZWN1cml0eSIsIl9hdXRoMiIsIl9yZXF1aXJlIiwiZGVzY3JpYmUiLCJiZWZvcmVFYWNoIiwibW9ja1Jlc29sdmVkVmFsdWUiLCJkYXRhIiwidXNlciIsImlkIiwidG9rZW5zIiwiYWNjZXNzVG9rZW4iLCJyZWZyZXNoVG9rZW4iLCJpdCIsImxvZ2luVXNlQ2FzZSIsImVtYWlsIiwicGFzc3dvcmQiLCJleHBlY3QiLCJ0b0VxdWFsIiwidG9IYXZlQmVlbkNhbGxlZFdpdGgiLCJyZWdpc3RlclVzZUNhc2UiLCJjdXJyZW50IiwibG9hZEN1cnJlbnRVc2VyVXNlQ2FzZSIsInJlZnJlc2hTZXNzaW9uVXNlQ2FzZSIsImxvZ291dFVzZUNhc2UiLCJ0b0hhdmVCZWVuQ2FsbGVkIiwibW9ja1JlamVjdGVkVmFsdWVPbmNlIiwiY29kZSIsInJlamVjdHMiLCJ0b01hdGNoT2JqZWN0Il0sInNvdXJjZXMiOlsiYXV0aC51c2VjYXNlLnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEF1dGggVXNlIENhc2UgVGVzdHNcclxuICogRmlsZTogYXV0aC51c2VjYXNlLnRlc3QuanNcclxuICovXHJcbmltcG9ydCB7XHJcbiAgbG9naW5Vc2VDYXNlLFxyXG4gIGxvZ291dFVzZUNhc2UsXHJcbiAgcmVmcmVzaFNlc3Npb25Vc2VDYXNlLFxyXG4gIHJlZ2lzdGVyVXNlQ2FzZSxcclxuICBsb2FkQ3VycmVudFVzZXJVc2VDYXNlLFxyXG59IGZyb20gJ0BmZWF0dXJlcy9hdXRoJztcclxuaW1wb3J0IHsgdG9rZW5NYW5hZ2VyIH0gZnJvbSAnQHNlY3VyaXR5JztcclxuaW1wb3J0IHtcclxuICBsb2dpbkFwaSxcclxuICBsb2dvdXRBcGksXHJcbiAgcmVmcmVzaEFwaSxcclxuICByZWdpc3RlckFwaSxcclxuICBnZXRDdXJyZW50VXNlckFwaSxcclxufSBmcm9tICdAZmVhdHVyZXMvYXV0aC9hdXRoLmFwaSc7XHJcblxyXG5qZXN0Lm1vY2soJ0BmZWF0dXJlcy9hdXRoL2F1dGguYXBpJywgKCkgPT4gKHtcclxuICBsb2dpbkFwaTogamVzdC5mbigpLFxyXG4gIGxvZ291dEFwaTogamVzdC5mbigpLFxyXG4gIHJlZnJlc2hBcGk6IGplc3QuZm4oKSxcclxuICByZWdpc3RlckFwaTogamVzdC5mbigpLFxyXG4gIGdldEN1cnJlbnRVc2VyQXBpOiBqZXN0LmZuKCksXHJcbiAgdmVyaWZ5RW1haWxBcGk6IGplc3QuZm4oKSxcclxuICB2ZXJpZnlQaG9uZUFwaTogamVzdC5mbigpLFxyXG4gIHJlc2VuZFZlcmlmaWNhdGlvbkFwaTogamVzdC5mbigpLFxyXG4gIGZvcmdvdFBhc3N3b3JkQXBpOiBqZXN0LmZuKCksXHJcbiAgcmVzZXRQYXNzd29yZEFwaTogamVzdC5mbigpLFxyXG4gIGNoYW5nZVBhc3N3b3JkQXBpOiBqZXN0LmZuKCksXHJcbn0pKTtcclxuXHJcbmplc3QubW9jaygnQHNlY3VyaXR5JywgKCkgPT4gKHtcclxuICB0b2tlbk1hbmFnZXI6IHtcclxuICAgIHNldFRva2VuczogamVzdC5mbigpLFxyXG4gICAgY2xlYXJUb2tlbnM6IGplc3QuZm4oKSxcclxuICAgIGdldFJlZnJlc2hUb2tlbjogamVzdC5mbigpLFxyXG4gIH0sXHJcbn0pKTtcclxuXHJcbmRlc2NyaWJlKCdhdXRoLnVzZWNhc2UnLCAoKSA9PiB7XHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBsb2dpbkFwaS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6IHsgdXNlcjogeyBpZDogJzEnIH0sIHRva2VuczogeyBhY2Nlc3NUb2tlbjogJ2EnLCByZWZyZXNoVG9rZW46ICdiJyB9IH0gfSk7XHJcbiAgICByZWdpc3RlckFwaS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6IHsgdXNlcjogeyBpZDogJzInIH0gfSB9KTtcclxuICAgIGxvZ291dEFwaS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6IHt9IH0pO1xyXG4gICAgcmVmcmVzaEFwaS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6IHsgdG9rZW5zOiB7IGFjY2Vzc1Rva2VuOiAnYScsIHJlZnJlc2hUb2tlbjogJ2InIH0gfSB9KTtcclxuICAgIGdldEN1cnJlbnRVc2VyQXBpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZGF0YTogeyB1c2VyOiB7IGlkOiAnMycgfSB9IH0pO1xyXG4gICAgdG9rZW5NYW5hZ2VyLnNldFRva2Vucy5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKTtcclxuICAgIHRva2VuTWFuYWdlci5jbGVhclRva2Vucy5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKTtcclxuICAgIHRva2VuTWFuYWdlci5nZXRSZWZyZXNoVG9rZW4ubW9ja1Jlc29sdmVkVmFsdWUoJ3JlZnJlc2gnKTtcclxuICB9KTtcclxuXHJcbiAgaXQoJ2xvZ3MgaW4gYW5kIHN0b3JlcyB0b2tlbnMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgbG9naW5Vc2VDYXNlKHsgZW1haWw6ICd1c2VyJywgcGFzc3dvcmQ6ICdwYXNzJyB9KTtcclxuICAgIGV4cGVjdCh1c2VyKS50b0VxdWFsKHsgaWQ6ICcxJyB9KTtcclxuICAgIGV4cGVjdCh0b2tlbk1hbmFnZXIuc2V0VG9rZW5zKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnYScsICdiJyk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCdyZWdpc3RlcnMgYW5kIGxvYWRzIGN1cnJlbnQgdXNlcicsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCByZWdpc3RlclVzZUNhc2UoeyBlbWFpbDogJ3VzZXInIH0pO1xyXG4gICAgZXhwZWN0KHVzZXIpLnRvRXF1YWwoeyBpZDogJzInIH0pO1xyXG4gICAgY29uc3QgY3VycmVudCA9IGF3YWl0IGxvYWRDdXJyZW50VXNlclVzZUNhc2UoKTtcclxuICAgIGV4cGVjdChjdXJyZW50KS50b0VxdWFsKHsgaWQ6ICczJyB9KTtcclxuICB9KTtcclxuXHJcbiAgaXQoJ3JlZnJlc2hlcyBzZXNzaW9uIGFuZCBsb2dzIG91dCcsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IHRva2VucyA9IGF3YWl0IHJlZnJlc2hTZXNzaW9uVXNlQ2FzZSgpO1xyXG4gICAgZXhwZWN0KHRva2VucykudG9FcXVhbCh7IGFjY2Vzc1Rva2VuOiAnYScsIHJlZnJlc2hUb2tlbjogJ2InIH0pO1xyXG4gICAgYXdhaXQgbG9nb3V0VXNlQ2FzZSgpO1xyXG4gICAgZXhwZWN0KHRva2VuTWFuYWdlci5jbGVhclRva2VucykudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gIH0pO1xyXG5cclxuICBpdCgndGhyb3dzIG5vcm1hbGl6ZWQgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgbG9naW5BcGkubW9ja1JlamVjdGVkVmFsdWVPbmNlKHsgY29kZTogJ1VOQVVUSE9SSVpFRCcgfSk7XHJcbiAgICBhd2FpdCBleHBlY3QobG9naW5Vc2VDYXNlKHsgZW1haWw6ICd1c2VyJywgcGFzc3dvcmQ6ICdwYXNzJyB9KSkucmVqZWN0cy50b01hdGNoT2JqZWN0KHtcclxuICAgICAgY29kZTogJ1VOQVVUSE9SSVpFRCcsXHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcbiJdLCJtYXBwaW5ncyI6IkFBb0JBQSxXQUFBLEdBQUtDLElBQUks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