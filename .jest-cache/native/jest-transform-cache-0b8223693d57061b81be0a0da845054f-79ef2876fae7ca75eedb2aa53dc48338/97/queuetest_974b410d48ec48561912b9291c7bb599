baea4be6c6aa8dcacb2058ab2cc9e8d2
_getJestObj().mock("../../services/storage", function () {
  return {
    async: {
      getItem: jest.fn(),
      setItem: jest.fn(),
      removeItem: jest.fn()
    }
  };
});
_getJestObj().mock("../../security", function () {
  return {
    encryption: {
      encrypt: jest.fn(),
      decrypt: jest.fn()
    }
  };
});
_getJestObj().mock("../../errors", function () {
  return {
    handleError: jest.fn()
  };
});
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _errors = require("../../errors");
var _security = require("../../security");
var _storage = require("../../services/storage");
var _queue = require("../../offline/queue");
function _getJestObj() {
  var _require = require("@jest/globals"),
    jest = _require.jest;
  _getJestObj = function _getJestObj() {
    return jest;
  };
  return jest;
}
describe('Offline Queue', function () {
  beforeEach(function () {
    jest.clearAllMocks();
    _storage.async.getItem.mockResolvedValue(null);
    _storage.async.setItem.mockResolvedValue(true);
    _storage.async.removeItem.mockResolvedValue(true);
    _security.encryption.encrypt.mockResolvedValue('encrypted');
    _security.encryption.decrypt.mockResolvedValue('[]');
  });
  describe('getQueue', function () {
    it('returns [] when nothing is stored', (0, _asyncToGenerator2.default)(function* () {
      _storage.async.getItem.mockResolvedValue(null);
      yield expect((0, _queue.getQueue)()).resolves.toEqual([]);
    }));
    it('decrypts stored string and returns parsed array', (0, _asyncToGenerator2.default)(function* () {
      _storage.async.getItem.mockResolvedValue('ciphertext');
      _security.encryption.decrypt.mockResolvedValue(JSON.stringify([{
        id: '1',
        url: '/x'
      }]));
      var queue = yield (0, _queue.getQueue)();
      expect(_security.encryption.decrypt).toHaveBeenCalledWith('ciphertext');
      expect(queue).toEqual([{
        id: '1',
        url: '/x'
      }]);
    }));
    it('returns [] and clears storage when decryption fails', (0, _asyncToGenerator2.default)(function* () {
      _storage.async.getItem.mockResolvedValue('ciphertext');
      _security.encryption.decrypt.mockRejectedValue(new Error('ENCRYPTION_NOT_IMPLEMENTED'));
      var queue = yield (0, _queue.getQueue)();
      expect(queue).toEqual([]);
      expect(_errors.handleError).toHaveBeenCalled();
      expect(_storage.async.removeItem).toHaveBeenCalledWith('offline_queue');
    }));
    it('returns [] and clears storage on corrupted decrypted JSON', (0, _asyncToGenerator2.default)(function* () {
      _storage.async.getItem.mockResolvedValue('ciphertext');
      _security.encryption.decrypt.mockResolvedValue('not-json');
      var queue = yield (0, _queue.getQueue)();
      expect(queue).toEqual([]);
      expect(_errors.handleError).toHaveBeenCalled();
      expect(_storage.async.removeItem).toHaveBeenCalledWith('offline_queue');
    }));
    it('migrates legacy unencrypted array by encrypting and re-saving', (0, _asyncToGenerator2.default)(function* () {
      var legacy = [{
        id: '1',
        url: '/legacy'
      }];
      _storage.async.getItem.mockResolvedValue(legacy);
      _security.encryption.encrypt.mockResolvedValue('encrypted-legacy');
      var queue = yield (0, _queue.getQueue)();
      expect(queue).toEqual(legacy);
      expect(_security.encryption.encrypt).toHaveBeenCalledWith(JSON.stringify(legacy));
      expect(_storage.async.setItem).toHaveBeenCalledWith('offline_queue', 'encrypted-legacy');
    }));
    it('clears legacy unencrypted array if encryption is unavailable', (0, _asyncToGenerator2.default)(function* () {
      var legacy = [{
        id: '1',
        url: '/legacy'
      }];
      _storage.async.getItem.mockResolvedValue(legacy);
      _security.encryption.encrypt.mockRejectedValue(new Error('ENCRYPTION_NOT_IMPLEMENTED'));
      var queue = yield (0, _queue.getQueue)();
      expect(queue).toEqual([]);
      expect(_storage.async.removeItem).toHaveBeenCalledWith('offline_queue');
    }));
  });
  describe('addToQueue', function () {
    it('adds request with id/timestamp and persists encrypted', (0, _asyncToGenerator2.default)(function* () {
      jest.spyOn(Date, 'now').mockReturnValue(12345);
      _storage.async.getItem.mockResolvedValue(null);
      _security.encryption.decrypt.mockResolvedValue('[]');
      _security.encryption.encrypt.mockResolvedValue('encrypted-new');
      var ok = yield (0, _queue.addToQueue)({
        url: '/api/test',
        method: 'POST'
      });
      expect(ok).toBe(true);
      expect(_security.encryption.encrypt).toHaveBeenCalledWith(JSON.stringify([{
        url: '/api/test',
        method: 'POST',
        id: '12345',
        timestamp: 12345
      }]));
      expect(_storage.async.setItem).toHaveBeenCalledWith('offline_queue', 'encrypted-new');
      Date.now.mockRestore();
    }));
    it('fails safely (returns false) when encryption fails and does not persist plaintext', (0, _asyncToGenerator2.default)(function* () {
      _storage.async.getItem.mockResolvedValue(null);
      _security.encryption.decrypt.mockResolvedValue('[]');
      _security.encryption.encrypt.mockRejectedValue(new Error('ENCRYPTION_NOT_IMPLEMENTED'));
      var ok = yield (0, _queue.addToQueue)({
        url: '/api/test',
        method: 'POST'
      });
      expect(ok).toBe(false);
      expect(_storage.async.setItem).not.toHaveBeenCalled();
      expect(_errors.handleError).toHaveBeenCalled();
    }));
  });
  describe('removeFromQueue', function () {
    it('removes item by id and persists encrypted', (0, _asyncToGenerator2.default)(function* () {
      _storage.async.getItem.mockResolvedValue('ciphertext');
      _security.encryption.decrypt.mockResolvedValue(JSON.stringify([{
        id: '1',
        url: '/a'
      }, {
        id: '2',
        url: '/b'
      }]));
      _security.encryption.encrypt.mockResolvedValue('encrypted-filtered');
      var ok = yield (0, _queue.removeFromQueue)('2');
      expect(ok).toBe(true);
      expect(_security.encryption.encrypt).toHaveBeenCalledWith(JSON.stringify([{
        id: '1',
        url: '/a'
      }]));
      expect(_storage.async.setItem).toHaveBeenCalledWith('offline_queue', 'encrypted-filtered');
    }));
  });
  describe('clearQueue', function () {
    it('removes the queue key', (0, _asyncToGenerator2.default)(function* () {
      var ok = yield (0, _queue.clearQueue)();
      expect(ok).toBe(true);
      expect(_storage.async.removeItem).toHaveBeenCalledWith('offline_queue');
    }));
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZ2V0SmVzdE9iaiIsIm1vY2siLCJhc3luYyIsImdldEl0ZW0iLCJqZXN0IiwiZm4iLCJzZXRJdGVtIiwicmVtb3ZlSXRlbSIsImVuY3J5cHRpb24iLCJlbmNyeXB0IiwiZGVjcnlwdCIsImhhbmRsZUVycm9yIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJkZWZhdWx0IiwiX2FzeW5jVG9HZW5lcmF0b3IyIiwiX2Vycm9ycyIsIl9zZWN1cml0eSIsIl9zdG9yYWdlIiwiX3F1ZXVlIiwiX3JlcXVpcmUiLCJkZXNjcmliZSIsImJlZm9yZUVhY2giLCJjbGVhckFsbE1vY2tzIiwiYXN5bmNTdG9yYWdlIiwibW9ja1Jlc29sdmVkVmFsdWUiLCJpdCIsImV4cGVjdCIsImdldFF1ZXVlIiwicmVzb2x2ZXMiLCJ0b0VxdWFsIiwiSlNPTiIsInN0cmluZ2lmeSIsImlkIiwidXJsIiwicXVldWUiLCJ0b0hhdmVCZWVuQ2FsbGVkV2l0aCIsIm1vY2tSZWplY3RlZFZhbHVlIiwiRXJyb3IiLCJ0b0hhdmVCZWVuQ2FsbGVkIiwibGVnYWN5Iiwic3B5T24iLCJEYXRlIiwibW9ja1JldHVyblZhbHVlIiwib2siLCJhZGRUb1F1ZXVlIiwibWV0aG9kIiwidG9CZSIsInRpbWVzdGFtcCIsIm5vdyIsIm1vY2tSZXN0b3JlIiwibm90IiwicmVtb3ZlRnJvbVF1ZXVlIiwiY2xlYXJRdWV1ZSJdLCJzb3VyY2VzIjpbInF1ZXVlLnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIE9mZmxpbmUgUXVldWUgVGVzdHNcclxuICogRmlsZTogcXVldWUudGVzdC5qc1xyXG4gKi9cclxuaW1wb3J0IHsgaGFuZGxlRXJyb3IgfSBmcm9tICdAZXJyb3JzJztcclxuaW1wb3J0IHsgZW5jcnlwdGlvbiB9IGZyb20gJ0BzZWN1cml0eSc7XHJcbmltcG9ydCB7IGFzeW5jIGFzIGFzeW5jU3RvcmFnZSB9IGZyb20gJ0BzZXJ2aWNlcy9zdG9yYWdlJztcclxuaW1wb3J0IHsgYWRkVG9RdWV1ZSwgY2xlYXJRdWV1ZSwgZ2V0UXVldWUsIHJlbW92ZUZyb21RdWV1ZSB9IGZyb20gJ0BvZmZsaW5lL3F1ZXVlJztcclxuXHJcbmplc3QubW9jaygnQHNlcnZpY2VzL3N0b3JhZ2UnLCAoKSA9PiAoe1xyXG4gIGFzeW5jOiB7XHJcbiAgICBnZXRJdGVtOiBqZXN0LmZuKCksXHJcbiAgICBzZXRJdGVtOiBqZXN0LmZuKCksXHJcbiAgICByZW1vdmVJdGVtOiBqZXN0LmZuKCksXHJcbiAgfSxcclxufSkpO1xyXG5cclxuamVzdC5tb2NrKCdAc2VjdXJpdHknLCAoKSA9PiAoe1xyXG4gIGVuY3J5cHRpb246IHtcclxuICAgIGVuY3J5cHQ6IGplc3QuZm4oKSxcclxuICAgIGRlY3J5cHQ6IGplc3QuZm4oKSxcclxuICB9LFxyXG59KSk7XHJcblxyXG5qZXN0Lm1vY2soJ0BlcnJvcnMnLCAoKSA9PiAoe1xyXG4gIGhhbmRsZUVycm9yOiBqZXN0LmZuKCksXHJcbn0pKTtcclxuXHJcbmRlc2NyaWJlKCdPZmZsaW5lIFF1ZXVlJywgKCkgPT4ge1xyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgICBhc3luY1N0b3JhZ2UuZ2V0SXRlbS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcclxuICAgIGFzeW5jU3RvcmFnZS5zZXRJdGVtLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xyXG4gICAgYXN5bmNTdG9yYWdlLnJlbW92ZUl0ZW0ubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XHJcblxyXG4gICAgZW5jcnlwdGlvbi5lbmNyeXB0Lm1vY2tSZXNvbHZlZFZhbHVlKCdlbmNyeXB0ZWQnKTtcclxuICAgIGVuY3J5cHRpb24uZGVjcnlwdC5tb2NrUmVzb2x2ZWRWYWx1ZSgnW10nKTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2dldFF1ZXVlJywgKCkgPT4ge1xyXG4gICAgaXQoJ3JldHVybnMgW10gd2hlbiBub3RoaW5nIGlzIHN0b3JlZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgYXN5bmNTdG9yYWdlLmdldEl0ZW0ubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XHJcbiAgICAgIGF3YWl0IGV4cGVjdChnZXRRdWV1ZSgpKS5yZXNvbHZlcy50b0VxdWFsKFtdKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZWNyeXB0cyBzdG9yZWQgc3RyaW5nIGFuZCByZXR1cm5zIHBhcnNlZCBhcnJheScsIGFzeW5jICgpID0+IHtcclxuICAgICAgYXN5bmNTdG9yYWdlLmdldEl0ZW0ubW9ja1Jlc29sdmVkVmFsdWUoJ2NpcGhlcnRleHQnKTtcclxuICAgICAgZW5jcnlwdGlvbi5kZWNyeXB0Lm1vY2tSZXNvbHZlZFZhbHVlKEpTT04uc3RyaW5naWZ5KFt7IGlkOiAnMScsIHVybDogJy94JyB9XSkpO1xyXG5cclxuICAgICAgY29uc3QgcXVldWUgPSBhd2FpdCBnZXRRdWV1ZSgpO1xyXG5cclxuICAgICAgZXhwZWN0KGVuY3J5cHRpb24uZGVjcnlwdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2NpcGhlcnRleHQnKTtcclxuICAgICAgZXhwZWN0KHF1ZXVlKS50b0VxdWFsKFt7IGlkOiAnMScsIHVybDogJy94JyB9XSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgncmV0dXJucyBbXSBhbmQgY2xlYXJzIHN0b3JhZ2Ugd2hlbiBkZWNyeXB0aW9uIGZhaWxzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBhc3luY1N0b3JhZ2UuZ2V0SXRlbS5tb2NrUmVzb2x2ZWRWYWx1ZSgnY2lwaGVydGV4dCcpO1xyXG4gICAgICBlbmNyeXB0aW9uLmRlY3J5cHQubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdFTkNSWVBUSU9OX05PVF9JTVBMRU1FTlRFRCcpKTtcclxuXHJcbiAgICAgIGNvbnN0IHF1ZXVlID0gYXdhaXQgZ2V0UXVldWUoKTtcclxuXHJcbiAgICAgIGV4cGVjdChxdWV1ZSkudG9FcXVhbChbXSk7XHJcbiAgICAgIGV4cGVjdChoYW5kbGVFcnJvcikudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICBleHBlY3QoYXN5bmNTdG9yYWdlLnJlbW92ZUl0ZW0pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdvZmZsaW5lX3F1ZXVlJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgncmV0dXJucyBbXSBhbmQgY2xlYXJzIHN0b3JhZ2Ugb24gY29ycnVwdGVkIGRlY3J5cHRlZCBKU09OJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBhc3luY1N0b3JhZ2UuZ2V0SXRlbS5tb2NrUmVzb2x2ZWRWYWx1ZSgnY2lwaGVydGV4dCcpO1xyXG4gICAgICBlbmNyeXB0aW9uLmRlY3J5cHQubW9ja1Jlc29sdmVkVmFsdWUoJ25vdC1qc29uJyk7XHJcblxyXG4gICAgICBjb25zdCBxdWV1ZSA9IGF3YWl0IGdldFF1ZXVlKCk7XHJcblxyXG4gICAgICBleHBlY3QocXVldWUpLnRvRXF1YWwoW10pO1xyXG4gICAgICBleHBlY3QoaGFuZGxlRXJyb3IpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgICAgZXhwZWN0KGFzeW5jU3RvcmFnZS5yZW1vdmVJdGVtKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnb2ZmbGluZV9xdWV1ZScpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ21pZ3JhdGVzIGxlZ2FjeSB1bmVuY3J5cHRlZCBhcnJheSBieSBlbmNyeXB0aW5nIGFuZCByZS1zYXZpbmcnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGxlZ2FjeSA9IFt7IGlkOiAnMScsIHVybDogJy9sZWdhY3knIH1dO1xyXG4gICAgICBhc3luY1N0b3JhZ2UuZ2V0SXRlbS5tb2NrUmVzb2x2ZWRWYWx1ZShsZWdhY3kpO1xyXG4gICAgICBlbmNyeXB0aW9uLmVuY3J5cHQubW9ja1Jlc29sdmVkVmFsdWUoJ2VuY3J5cHRlZC1sZWdhY3knKTtcclxuXHJcbiAgICAgIGNvbnN0IHF1ZXVlID0gYXdhaXQgZ2V0UXVldWUoKTtcclxuXHJcbiAgICAgIGV4cGVjdChxdWV1ZSkudG9FcXVhbChsZWdhY3kpO1xyXG4gICAgICBleHBlY3QoZW5jcnlwdGlvbi5lbmNyeXB0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChKU09OLnN0cmluZ2lmeShsZWdhY3kpKTtcclxuICAgICAgZXhwZWN0KGFzeW5jU3RvcmFnZS5zZXRJdGVtKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnb2ZmbGluZV9xdWV1ZScsICdlbmNyeXB0ZWQtbGVnYWN5Jyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnY2xlYXJzIGxlZ2FjeSB1bmVuY3J5cHRlZCBhcnJheSBpZiBlbmNyeXB0aW9uIGlzIHVuYXZhaWxhYmxlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBsZWdhY3kgPSBbeyBpZDogJzEnLCB1cmw6ICcvbGVnYWN5JyB9XTtcclxuICAgICAgYXN5bmNTdG9yYWdlLmdldEl0ZW0ubW9ja1Jlc29sdmVkVmFsdWUobGVnYWN5KTtcclxuICAgICAgZW5jcnlwdGlvbi5lbmNyeXB0Lm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignRU5DUllQVElPTl9OT1RfSU1QTEVNRU5URUQnKSk7XHJcblxyXG4gICAgICBjb25zdCBxdWV1ZSA9IGF3YWl0IGdldFF1ZXVlKCk7XHJcblxyXG4gICAgICBleHBlY3QocXVldWUpLnRvRXF1YWwoW10pO1xyXG4gICAgICBleHBlY3QoYXN5bmNTdG9yYWdlLnJlbW92ZUl0ZW0pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdvZmZsaW5lX3F1ZXVlJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2FkZFRvUXVldWUnLCAoKSA9PiB7XHJcbiAgICBpdCgnYWRkcyByZXF1ZXN0IHdpdGggaWQvdGltZXN0YW1wIGFuZCBwZXJzaXN0cyBlbmNyeXB0ZWQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGplc3Quc3B5T24oRGF0ZSwgJ25vdycpLm1vY2tSZXR1cm5WYWx1ZSgxMjM0NSk7XHJcbiAgICAgIGFzeW5jU3RvcmFnZS5nZXRJdGVtLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xyXG4gICAgICBlbmNyeXB0aW9uLmRlY3J5cHQubW9ja1Jlc29sdmVkVmFsdWUoJ1tdJyk7XHJcbiAgICAgIGVuY3J5cHRpb24uZW5jcnlwdC5tb2NrUmVzb2x2ZWRWYWx1ZSgnZW5jcnlwdGVkLW5ldycpO1xyXG5cclxuICAgICAgY29uc3Qgb2sgPSBhd2FpdCBhZGRUb1F1ZXVlKHsgdXJsOiAnL2FwaS90ZXN0JywgbWV0aG9kOiAnUE9TVCcgfSk7XHJcblxyXG4gICAgICBleHBlY3Qob2spLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChlbmNyeXB0aW9uLmVuY3J5cHQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KFt7IHVybDogJy9hcGkvdGVzdCcsIG1ldGhvZDogJ1BPU1QnLCBpZDogJzEyMzQ1JywgdGltZXN0YW1wOiAxMjM0NSB9XSlcclxuICAgICAgKTtcclxuICAgICAgZXhwZWN0KGFzeW5jU3RvcmFnZS5zZXRJdGVtKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnb2ZmbGluZV9xdWV1ZScsICdlbmNyeXB0ZWQtbmV3Jyk7XHJcblxyXG4gICAgICBEYXRlLm5vdy5tb2NrUmVzdG9yZSgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2ZhaWxzIHNhZmVseSAocmV0dXJucyBmYWxzZSkgd2hlbiBlbmNyeXB0aW9uIGZhaWxzIGFuZCBkb2VzIG5vdCBwZXJzaXN0IHBsYWludGV4dCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgYXN5bmNTdG9yYWdlLmdldEl0ZW0ubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XHJcbiAgICAgIGVuY3J5cHRpb24uZGVjcnlwdC5tb2NrUmVzb2x2ZWRWYWx1ZSgnW10nKTtcclxuICAgICAgZW5jcnlwdGlvbi5lbmNyeXB0Lm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignRU5DUllQVElPTl9OT1RfSU1QTEVNRU5URUQnKSk7XHJcblxyXG4gICAgICBjb25zdCBvayA9IGF3YWl0IGFkZFRvUXVldWUoeyB1cmw6ICcvYXBpL3Rlc3QnLCBtZXRob2Q6ICdQT1NUJyB9KTtcclxuXHJcbiAgICAgIGV4cGVjdChvaykudG9CZShmYWxzZSk7XHJcbiAgICAgIGV4cGVjdChhc3luY1N0b3JhZ2Uuc2V0SXRlbSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgICAgZXhwZWN0KGhhbmRsZUVycm9yKS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ3JlbW92ZUZyb21RdWV1ZScsICgpID0+IHtcclxuICAgIGl0KCdyZW1vdmVzIGl0ZW0gYnkgaWQgYW5kIHBlcnNpc3RzIGVuY3J5cHRlZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgYXN5bmNTdG9yYWdlLmdldEl0ZW0ubW9ja1Jlc29sdmVkVmFsdWUoJ2NpcGhlcnRleHQnKTtcclxuICAgICAgZW5jcnlwdGlvbi5kZWNyeXB0Lm1vY2tSZXNvbHZlZFZhbHVlKFxyXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KFtcclxuICAgICAgICAgIHsgaWQ6ICcxJywgdXJsOiAnL2EnIH0sXHJcbiAgICAgICAgICB7IGlkOiAnMicsIHVybDogJy9iJyB9LFxyXG4gICAgICAgIF0pXHJcbiAgICAgICk7XHJcbiAgICAgIGVuY3J5cHRpb24uZW5jcnlwdC5tb2NrUmVzb2x2ZWRWYWx1ZSgnZW5jcnlwdGVkLWZpbHRlcmVkJyk7XHJcblxyXG4gICAgICBjb25zdCBvayA9IGF3YWl0IHJlbW92ZUZyb21RdWV1ZSgnMicpO1xyXG5cclxuICAgICAgZXhwZWN0KG9rKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QoZW5jcnlwdGlvbi5lbmNyeXB0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChKU09OLnN0cmluZ2lmeShbeyBpZDogJzEnLCB1cmw6ICcvYScgfV0pKTtcclxuICAgICAgZXhwZWN0KGFzeW5jU3RvcmFnZS5zZXRJdGVtKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnb2ZmbGluZV9xdWV1ZScsICdlbmNyeXB0ZWQtZmlsdGVyZWQnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnY2xlYXJRdWV1ZScsICgpID0+IHtcclxuICAgIGl0KCdyZW1vdmVzIHRoZSBxdWV1ZSBrZXknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG9rID0gYXdhaXQgY2xlYXJRdWV1ZSgpO1xyXG4gICAgICBleHBlY3Qob2spLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChhc3luY1N0b3JhZ2UucmVtb3ZlSXRlbSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ29mZmxpbmVfcXVldWUnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTtcclxuXHJcbiJdLCJtYXBwaW5ncyI6IkFBU0FBLFdBQUEsR0FBS0MsSUFBSSwyQkFBc0I7RUFBQSxPQUFPO0lBQ3BDQyxLQUFLLEVBQUU7TUFDTEMsT0FBTyxFQUFFQyxJQUFJLENBQUNDLEVBQUUsQ0FBQyxDQUFDO01BQ2xCQyxPQUFPLEVBQUVGLElBQUksQ0FBQ0MsRUFBRSxDQUFDLENBQUM7TUFDbEJFLFVBQVUsRUFBRUgsSUFBSSxDQUFDQyxFQUFFLENBQUM7SUFDdEI7RUFDRixDQUFDO0FBQUEsQ0FBQyxDQUFDO0FBRUhMLFdBQUEsR0FBS0MsSUFBSSxtQkFBYztFQUFBLE9BQU87SUFDNUJPLFVBQVUsRUFBRTtNQUNWQyxPQUFPLEVBQUVMLElBQUksQ0FBQ0MsRUFBRSxDQUFDLENBQUM7TUFDbEJLLE9BQU8sRUFBRU4sSUFBSSxDQUFDQyxFQUFFLENBQUM7SUFDbkI7RUFDRixDQUFDO0FBQUEsQ0FBQyxDQUFDO0FBRUhMLFdBQUEsR0FBS0MsSUFBSSxpQkFBWTtFQUFBLE9BQU87SUFDMUJVLFdBQVcsRUFBRVAsSUFBSSxDQUFDQyxFQUFFLENBQUM7RUFDdkIsQ0FBQztBQUFBLENBQUMsQ0FBQztBQUFDLElBQUFPLHNCQUFBLEdBQUFDLE9BQUEsaURBQUFDLE9BQUE7QUFBQSxJQUFBQyxrQkFBQSxHQUFBSCxzQkFBQSxDQUFBQyxPQUFB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LEVBQUM7RUFDSixDQUFDLENBQUM7RUFFRmxCLFFBQVEsQ0FBQyxpQkFBaUIsRUFBRSxZQUFNO0lBQ2hDSyxFQUFFLENBQUMsMkNBQTJDLE1BQUFYLGtCQUFBLENBQUFELE9BQUEsRUFBRSxhQUFZO01BQzFEVSxjQUFZLENBQUNyQixPQUFPLENBQUNzQixpQkFBaUIsQ0FBQyxZQUFZLENBQUM7TUFDcERqQixvQkFBVSxDQUFDRSxPQUFPLENBQUNlLGlCQUFpQixDQUNsQ00sSUFBSSxDQUFDQyxTQUFTLENBQUMsQ0FDYjtRQUFFQyxFQUFFLEVBQUUsR0FBRztRQUFFQyxHQUFHLEVBQUU7TUFBSyxDQUFDLEVBQ3RCO1FBQUVELEVBQUUsRUFBRSxHQUFHO1FBQUVDLEdBQUcsRUFBRTtNQUFLLENBQUMsQ0FDdkIsQ0FDSCxDQUFDO01BQ0QxQixvQkFBVSxDQUFDQyxPQUFPLENBQUNnQixpQkFBaUIsQ0FBQyxvQkFBb0IsQ0FBQztNQUUxRCxJQUFNbUIsRUFBRSxTQUFTLElBQUFRLHNCQUFlLEVBQUMsR0FBRyxDQUFDO01BRXJDekIsTUFBTSxDQUFDaUIsRUFBRSxDQUFDLENBQUNHLElBQUksQ0FBQyxJQUFJLENBQUM7TUFDckJwQixNQUFNLENBQUNuQixvQkFBVSxDQUFDQyxPQUFPLENBQUMsQ0FBQzJCLG9CQUFvQixDQUFDTCxJQUFJLENBQUNDLFNBQVMsQ0FBQyxDQUFDO1FBQUVDLEVBQUUsRUFBRSxHQUFHO1FBQUVDLEdBQUcsRUFBRTtNQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7TUFDekZQLE1BQU0sQ0FBQ0gsY0FBWSxDQUFDbEIsT0FBTyxDQUFDLENBQUM4QixvQkFBb0IsQ0FBQyxlQUFlLEVBQUUsb0JBQW9CLENBQUM7SUFDMUYsQ0FBQyxFQUFDO0VBQ0osQ0FBQyxDQUFDO0VBRUZmLFFBQVEsQ0FBQyxZQUFZLEVBQUUsWUFBTTtJQUMzQkssRUFBRSxDQUFDLHVCQUF1QixNQUFBWCxrQkFBQSxDQUFBRCxPQUFBLEVBQUUsYUFBWTtNQUN0QyxJQUFNOEIsRUFBRSxTQUFTLElBQUFTLGlCQUFVLEVBQUMsQ0FBQztNQUM3QjFCLE1BQU0sQ0FBQ2lCLEVBQUUsQ0FBQyxDQUFDRyxJQUFJLENBQUMsSUFBSSxDQUFDO01BQ3JCcEIsTUFBTSxDQUFDSCxjQUFZLENBQUNqQixVQUFVLENBQUMsQ0FBQzZCLG9CQUFvQixDQUFDLGVBQWUsQ0FBQztJQUN2RSxDQUFDLEVBQUM7RUFDSixDQUFDLENBQUM7QUFDSixDQUFDLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=