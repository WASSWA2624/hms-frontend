{"version":3,"names":["_getJestObj","mock","tokenManager","getAccessToken","jest","fn","getRefreshToken","isTokenExpired","logger","info","error","debug","warn","_interopRequireDefault","require","default","_asyncToGenerator2","_init","_security","_logging","_require","describe","beforeEach","clearAllMocks","it","mockResolvedValue","initSecurity","expect","toHaveBeenCalled","toHaveBeenCalledWith","mockReturnValue","Error","mockRejectedValue","resolves","not","toThrow"],"sources":["init.security.test.js"],"sourcesContent":["/**\r\n * Security Initialization Tests\r\n * File: init.security.test.js\r\n */\r\nimport { initSecurity } from '@bootstrap/init.security';\r\nimport { tokenManager } from '@security';\r\nimport { logger } from '@logging';\r\n\r\njest.mock('@security', () => ({\r\n  tokenManager: {\r\n    getAccessToken: jest.fn(),\r\n    getRefreshToken: jest.fn(),\r\n    isTokenExpired: jest.fn(),\r\n  },\r\n}));\r\n\r\njest.mock('@logging', () => ({\r\n  logger: {\r\n    info: jest.fn(),\r\n    error: jest.fn(),\r\n    debug: jest.fn(),\r\n    warn: jest.fn(),\r\n  },\r\n}));\r\n\r\ndescribe('Security Initialization', () => {\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  it('initializes successfully when no tokens exist', async () => {\r\n    tokenManager.getAccessToken.mockResolvedValue(null);\r\n    tokenManager.getRefreshToken.mockResolvedValue(null);\r\n\r\n    await initSecurity();\r\n\r\n    expect(tokenManager.getAccessToken).toHaveBeenCalled();\r\n    expect(tokenManager.getRefreshToken).toHaveBeenCalled();\r\n    expect(logger.info).toHaveBeenCalledWith('No session found on startup');\r\n    expect(logger.info).toHaveBeenCalledWith('Security initialized successfully');\r\n  });\r\n\r\n  it('initializes successfully with valid tokens', async () => {\r\n    tokenManager.getAccessToken.mockResolvedValue('valid-token');\r\n    tokenManager.getRefreshToken.mockResolvedValue('valid-refresh-token');\r\n    tokenManager.isTokenExpired.mockReturnValue(false);\r\n\r\n    await initSecurity();\r\n\r\n    expect(logger.info).toHaveBeenCalledWith('Valid session found on startup');\r\n    expect(logger.info).toHaveBeenCalledWith('Security initialized successfully');\r\n  });\r\n\r\n  it('handles expired access token with refresh token available', async () => {\r\n    tokenManager.getAccessToken.mockResolvedValue('expired-token');\r\n    tokenManager.getRefreshToken.mockResolvedValue('valid-refresh-token');\r\n    tokenManager.isTokenExpired.mockReturnValue(true);\r\n\r\n    await initSecurity();\r\n\r\n    expect(logger.info).toHaveBeenCalledWith('Access token expired, refresh token available');\r\n    expect(logger.info).toHaveBeenCalledWith('Security initialized successfully');\r\n  });\r\n\r\n  it('handles expired tokens without refresh token', async () => {\r\n    tokenManager.getAccessToken.mockResolvedValue('expired-token');\r\n    tokenManager.getRefreshToken.mockResolvedValue(null);\r\n    tokenManager.isTokenExpired.mockReturnValue(true);\r\n\r\n    await initSecurity();\r\n\r\n    expect(logger.info).toHaveBeenCalledWith('Tokens expired, user will need to re-authenticate');\r\n    expect(logger.info).toHaveBeenCalledWith('Security initialized successfully');\r\n  });\r\n\r\n  it('handles errors gracefully without throwing', async () => {\r\n    const error = new Error('Security error');\r\n    tokenManager.getAccessToken.mockRejectedValue(error);\r\n\r\n    await expect(initSecurity()).resolves.not.toThrow();\r\n\r\n    expect(logger.error).toHaveBeenCalledWith('Security initialization failed', {\r\n      error: 'Security error',\r\n    });\r\n  });\r\n});\r\n\r\n"],"mappings":"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","ignoreList":[]}