{"version":3,"names":["_getJestObj","mock","fetch","jest","fn","addEventListener","logger","info","error","debug","warn","_interopRequireDefault","require","default","_asyncToGenerator2","_netinfo","_network","_require","describe","beforeEach","clearAllMocks","__unsafeResetForTests","it","NetInfo","mockResolvedValue","isConnected","result","checkConnectivity","expect","toBe","getIsOnline","resolves","undefined","listener","subscribe","mockResolvedValueOnce","toHaveBeenCalledTimes","toHaveBeenCalledWith","listener1","listener2","unsubscribe1","unsubscribe","mockReturnValue","startListening","a","b","handler","mockImplementation","h","stopListening"],"sources":["network.listener.test.js"],"sourcesContent":["/**\r\n * Network Listener Tests\r\n * File: network.listener.test.js\r\n */\r\nimport NetInfo from '@react-native-community/netinfo';\r\nimport {\r\n  __unsafeResetForTests,\r\n  checkConnectivity,\r\n  getIsOnline,\r\n  startListening,\r\n  stopListening,\r\n  subscribe,\r\n} from '@offline/network.listener';\r\n\r\njest.mock('@react-native-community/netinfo', () => ({\r\n  fetch: jest.fn(),\r\n  addEventListener: jest.fn(),\r\n}));\r\n\r\njest.mock('@logging', () => ({\r\n  logger: {\r\n    info: jest.fn(),\r\n    error: jest.fn(),\r\n    debug: jest.fn(),\r\n    warn: jest.fn(),\r\n  },\r\n}));\r\n\r\ndescribe('Network Listener', () => {\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    __unsafeResetForTests();\r\n  });\r\n\r\n  describe('checkConnectivity', () => {\r\n    it('returns true when online', async () => {\r\n      NetInfo.fetch.mockResolvedValue({ isConnected: true });\r\n\r\n      const result = await checkConnectivity();\r\n\r\n      expect(result).toBe(true);\r\n      expect(getIsOnline()).toBe(true);\r\n    });\r\n\r\n    it('returns false when offline', async () => {\r\n      NetInfo.fetch.mockResolvedValue({ isConnected: false });\r\n\r\n      const result = await checkConnectivity();\r\n\r\n      expect(result).toBe(false);\r\n      expect(getIsOnline()).toBe(false);\r\n    });\r\n\r\n    it('treats null/undefined connectivity as offline (false)', async () => {\r\n      NetInfo.fetch.mockResolvedValue({ isConnected: null });\r\n      await expect(checkConnectivity()).resolves.toBe(false);\r\n\r\n      NetInfo.fetch.mockResolvedValue({ isConnected: undefined });\r\n      await expect(checkConnectivity()).resolves.toBe(false);\r\n    });\r\n\r\n    it('notifies subscribers only when status changes', async () => {\r\n      const listener = jest.fn();\r\n      subscribe(listener);\r\n\r\n      NetInfo.fetch\r\n        .mockResolvedValueOnce({ isConnected: true }) // true -> true (no change)\r\n        .mockResolvedValueOnce({ isConnected: true }) // true -> true (no change)\r\n        .mockResolvedValueOnce({ isConnected: false }) // true -> false (change)\r\n        .mockResolvedValueOnce({ isConnected: false }); // false -> false (no change)\r\n\r\n      await checkConnectivity();\r\n      await checkConnectivity();\r\n      await checkConnectivity();\r\n      await checkConnectivity();\r\n\r\n      expect(listener).toHaveBeenCalledTimes(1);\r\n      expect(listener).toHaveBeenCalledWith(false);\r\n    });\r\n  });\r\n\r\n  describe('subscribe', () => {\r\n    it('returns an unsubscribe function that prevents future notifications', async () => {\r\n      const listener1 = jest.fn();\r\n      const listener2 = jest.fn();\r\n\r\n      const unsubscribe1 = subscribe(listener1);\r\n      subscribe(listener2);\r\n\r\n      unsubscribe1();\r\n\r\n      NetInfo.fetch.mockResolvedValue({ isConnected: false });\r\n      await checkConnectivity();\r\n\r\n      expect(listener1).toHaveBeenCalledTimes(0);\r\n      expect(listener2).toHaveBeenCalledTimes(1);\r\n      expect(listener2).toHaveBeenCalledWith(false);\r\n    });\r\n  });\r\n\r\n  describe('startListening', () => {\r\n    it('registers a NetInfo event listener and returns an unsubscribe function', () => {\r\n      const unsubscribe = jest.fn();\r\n      NetInfo.addEventListener.mockReturnValue(unsubscribe);\r\n\r\n      const result = startListening();\r\n\r\n      expect(NetInfo.addEventListener).toHaveBeenCalledTimes(1);\r\n      expect(result).toBe(unsubscribe);\r\n    });\r\n\r\n    it('is idempotent (does not register multiple NetInfo listeners)', () => {\r\n      const unsubscribe = jest.fn();\r\n      NetInfo.addEventListener.mockReturnValue(unsubscribe);\r\n\r\n      const a = startListening();\r\n      const b = startListening();\r\n\r\n      expect(NetInfo.addEventListener).toHaveBeenCalledTimes(1);\r\n      expect(a).toBe(b);\r\n    });\r\n\r\n    it('notifies subscribers when NetInfo emits a change', () => {\r\n      const unsubscribe = jest.fn();\r\n      let handler;\r\n      NetInfo.addEventListener.mockImplementation((h) => {\r\n        handler = h;\r\n        return unsubscribe;\r\n      });\r\n\r\n      const listener = jest.fn();\r\n      subscribe(listener);\r\n\r\n      startListening();\r\n      handler({ isConnected: false });\r\n\r\n      expect(listener).toHaveBeenCalledTimes(1);\r\n      expect(listener).toHaveBeenCalledWith(false);\r\n    });\r\n\r\n    it('stopListening calls NetInfo unsubscribe and allows re-starting', () => {\r\n      const unsubscribe = jest.fn();\r\n      NetInfo.addEventListener.mockReturnValue(unsubscribe);\r\n\r\n      startListening();\r\n      stopListening();\r\n      expect(unsubscribe).toHaveBeenCalledTimes(1);\r\n\r\n      startListening();\r\n      expect(NetInfo.addEventListener).toHaveBeenCalledTimes(2);\r\n    });\r\n  });\r\n});\r\n\r\n"],"mappings":"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","ignoreList":[]}