1548c5cc1454c5a3d1ab4c5398bf520e
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _react = require("react");
var _expoRouter = require("expo-router");
var _hooks = require("../../../../hooks");
var resolveErrorMessage = function resolveErrorMessage(t, errorCode, loadErrorKey) {
  if (!errorCode) return null;
  if (errorCode === 'UNKNOWN_ERROR' || errorCode === 'NETWORK_ERROR') {
    return t(loadErrorKey);
  }
  var key = `errors.codes.${errorCode}`;
  var resolved = t(key);
  return resolved === key ? t(loadErrorKey) : resolved;
};
var useTenantListScreen = function useTenantListScreen() {
  var _useI18n = (0, _hooks.useI18n)(),
    t = _useI18n.t;
  var router = (0, _expoRouter.useRouter)();
  var _useNetwork = (0, _hooks.useNetwork)(),
    isOffline = _useNetwork.isOffline;
  var _useTenant = (0, _hooks.useTenant)(),
    list = _useTenant.list,
    remove = _useTenant.remove,
    data = _useTenant.data,
    isLoading = _useTenant.isLoading,
    errorCode = _useTenant.errorCode,
    reset = _useTenant.reset;
  var items = (0, _react.useMemo)(function () {
    var _data$items;
    return Array.isArray(data) ? data : (_data$items = data == null ? void 0 : data.items) != null ? _data$items : [];
  }, [data]);
  var errorMessage = (0, _react.useMemo)(function () {
    return resolveErrorMessage(t, errorCode, 'tenant.list.loadError');
  }, [t, errorCode]);
  var fetchList = (0, _react.useCallback)(function () {
    reset();
    list({
      page: 1,
      limit: 20
    });
  }, [list, reset]);
  (0, _react.useEffect)(function () {
    fetchList();
  }, [fetchList]);
  var handleRetry = (0, _react.useCallback)(function () {
    fetchList();
  }, [fetchList]);
  var handleTenantPress = (0, _react.useCallback)(function (id) {
    router.push(`/settings/tenants/${id}`);
  }, [router]);
  var handleAdd = (0, _react.useCallback)(function () {
    router.push('/settings/tenants/create');
  }, [router]);
  var handleDelete = (0, _react.useCallback)(function () {
    var _ref = (0, _asyncToGenerator2.default)(function* (id, e) {
      if (e != null && e.stopPropagation) e.stopPropagation();
      try {
        yield remove(id);
        fetchList();
      } catch (_unused) {}
    });
    return function (_x, _x2) {
      return _ref.apply(this, arguments);
    };
  }(), [remove, fetchList]);
  return {
    items: items,
    isLoading: isLoading,
    hasError: Boolean(errorCode),
    errorMessage: errorMessage,
    isOffline: isOffline,
    onRetry: handleRetry,
    onTenantPress: handleTenantPress,
    onAdd: handleAdd,
    onDelete: handleDelete
  };
};
var _default = exports.default = useTenantListScreen;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJyZXF1aXJlIiwiX2V4cG9Sb3V0ZXIiLCJfaG9va3MiLCJyZXNvbHZlRXJyb3JNZXNzYWdlIiwidCIsImVycm9yQ29kZSIsImxvYWRFcnJvcktleSIsImtleSIsInJlc29sdmVkIiwidXNlVGVuYW50TGlzdFNjcmVlbiIsIl91c2VJMThuIiwidXNlSTE4biIsInJvdXRlciIsInVzZVJvdXRlciIsIl91c2VOZXR3b3JrIiwidXNlTmV0d29yayIsImlzT2ZmbGluZSIsIl91c2VUZW5hbnQiLCJ1c2VUZW5hbnQiLCJsaXN0IiwicmVtb3ZlIiwiZGF0YSIsImlzTG9hZGluZyIsInJlc2V0IiwiaXRlbXMiLCJ1c2VNZW1vIiwiX2RhdGEkaXRlbXMiLCJBcnJheSIsImlzQXJyYXkiLCJlcnJvck1lc3NhZ2UiLCJmZXRjaExpc3QiLCJ1c2VDYWxsYmFjayIsInBhZ2UiLCJsaW1pdCIsInVzZUVmZmVjdCIsImhhbmRsZVJldHJ5IiwiaGFuZGxlVGVuYW50UHJlc3MiLCJpZCIsInB1c2giLCJoYW5kbGVBZGQiLCJoYW5kbGVEZWxldGUiLCJfcmVmIiwiX2FzeW5jVG9HZW5lcmF0b3IyIiwiZGVmYXVsdCIsImUiLCJzdG9wUHJvcGFnYXRpb24iLCJfdW51c2VkIiwiX3giLCJfeDIiLCJhcHBseSIsImFyZ3VtZW50cyIsImhhc0Vycm9yIiwiQm9vbGVhbiIsIm9uUmV0cnkiLCJvblRlbmFudFByZXNzIiwib25BZGQiLCJvbkRlbGV0ZSIsIl9kZWZhdWx0IiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInVzZVRlbmFudExpc3RTY3JlZW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIHVzZVRlbmFudExpc3RTY3JlZW4gSG9va1xyXG4gKiBTaGFyZWQgbG9naWMgZm9yIFRlbmFudExpc3RTY3JlZW4gYWNyb3NzIHBsYXRmb3Jtcy5cclxuICogRmlsZTogdXNlVGVuYW50TGlzdFNjcmVlbi5qc1xyXG4gKi9cclxuaW1wb3J0IHsgdXNlQ2FsbGJhY2ssIHVzZUVmZmVjdCwgdXNlTWVtbyB9IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IHsgdXNlUm91dGVyIH0gZnJvbSAnZXhwby1yb3V0ZXInO1xyXG5pbXBvcnQgeyB1c2VJMThuLCB1c2VOZXR3b3JrLCB1c2VUZW5hbnQgfSBmcm9tICdAaG9va3MnO1xyXG5cclxuY29uc3QgcmVzb2x2ZUVycm9yTWVzc2FnZSA9ICh0LCBlcnJvckNvZGUsIGxvYWRFcnJvcktleSkgPT4ge1xyXG4gIGlmICghZXJyb3JDb2RlKSByZXR1cm4gbnVsbDtcclxuICBpZiAoZXJyb3JDb2RlID09PSAnVU5LTk9XTl9FUlJPUicgfHwgZXJyb3JDb2RlID09PSAnTkVUV09SS19FUlJPUicpIHtcclxuICAgIHJldHVybiB0KGxvYWRFcnJvcktleSk7XHJcbiAgfVxyXG4gIGNvbnN0IGtleSA9IGBlcnJvcnMuY29kZXMuJHtlcnJvckNvZGV9YDtcclxuICBjb25zdCByZXNvbHZlZCA9IHQoa2V5KTtcclxuICByZXR1cm4gcmVzb2x2ZWQgPT09IGtleSA/IHQobG9hZEVycm9yS2V5KSA6IHJlc29sdmVkO1xyXG59O1xyXG5cclxuY29uc3QgdXNlVGVuYW50TGlzdFNjcmVlbiA9ICgpID0+IHtcclxuICBjb25zdCB7IHQgfSA9IHVzZUkxOG4oKTtcclxuICBjb25zdCByb3V0ZXIgPSB1c2VSb3V0ZXIoKTtcclxuICBjb25zdCB7IGlzT2ZmbGluZSB9ID0gdXNlTmV0d29yaygpO1xyXG4gIGNvbnN0IHtcclxuICAgIGxpc3QsXHJcbiAgICByZW1vdmUsXHJcbiAgICBkYXRhLFxyXG4gICAgaXNMb2FkaW5nLFxyXG4gICAgZXJyb3JDb2RlLFxyXG4gICAgcmVzZXQsXHJcbiAgfSA9IHVzZVRlbmFudCgpO1xyXG5cclxuICBjb25zdCBpdGVtcyA9IHVzZU1lbW8oXHJcbiAgICAoKSA9PiAoQXJyYXkuaXNBcnJheShkYXRhKSA/IGRhdGEgOiAoZGF0YT8uaXRlbXMgPz8gW10pKSxcclxuICAgIFtkYXRhXVxyXG4gICk7XHJcbiAgY29uc3QgZXJyb3JNZXNzYWdlID0gdXNlTWVtbyhcclxuICAgICgpID0+IHJlc29sdmVFcnJvck1lc3NhZ2UodCwgZXJyb3JDb2RlLCAndGVuYW50Lmxpc3QubG9hZEVycm9yJyksXHJcbiAgICBbdCwgZXJyb3JDb2RlXVxyXG4gICk7XHJcblxyXG4gIGNvbnN0IGZldGNoTGlzdCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcclxuICAgIHJlc2V0KCk7XHJcbiAgICBsaXN0KHsgcGFnZTogMSwgbGltaXQ6IDIwIH0pO1xyXG4gIH0sIFtsaXN0LCByZXNldF0pO1xyXG5cclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgZmV0Y2hMaXN0KCk7XHJcbiAgfSwgW2ZldGNoTGlzdF0pO1xyXG5cclxuICBjb25zdCBoYW5kbGVSZXRyeSA9IHVzZUNhbGxiYWNrKCgpID0+IHtcclxuICAgIGZldGNoTGlzdCgpO1xyXG4gIH0sIFtmZXRjaExpc3RdKTtcclxuXHJcbiAgY29uc3QgaGFuZGxlVGVuYW50UHJlc3MgPSB1c2VDYWxsYmFjayhcclxuICAgIChpZCkgPT4ge1xyXG4gICAgICByb3V0ZXIucHVzaChgL3NldHRpbmdzL3RlbmFudHMvJHtpZH1gKTtcclxuICAgIH0sXHJcbiAgICBbcm91dGVyXVxyXG4gICk7XHJcblxyXG4gIGNvbnN0IGhhbmRsZUFkZCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcclxuICAgIHJvdXRlci5wdXNoKCcvc2V0dGluZ3MvdGVuYW50cy9jcmVhdGUnKTtcclxuICB9LCBbcm91dGVyXSk7XHJcblxyXG4gIGNvbnN0IGhhbmRsZURlbGV0ZSA9IHVzZUNhbGxiYWNrKFxyXG4gICAgYXN5bmMgKGlkLCBlKSA9PiB7XHJcbiAgICAgIGlmIChlPy5zdG9wUHJvcGFnYXRpb24pIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgYXdhaXQgcmVtb3ZlKGlkKTtcclxuICAgICAgICBmZXRjaExpc3QoKTtcclxuICAgICAgfSBjYXRjaCB7XHJcbiAgICAgICAgLyogZXJyb3IgaGFuZGxlZCBieSBob29rICovXHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICBbcmVtb3ZlLCBmZXRjaExpc3RdXHJcbiAgKTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIGl0ZW1zLFxyXG4gICAgaXNMb2FkaW5nLFxyXG4gICAgaGFzRXJyb3I6IEJvb2xlYW4oZXJyb3JDb2RlKSxcclxuICAgIGVycm9yTWVzc2FnZSxcclxuICAgIGlzT2ZmbGluZSxcclxuICAgIG9uUmV0cnk6IGhhbmRsZVJldHJ5LFxyXG4gICAgb25UZW5hbnRQcmVzczogaGFuZGxlVGVuYW50UHJlc3MsXHJcbiAgICBvbkFkZDogaGFuZGxlQWRkLFxyXG4gICAgb25EZWxldGU6IGhhbmRsZURlbGV0ZSxcclxuICB9O1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgdXNlVGVuYW50TGlzdFNjcmVlbjtcclxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFLQSxJQUFBQSxNQUFBLEdBQUFDLE9BQUE7QUFDQSxJQUFBQyxXQUFBLEdBQUFELE9BQUE7QUFDQSxJQUFBRSxNQUFBLEdBQUFGLE9BQUE7QUFFQSxJQUFNRyxtQkFBbUIsR0FBRyxTQUF0QkEsbUJBQW1CQSxDQUFJQyxDQUFDLEVBQUVDLFNBQVMsRUFBRUMsWUFBWSxFQUFLO0VBQzFELElBQUksQ0FBQ0QsU0FBUyxFQUFFLE9BQU8sSUFBSTtFQUMzQixJQUFJQSxTQUFTLEtBQUssZUFBZSxJQUFJQSxTQUFTLEtBQUssZUFBZSxFQUFFO0lBQ2xFLE9BQU9ELENBQUMsQ0FBQ0UsWUFBWSxDQUFDO0VBQ3hCO0VBQ0EsSUFBTUMsR0FBRyxHQUFHLGdCQUFnQkYsU0FBUyxFQUFFO0VBQ3ZDLElBQU1HLFFBQVEsR0FBR0osQ0FBQyxDQUFDRyxHQUFHLENBQUM7RUFDdkIsT0FBT0MsUUFBUSxLQUFLRCxHQUFHLEdBQUdILENBQUMsQ0FBQ0UsWUFBWSxDQUFDLEdBQUdFLFFBQVE7QUFDdEQsQ0FBQztBQUVELElBQU1DLG1CQUFtQixHQUFHLFNBQXRCQSxtQkFBbUJBLENBQUEs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