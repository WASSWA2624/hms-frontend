{"version":3,"names":["_react","require","_expoRouter","_reactRedux","_hooks","_config","_utils","_auth","_selectors","_store","_interopRequireDefault","resolveErrorMessage","t","errorCode","key","resolved","normalizeIdentifier","value","String","trim","isEmailIdentifier","includes","useLoginScreen","_useI18n","useI18n","router","useRouter","_useNetwork","useNetwork","isOffline","_useAuth","useAuth","login","clearError","isLoading","refreshSession","loadCurrentUser","roles","isAuthenticated","useSelector","selectIsAuthenticated","_useBiometricAuth","useBiometricAuth","isBiometricAvailable","isAvailable","isBiometricChecking","isChecking","biometricErrorMessage","errorMessage","authenticateBiometric","authenticate","_useState","useState","window","saved","localStorage","getItem","savedIdentifier","_useState2","_slicedToArray2","default","identifier","setIdentifier","_useState3","_useState4","password","setPassword","_useState5","_useState6","rememberMe","setRememberMe","loginCompletedRef","useRef","useMemo","authMessage","canSubmit","Boolean","canAccessRegister","_AUTH$REGISTER_ROLES","AUTH","REGISTER_ROLES","length","some","role","handleSubmit","useCallback","_asyncToGenerator2","fetch","method","headers","body","JSON","stringify","location","message","data","hasIdentifier","hasPassword","timestamp","Date","now","sessionId","runId","hypothesisId","catch","rawIdentifier","payload","email","toLowerCase","phone","normalizePhoneNumber","_result$facilities","console","log","Object","assign","result","loginUseCase","isUser","id","requiresFacilitySelection","hasId","hasEmail","hasPhone","resultKeys","keys","hasFacilities","facilities","hasTenantId","tenantId","resultType","route","push","pathname","params","loginPayload","tenant_id","isUserResult","current","attempts","maxAttempts","currentState","store","getState","authState","auth","isAuth","user","attempt","hasUser","replace","Promise","resolve","setTimeout","warn","loadError","error","_error$message","code","stack","name","slice","handleChangeIdentifier","handleChangePassword","handleRememberMeChange","checked","setItem","removeItem","useEffect","timeoutId","clearTimeout","handleGoToRegister","handleGoToForgotPassword","handleBiometricLogin","authenticated","_default","exports"],"sources":["useLoginScreen.js"],"sourcesContent":["/**\r\n * useLoginScreen Hook\r\n * Shared behavior/logic for LoginScreen across all platforms.\r\n * File: useLoginScreen.js\r\n */\r\nimport { useCallback, useMemo, useState, useEffect, useRef } from 'react';\r\nimport { useRouter } from 'expo-router';\r\nimport { useSelector } from 'react-redux';\r\nimport { useAuth, useBiometricAuth, useI18n, useNetwork } from '@hooks';\r\nimport { AUTH } from '@config';\r\nimport { normalizePhoneNumber } from '@utils';\r\nimport { identifyUseCase, loginUseCase } from '@features/auth';\r\nimport { selectIsAuthenticated } from '@store/selectors';\r\nimport store from '@store';\r\n\r\nconst resolveErrorMessage = (t, errorCode) => {\r\n  if (!errorCode) return null;\r\n  const key = `errors.codes.${errorCode}`;\r\n  const resolved = t(key);\r\n  return resolved === key ? t('errors.codes.UNKNOWN_ERROR') : resolved;\r\n};\r\n\r\nconst normalizeIdentifier = (value) => String(value || '').trim();\r\nconst isEmailIdentifier = (value) => normalizeIdentifier(value).includes('@');\r\n\r\nconst useLoginScreen = () => {\r\n  const { t } = useI18n();\r\n  const router = useRouter();\r\n  const { isOffline } = useNetwork();\r\n  const {\r\n    login,\r\n    clearError,\r\n    isLoading,\r\n    errorCode,\r\n    refreshSession,\r\n    loadCurrentUser,\r\n    roles,\r\n  } = useAuth();\r\n  \r\n  // Get isAuthenticated directly from Redux to avoid stale closure issues\r\n  const isAuthenticated = useSelector(selectIsAuthenticated);\r\n  const {\r\n    isAvailable: isBiometricAvailable,\r\n    isChecking: isBiometricChecking,\r\n    errorMessage: biometricErrorMessage,\r\n    authenticate: authenticateBiometric,\r\n  } = useBiometricAuth();\r\n  const [identifier, setIdentifier] = useState(() => {\r\n    // Load saved identifier if rememberMe was true\r\n    if (typeof window !== 'undefined') {\r\n      const saved = localStorage.getItem('login_rememberMe');\r\n      if (saved === 'true') {\r\n        const savedIdentifier = localStorage.getItem('login_identifier');\r\n        return savedIdentifier || '';\r\n      }\r\n    }\r\n    return '';\r\n  });\r\n  const [password, setPassword] = useState('');\r\n  const [rememberMe, setRememberMe] = useState(() => {\r\n    // Load rememberMe state\r\n    if (typeof window !== 'undefined') {\r\n      return localStorage.getItem('login_rememberMe') === 'true';\r\n    }\r\n    return false;\r\n  });\r\n  \r\n  // Track if we just completed a login to trigger redirect\r\n  const loginCompletedRef = useRef(false);\r\n\r\n  const errorMessage = useMemo(() => {\r\n    const authMessage = resolveErrorMessage(t, errorCode);\r\n    return authMessage || biometricErrorMessage;\r\n  }, [biometricErrorMessage, errorCode, t]);\r\n\r\n  const canSubmit = useMemo(\r\n    () => Boolean(identifier && password) && !isLoading && !isOffline,\r\n    [identifier, isLoading, isOffline, password]\r\n  );\r\n\r\n  const canAccessRegister = useMemo(() => {\r\n    if (!isAuthenticated) return false;\r\n    if (!AUTH.REGISTER_ROLES?.length) return false;\r\n    return AUTH.REGISTER_ROLES.some((role) => roles.includes(role));\r\n  }, [isAuthenticated, roles]);\r\n\r\n  const handleSubmit = useCallback(async () => {\r\n    // #region agent log\r\n    fetch('http://127.0.0.1:7251/ingest/1d28b85e-4e80-4cd6-84bc-0a14f3ba6cec',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'useLoginScreen.js:80',message:'login_submit_enter',data:{canSubmit,isOffline,isLoading,hasIdentifier:Boolean(identifier),hasPassword:Boolean(password)},timestamp:Date.now(),sessionId:'debug-session',runId:'login-redirect',hypothesisId:'H1'})}).catch(()=>{});\r\n    // #endregion agent log\r\n    if (!canSubmit) return false;\r\n    clearError();\r\n    const rawIdentifier = normalizeIdentifier(identifier);\r\n    const payload = isEmailIdentifier(rawIdentifier)\r\n      ? { email: rawIdentifier.toLowerCase() }\r\n      : { phone: normalizePhoneNumber(rawIdentifier) };\r\n    \r\n    try {\r\n      // Call login use case directly to check response\r\n      console.log('[LOGIN] Starting login with payload:', { ...payload, password: '***' });\r\n      const result = await loginUseCase({\r\n        ...payload,\r\n        password,\r\n      });\r\n      \r\n      // Log full server response\r\n      console.log('[LOGIN] Login result from server:', JSON.stringify(result, null, 2));\r\n      console.log('[LOGIN] Login successful:', Boolean(result));\r\n      console.log('[LOGIN] Result type check:', {\r\n        isUser: Boolean(result?.id || result?.email || result?.phone),\r\n        requiresFacilitySelection: Boolean(result?.requiresFacilitySelection),\r\n        hasId: Boolean(result?.id),\r\n        hasEmail: Boolean(result?.email),\r\n        hasPhone: Boolean(result?.phone),\r\n        resultKeys: result ? Object.keys(result) : [],\r\n      });\r\n      \r\n      // #region agent log\r\n      fetch('http://127.0.0.1:7251/ingest/1d28b85e-4e80-4cd6-84bc-0a14f3ba6cec',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'useLoginScreen.js:96',message:'login_usecase_result',data:{requiresFacilitySelection:Boolean(result?.requiresFacilitySelection),hasFacilities:Boolean(result?.facilities?.length),hasTenantId:Boolean(result?.tenantId),isUser:Boolean(result?.id || result?.email || result?.phone),resultType:typeof result,resultKeys:result ? Object.keys(result) : []},timestamp:Date.now(),sessionId:'debug-session',runId:'login-redirect',hypothesisId:'H2'})}).catch(()=>{});\r\n      // #endregion agent log\r\n      \r\n      // Check if facility selection is required\r\n      if (result?.requiresFacilitySelection) {\r\n        // #region agent log\r\n        fetch('http://127.0.0.1:7251/ingest/1d28b85e-4e80-4cd6-84bc-0a14f3ba6cec',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'useLoginScreen.js:102',message:'login_redirect_facility_selection',data:{route:'/facility-selection'},timestamp:Date.now(),sessionId:'debug-session',runId:'login-redirect',hypothesisId:'H2'})}).catch(()=>{});\r\n        // #endregion agent log\r\n        router.push({\r\n          pathname: '/facility-selection',\r\n          params: {\r\n            facilities: JSON.stringify(result.facilities),\r\n            loginPayload: JSON.stringify({\r\n              ...payload,\r\n              password,\r\n              tenant_id: result.tenantId,\r\n            }),\r\n          },\r\n        });\r\n        return true;\r\n      }\r\n      \r\n      // Normal login - tokens are already stored by loginUseCase\r\n      // Update Redux state by loading current user, then redirect\r\n      const isUserResult = result && (result.id || result.email || result.phone);\r\n      console.log('[LOGIN] Is user result?', isUserResult);\r\n      \r\n      if (isUserResult) {\r\n        console.log('[LOGIN] Loading current user to update Redux state...');\r\n        try {\r\n          // Set flag for backup redirect mechanism\r\n          loginCompletedRef.current = true;\r\n          \r\n          // Dispatch loadCurrentUser and wait for it to complete\r\n          await loadCurrentUser();\r\n          console.log('[LOGIN] loadCurrentUser thunk completed');\r\n          \r\n          // Poll Redux store directly until isAuthenticated is true\r\n          // This ensures we have the latest state, not a stale closure\r\n          let attempts = 0;\r\n          const maxAttempts = 20; // 2 seconds max (20 * 100ms)\r\n          \r\n          while (attempts < maxAttempts) {\r\n            const currentState = store.getState();\r\n            const authState = currentState.auth || {};\r\n            const isAuth = Boolean(authState.isAuthenticated || authState.user);\r\n            \r\n            console.log('[LOGIN] Checking auth state:', { \r\n              attempt: attempts + 1, \r\n              isAuthenticated: isAuth,\r\n              hasUser: Boolean(authState.user)\r\n            });\r\n            \r\n            if (isAuth) {\r\n              console.log('[LOGIN] Authentication state confirmed, redirecting to /home...');\r\n              router.replace('/home');\r\n              return true;\r\n            }\r\n            \r\n            // Wait 100ms before next check\r\n            await new Promise(resolve => setTimeout(resolve, 100));\r\n            attempts++;\r\n          }\r\n          \r\n          // Fallback: if polling didn't work, try redirect anyway\r\n          console.warn('[LOGIN] Polling timeout, attempting redirect anyway...');\r\n          router.replace('/home');\r\n          return true;\r\n        } catch (loadError) {\r\n          console.error('[LOGIN] Error loading current user:', loadError);\r\n          return false;\r\n        }\r\n      }\r\n      \r\n      console.warn('[LOGIN] Login result is not a valid user object:', result);\r\n      return false;\r\n    } catch (error) {\r\n      console.error('[LOGIN] Login error:', error);\r\n      console.error('[LOGIN] Error details:', {\r\n        code: error?.code,\r\n        message: error?.message,\r\n        stack: error?.stack,\r\n        name: error?.name,\r\n      });\r\n      // #region agent log\r\n      fetch('http://127.0.0.1:7251/ingest/1d28b85e-4e80-4cd6-84bc-0a14f3ba6cec',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'useLoginScreen.js:129',message:'login_submit_error',data:{errorCode:error?.code || null,errorMessage:typeof error?.message === 'string' ? error.message.slice(0,120) : null},timestamp:Date.now(),sessionId:'debug-session',runId:'login-redirect',hypothesisId:'H5'})}).catch(()=>{});\r\n      // #endregion agent log\r\n      // Check if error is multiple tenants\r\n      if (error?.code === 'MULTIPLE_TENANTS' || error?.message?.includes('multiple_tenants')) {\r\n        // Redirect to tenant selection\r\n        // #region agent log\r\n        fetch('http://127.0.0.1:7251/ingest/1d28b85e-4e80-4cd6-84bc-0a14f3ba6cec',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'useLoginScreen.js:134',message:'login_redirect_tenant_selection',data:{route:'/tenant-selection'},timestamp:Date.now(),sessionId:'debug-session',runId:'login-redirect',hypothesisId:'H5'})}).catch(()=>{});\r\n        // #endregion agent log\r\n        router.push({\r\n          pathname: '/tenant-selection',\r\n          params: {\r\n            identifier: rawIdentifier,\r\n            password,\r\n          },\r\n        });\r\n        return true;\r\n      }\r\n      // Dispatch login to Redux to handle error state\r\n      await login({\r\n        ...payload,\r\n        password,\r\n      });\r\n      return false;\r\n    }\r\n  }, [canSubmit, clearError, identifier, login, loadCurrentUser, password, router]);\r\n\r\n  const handleChangeIdentifier = useCallback((value) => {\r\n    setIdentifier(value);\r\n  }, []);\r\n\r\n  const handleChangePassword = useCallback((value) => {\r\n    setPassword(value);\r\n  }, []);\r\n\r\n  const handleRememberMeChange = useCallback((checked) => {\r\n    setRememberMe(checked);\r\n    if (typeof window !== 'undefined') {\r\n      if (checked) {\r\n        localStorage.setItem('login_rememberMe', 'true');\r\n        if (identifier) {\r\n          localStorage.setItem('login_identifier', identifier);\r\n        }\r\n      } else {\r\n        localStorage.removeItem('login_rememberMe');\r\n        localStorage.removeItem('login_identifier');\r\n      }\r\n    }\r\n  }, [identifier]);\r\n\r\n  // Save identifier when it changes and rememberMe is true\r\n  useEffect(() => {\r\n    if (rememberMe && identifier && typeof window !== 'undefined') {\r\n      localStorage.setItem('login_identifier', identifier);\r\n    }\r\n  }, [identifier, rememberMe]);\r\n\r\n  // Backup redirect: if manual redirect in handleSubmit fails, this will catch it\r\n  // Only redirect if we're on login page and become authenticated\r\n  useEffect(() => {\r\n    if (isAuthenticated && loginCompletedRef.current) {\r\n      console.log('[LOGIN] Backup: isAuthenticated became true, redirecting to /home...');\r\n      loginCompletedRef.current = false;\r\n      // Small delay to avoid race condition with manual redirect\r\n      const timeoutId = setTimeout(() => {\r\n        router.replace('/home');\r\n      }, 100);\r\n      return () => clearTimeout(timeoutId);\r\n    }\r\n  }, [isAuthenticated, router]);\r\n\r\n  const handleGoToRegister = useCallback(() => {\r\n    router.push('/register');\r\n  }, [router]);\r\n\r\n  const handleGoToForgotPassword = useCallback(() => {\r\n    router.push('/forgot-password');\r\n  }, [router]);\r\n\r\n  const handleBiometricLogin = useCallback(async () => {\r\n    if (!isBiometricAvailable || isBiometricChecking || isOffline) return false;\r\n    const authenticated = await authenticateBiometric();\r\n    if (!authenticated) return false;\r\n    clearError();\r\n    await refreshSession();\r\n    await loadCurrentUser();\r\n    return true;\r\n  }, [\r\n    authenticateBiometric,\r\n    clearError,\r\n    isBiometricAvailable,\r\n    isBiometricChecking,\r\n    isOffline,\r\n    loadCurrentUser,\r\n    refreshSession,\r\n  ]);\r\n\r\n  return {\r\n    identifier,\r\n    password,\r\n    rememberMe,\r\n    errorMessage,\r\n    isLoading,\r\n    isOffline,\r\n    canSubmit,\r\n    canAccessRegister,\r\n    isBiometricAvailable,\r\n    isBiometricChecking,\r\n    handleSubmit,\r\n    handleChangeIdentifier,\r\n    handleChangePassword,\r\n    handleRememberMeChange,\r\n    handleGoToRegister,\r\n    handleGoToForgotPassword,\r\n    handleBiometricLogin,\r\n  };\r\n};\r\n\r\nexport default useLoginScreen;\r\n\r\n"],"mappings":"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","ignoreList":[]}