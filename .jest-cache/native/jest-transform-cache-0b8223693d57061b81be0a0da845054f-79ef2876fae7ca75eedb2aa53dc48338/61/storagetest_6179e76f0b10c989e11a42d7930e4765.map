{"version":3,"names":["_getJestObj","mock","__esModule","default","mockAsyncStorage","mockSecureStore","handleError","jest","fn","_interopRequireDefault","require","_asyncToGenerator2","_require3","getItem","setItem","removeItem","getItemAsync","setItemAsync","deleteItemAsync","_require","async","secure","_require2","describe","beforeEach","clearAllMocks","it","testValue","key","mockResolvedValue","JSON","stringify","result","expect","toEqual","toHaveBeenCalledWith","toBeNull","error","Error","mockRejectedValue","objectContaining","scope","op","toBe","data"],"sources":["storage.test.js"],"sourcesContent":["/**\r\n * Storage Services Tests\r\n * File: storage.test.js\r\n */\r\n// Mock AsyncStorage\r\nconst mockAsyncStorage = {\r\n  getItem: jest.fn(),\r\n  setItem: jest.fn(),\r\n  removeItem: jest.fn(),\r\n};\r\n\r\njest.mock('@react-native-async-storage/async-storage', () => ({\r\n  __esModule: true,\r\n  default: mockAsyncStorage,\r\n}));\r\n\r\n// Mock SecureStore\r\nconst mockSecureStore = {\r\n  getItemAsync: jest.fn(),\r\n  setItemAsync: jest.fn(),\r\n  deleteItemAsync: jest.fn(),\r\n};\r\n\r\njest.mock('expo-secure-store', () => mockSecureStore);\r\n\r\n// Mock error handler (services must not log directly; errors are routed via @errors)\r\njest.mock('@errors', () => ({\r\n  handleError: jest.fn(),\r\n}));\r\n\r\nconst { async, secure } = require('@services/storage');\r\nconst { handleError } = require('@errors');\r\n\r\ndescribe('Storage Services', () => {\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  describe('AsyncStorage Service', () => {\r\n    describe('getItem', () => {\r\n      it('should retrieve and parse stored value', async () => {\r\n        const testValue = { key: 'value' };\r\n        mockAsyncStorage.getItem.mockResolvedValue(JSON.stringify(testValue));\r\n\r\n        const result = await async.getItem('test-key');\r\n        expect(result).toEqual(testValue);\r\n        expect(mockAsyncStorage.getItem).toHaveBeenCalledWith('test-key');\r\n      });\r\n\r\n      it('should return null when key does not exist', async () => {\r\n        mockAsyncStorage.getItem.mockResolvedValue(null);\r\n\r\n        const result = await async.getItem('non-existent');\r\n        expect(result).toBeNull();\r\n      });\r\n\r\n      it('should return null and report error on failure', async () => {\r\n        const error = new Error('Storage error');\r\n        mockAsyncStorage.getItem.mockRejectedValue(error);\r\n\r\n        const result = await async.getItem('test-key');\r\n        expect(result).toBeNull();\r\n        expect(handleError).toHaveBeenCalledWith(\r\n          error,\r\n          expect.objectContaining({\r\n            scope: 'services.storage.async',\r\n            op: 'getItem',\r\n            key: 'test-key',\r\n          })\r\n        );\r\n      });\r\n    });\r\n\r\n    describe('setItem', () => {\r\n      it('should store value as JSON string', async () => {\r\n        const testValue = { key: 'value' };\r\n        mockAsyncStorage.setItem.mockResolvedValue();\r\n\r\n        const result = await async.setItem('test-key', testValue);\r\n        expect(result).toBe(true);\r\n        expect(mockAsyncStorage.setItem).toHaveBeenCalledWith(\r\n          'test-key',\r\n          JSON.stringify(testValue)\r\n        );\r\n      });\r\n\r\n      it('should return false and report error on failure', async () => {\r\n        const error = new Error('Storage error');\r\n        mockAsyncStorage.setItem.mockRejectedValue(error);\r\n\r\n        const result = await async.setItem('test-key', { data: 'value' });\r\n        expect(result).toBe(false);\r\n        expect(handleError).toHaveBeenCalledWith(\r\n          error,\r\n          expect.objectContaining({\r\n            scope: 'services.storage.async',\r\n            op: 'setItem',\r\n            key: 'test-key',\r\n          })\r\n        );\r\n      });\r\n    });\r\n\r\n    describe('removeItem', () => {\r\n      it('should remove item from storage', async () => {\r\n        mockAsyncStorage.removeItem.mockResolvedValue();\r\n\r\n        const result = await async.removeItem('test-key');\r\n        expect(result).toBe(true);\r\n        expect(mockAsyncStorage.removeItem).toHaveBeenCalledWith('test-key');\r\n      });\r\n\r\n      it('should return false and report error on failure', async () => {\r\n        const error = new Error('Storage error');\r\n        mockAsyncStorage.removeItem.mockRejectedValue(error);\r\n\r\n        const result = await async.removeItem('test-key');\r\n        expect(result).toBe(false);\r\n        expect(handleError).toHaveBeenCalledWith(\r\n          error,\r\n          expect.objectContaining({\r\n            scope: 'services.storage.async',\r\n            op: 'removeItem',\r\n            key: 'test-key',\r\n          })\r\n        );\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('SecureStore Service', () => {\r\n    describe('getItem', () => {\r\n      it('should retrieve stored value', async () => {\r\n        const testValue = 'secure-value';\r\n        mockSecureStore.getItemAsync.mockResolvedValue(testValue);\r\n\r\n        const result = await secure.getItem('test-key');\r\n        expect(result).toBe(testValue);\r\n        expect(mockSecureStore.getItemAsync).toHaveBeenCalledWith('test-key');\r\n      });\r\n\r\n      it('should return null when key does not exist', async () => {\r\n        mockSecureStore.getItemAsync.mockResolvedValue(null);\r\n\r\n        const result = await secure.getItem('non-existent');\r\n        expect(result).toBeNull();\r\n      });\r\n\r\n      it('should return null and report error on failure', async () => {\r\n        const error = new Error('Storage error');\r\n        mockSecureStore.getItemAsync.mockRejectedValue(error);\r\n\r\n        const result = await secure.getItem('test-key');\r\n        expect(result).toBeNull();\r\n        expect(handleError).toHaveBeenCalledWith(\r\n          error,\r\n          expect.objectContaining({\r\n            scope: 'services.storage.secure',\r\n            op: 'getItem',\r\n            key: 'test-key',\r\n          })\r\n        );\r\n      });\r\n    });\r\n\r\n    describe('setItem', () => {\r\n      it('should store value securely', async () => {\r\n        const testValue = 'secure-value';\r\n        mockSecureStore.setItemAsync.mockResolvedValue();\r\n\r\n        const result = await secure.setItem('test-key', testValue);\r\n        expect(result).toBe(true);\r\n        expect(mockSecureStore.setItemAsync).toHaveBeenCalledWith('test-key', testValue);\r\n      });\r\n\r\n      it('should return false and report error on failure', async () => {\r\n        const error = new Error('Storage error');\r\n        mockSecureStore.setItemAsync.mockRejectedValue(error);\r\n\r\n        const result = await secure.setItem('test-key', 'value');\r\n        expect(result).toBe(false);\r\n        expect(handleError).toHaveBeenCalledWith(\r\n          error,\r\n          expect.objectContaining({\r\n            scope: 'services.storage.secure',\r\n            op: 'setItem',\r\n            key: 'test-key',\r\n          })\r\n        );\r\n      });\r\n    });\r\n\r\n    describe('removeItem', () => {\r\n      it('should remove item from secure storage', async () => {\r\n        mockSecureStore.deleteItemAsync.mockResolvedValue();\r\n\r\n        const result = await secure.removeItem('test-key');\r\n        expect(result).toBe(true);\r\n        expect(mockSecureStore.deleteItemAsync).toHaveBeenCalledWith('test-key');\r\n      });\r\n\r\n      it('should return false and report error on failure', async () => {\r\n        const error = new Error('Storage error');\r\n        mockSecureStore.deleteItemAsync.mockRejectedValue(error);\r\n\r\n        const result = await secure.removeItem('test-key');\r\n        expect(result).toBe(false);\r\n        expect(handleError).toHaveBeenCalledWith(\r\n          error,\r\n          expect.objectContaining({\r\n            scope: 'services.storage.secure',\r\n            op: 'removeItem',\r\n            key: 'test-key',\r\n          })\r\n        );\r\n      });\r\n    });\r\n  });\r\n});\r\n\r\n"],"mappings":"AAWAA,WAAA,GAAKC,IAAI,CAAC,2CAA2C,EAAE;EAAA,OAAO;IAC5DC,UAAU,EAAE,IAAI;IAChBC,OAAO,EAAEC;EACX,CAAC;AAAA,CAAC,CAAC;AASHJ,WAAA,GAAKC,IAAI,CAAC,mBAAmB,EAAE;EAAA,OAAMI,eAAe;AAAA,EAAC;AAGrDL,WAAA,GAAKC,IAAI,iBAAY;EAAA,OAAO;IAC1BK,WAAW,EAAEC,IAAI,CAACC,EAAE,CAAC;EACvB,CAAC;AAAA,CAAC,CAAC;AAAC,IAAAC,sBAAA,GAAAC,OAAA,iDAAAP,OAAA;AAAA,IAAAQ,kBAAA,GAAAF,sBAAA,CAAAC,OAAA;AAAA,SAAAV,YAAA;EAAA,IAAAY,SAAA,GAAAF,OAAA;IAAAH,IAAA,GAAAK,SAAA,CAAAL,IAAA;EAAAP,WAAA,YAAAA,YAAA;IAAA,OAAAO,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AAvBJ,IAAMH,gBAAgB,GAAG;EACvBS,OAAO,EAAEN,IAAI,CAACC,EAAE,CAAC,CAAC;EAClBM,OAAO,EAAEP,IAAI,CAACC,EAAE,CAAC,CAAC;EAClBO,UAAU,EAAER,IAAI,CAACC,EAAE,CAAC;AACtB,CAAC;AAQD,IAAMH,eAAe,GAAG;EACtBW,YAAY,EAAET,IAAI,CAACC,EAAE,CAAC,CAAC;EACvBS,YAAY,EAAEV,IAAI,CAACC,EAAE,CAAC,CAAC;EACvBU,eAAe,EAAEX,IAAI,CAACC,EAAE,CAAC;AAC3B,CAAC;AASD,IAAAW,QAAA,GAA0BT,OAAO,yBAAoB,CAAC;EAA9CU,KAAK,GAAAD,QAAA,CAALC,KAAK;EAAEC,MAAM,GAAAF,QAAA,CAANE,MAAM;AACrB,IAAAC,SAAA,GAAwBZ,OAAO,eAAU,CAAC;EAAlCJ,WAAW,GAAAgB,SAAA,CAAXhB,WAAW;AAEnBiB,QAAQ,CAAC,kBAAkB,EAAE,YAAM;EACjCC,UAAU,CAAC,YAAM;IACfjB,IAAI,CAACkB,aAAa,CAAC,CAAC;EACtB,CAAC,CAAC;EAEFF,QAAQ,CAAC,sBAAsB,EAAE,YAAM;IACrCA,QAAQ,CAAC,SAAS,EAAE,YAAM;MACxBG,EAAE,CAAC,wCAAwC,MAAAf,kBAAA,CAAAR,OAAA,EAAE,aAAY;QACvD,IAAMwB,SAAS,GAAG;UAAEC,GAAG,EAAE;QAAQ,CAAC;QAClCxB,gBAAgB,CAACS,OAAO,CAACgB,iBAAiB,CAACC,IAAI,CAACC,SAAS,CAACJ,SAAS,CAAC,CAAC;QAErE,IAAMK,MAAM,SAASZ,KAAK,CAACP,OAAO,CAAC,UAAU,CAAC;QAC9CoB,MAAM,CAACD,MAAM,CAAC,CAACE,OAAO,CAACP,SAAS,CAAC;QACjCM,MAAM,CAAC7B,gBAAgB,CAACS,OAAO,CAAC,CAACsB,oBAAoB,CAAC,UAAU,CAAC;MACnE,CAAC,EAAC;MAEFT,EAAE,CAAC,4CAA4C,MAAAf,kBAAA,CAAAR,OAAA,EAAE,aAAY;QAC3DC,gBAAgB,CAACS,OAAO,CAACgB,iBAAiB,CAAC,IAAI,CAAC;QAEhD,IAAMG,MAAM,SAASZ,KAAK,CAACP,OAAO,CAAC,cAAc,CAAC;QAClDoB,MAAM,CAACD,MAAM,CAAC,CAACI,QAAQ,CAAC,CAAC;MAC3B,CAAC,EAAC;MAEFV,EAAE,CAAC,gDAAgD,MAAAf,kBAAA,CAAAR,OAAA,EAAE,aAAY;QAC/D,IAAMkC,KAAK,GAAG,IAAIC,KAAK,CAAC,eAAe,CAAC;QACxClC,gBAAgB,CAACS,OAAO,CAAC0B,iBAAiB,CAACF,KAAK,CAAC;QAEjD,IAAML,MAAM,SAASZ,KAAK,CAACP,OAAO,CAAC,UAAU,CAAC;QAC9CoB,MAAM,CAACD,MAAM,CAAC,CAACI,QAAQ,CAAC,CAAC;QACzBH,MAAM,CAAC3B,WAAW,CAAC,CAAC6B,oBAAoB,CACtCE,KAAK,EACLJ,MAAM,CAACO,gBAAgB,CAAC;UACtBC,KAAK,EAAE,wBAAwB;UAC/BC,EAAE,EAAE,SAAS;UACbd,GAAG,EAAE;QACP,CAAC,CACH,CAAC;MACH,CAAC,EAAC;IACJ,CAAC,CAAC;IAEFL,QAAQ,CAAC,SAAS,EAAE,YAAM;MACxBG,EAAE,CAAC,mCAAmC,MAAAf,kBAAA,CAAAR,OAAA,EAAE,aAAY;QAClD,IAAMwB,SAAS,GAAG;UAAEC,GAAG,EAAE;QAAQ,CAAC;QAClCxB,gBAAgB,CAACU,OAAO,CAACe,iBAAiB,CAAC,CAAC;QAE5C,IAAMG,MAAM,SAASZ,KAAK,CAACN,OAAO,CAAC,UAAU,EAAEa,SAAS,CAAC;QACzDM,MAAM,CAACD,MAAM,CAAC,CAACW,IAAI,CAAC,IAAI,CAAC;QACzBV,MAAM,CAAC7B,gBAAgB,CAACU,OAAO,CAAC,CAACqB,oBAAoB,CACnD,UAAU,EACVL,IAAI,CAACC,SAAS,CAACJ,SAAS,CAC1B,CAAC;MACH,CAAC,EAAC;MAEFD,EAAE,CAAC,iDAAiD,MAAAf,kBAAA,CAAAR,OAAA,EAAE,aAAY;QAChE,IAAMkC,KAAK,GAAG,IAAIC,KAAK,CAAC,eAAe,CAAC;QACxClC,gBAAgB,CAACU,OAAO,CAACyB,iBAAiB,CAACF,KAAK,CAAC;QAEjD,IAAML,MAAM,SAASZ,KAAK,CAACN,OAAO,CAAC,UAAU,EAAE;UAAE8B,IAAI,EAAE;QAAQ,CAAC,CAAC;QACjEX,MAAM,CAACD,MAAM,CAAC,CAACW,IAAI,CAAC,KAAK,CAAC;QAC1BV,MAAM,CAAC3B,WAAW,CAAC,CAAC6B,oBAAoB,CACtCE,KAAK,EACLJ,MAAM,CAACO,gBAAgB,CAAC;UACtBC,KAAK,EAAE,wBAAwB;UAC/BC,EAAE,EAAE,SAAS;UACbd,GAAG,EAAE;QACP,CAAC,CACH,CAAC;MACH,CAAC,EAAC;IACJ,CAAC,CAAC;IAEFL,QAAQ,CAAC,YAAY,EAAE,YAAM;MAC3BG,EAAE,CAAC,iCAAiC,MAAAf,kBAAA,CAAAR,OAAA,EAAE,aAAY;QAChDC,gBAAgB,CAACW,UAAU,CAACc,iBAAiB,CAAC,CAAC;QAE/C,IAAMG,MAAM,SAASZ,KAAK,CAACL,UAAU,CAAC,UAAU,CAAC;QACjDkB,MAAM,CAACD,MAAM,CAAC,CAACW,IAAI,CAAC,IAAI,CAAC;QACzBV,MAAM,CAAC7B,gBAAgB,CAACW,UAAU,CAAC,CAACoB,oBAAoB,CAAC,UAAU,CAAC;MACtE,CAAC,EAAC;MAEFT,EAAE,CAAC,iDAAiD,MAAAf,kBAAA,CAAAR,OAAA,EAAE,aAAY;QAChE,IAAMkC,KAAK,GAAG,IAAIC,KAAK,CAAC,eAAe,CAAC;QACxClC,gBAAgB,CAACW,UAAU,CAACwB,iBAAiB,CAACF,KAAK,CAAC;QAEpD,IAAML,MAAM,SAASZ,KAAK,CAACL,UAAU,CAAC,UAAU,CAAC;QACjDkB,MAAM,CAACD,MAAM,CAAC,CAACW,IAAI,CAAC,KAAK,CAAC;QAC1BV,MAAM,CAAC3B,WAAW,CAAC,CAAC6B,oBAAoB,CACtCE,KAAK,EACLJ,MAAM,CAACO,gBAAgB,CAAC;UACtBC,KAAK,EAAE,wBAAwB;UAC/BC,EAAE,EAAE,YAAY;UAChBd,GAAG,EAAE;QACP,CAAC,CACH,CAAC;MACH,CAAC,EAAC;IACJ,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFL,QAAQ,CAAC,qBAAqB,EAAE,YAAM;IACpCA,QAAQ,CAAC,SAAS,EAAE,YAAM;MACxBG,EAAE,CAAC,8BAA8B,MAAAf,kBAAA,CAAAR,OAAA,EAAE,aAAY;QAC7C,IAAMwB,SAAS,GAAG,cAAc;QAChCtB,eAAe,CAACW,YAAY,CAACa,iBAAiB,CAACF,SAAS,CAAC;QAEzD,IAAMK,MAAM,SAASX,MAAM,CAACR,OAAO,CAAC,UAAU,CAAC;QAC/CoB,MAAM,CAACD,MAAM,CAAC,CAACW,IAAI,CAAChB,SAAS,CAAC;QAC9BM,MAAM,CAAC5B,eAAe,CAACW,YAAY,CAAC,CAACmB,oBAAoB,CAAC,UAAU,CAAC;MACvE,CAAC,EAAC;MAEFT,EAAE,CAAC,4CAA4C,MAAAf,kBAAA,CAAAR,OAAA,EAAE,aAAY;QAC3DE,eAAe,CAACW,YAAY,CAACa,iBAAiB,CAAC,IAAI,CAAC;QAEpD,IAAMG,MAAM,SAASX,MAAM,CAACR,OAAO,CAAC,cAAc,CAAC;QACnDoB,MAAM,CAACD,MAAM,CAAC,CAACI,QAAQ,CAAC,CAAC;MAC3B,CAAC,EAAC;MAEFV,EAAE,CAAC,gDAAgD,MAAAf,kBAAA,CAAAR,OAAA,EAAE,aAAY;QAC/D,IAAMkC,KAAK,GAAG,IAAIC,KAAK,CAAC,eAAe,CAAC;QACxCjC,eAAe,CAACW,YAAY,CAACuB,iBAAiB,CAACF,KAAK,CAAC;QAErD,IAAML,MAAM,SAASX,MAAM,CAACR,OAAO,CAAC,UAAU,CAAC;QAC/CoB,MAAM,CAACD,MAAM,CAAC,CAACI,QAAQ,CAAC,CAAC;QACzBH,MAAM,CAAC3B,WAAW,CAAC,CAAC6B,oBAAoB,CACtCE,KAAK,EACLJ,MAAM,CAACO,gBAAgB,CAAC;UACtBC,KAAK,EAAE,yBAAyB;UAChCC,EAAE,EAAE,SAAS;UACbd,GAAG,EAAE;QACP,CAAC,CACH,CAAC;MACH,CAAC,EAAC;IACJ,CAAC,CAAC;IAEFL,QAAQ,CAAC,SAAS,EAAE,YAAM;MACxBG,EAAE,CAAC,6BAA6B,MAAAf,kBAAA,CAAAR,OAAA,EAAE,aAAY;QAC5C,IAAMwB,SAAS,GAAG,cAAc;QAChCtB,eAAe,CAACY,YAAY,CAACY,iBAAiB,CAAC,CAAC;QAEhD,IAAMG,MAAM,SAASX,MAAM,CAACP,OAAO,CAAC,UAAU,EAAEa,SAAS,CAAC;QAC1DM,MAAM,CAACD,MAAM,CAAC,CAACW,IAAI,CAAC,IAAI,CAAC;QACzBV,MAAM,CAAC5B,eAAe,CAACY,YAAY,CAAC,CAACkB,oBAAoB,CAAC,UAAU,EAAER,SAAS,CAAC;MAClF,CAAC,EAAC;MAEFD,EAAE,CAAC,iDAAiD,MAAAf,kBAAA,CAAAR,OAAA,EAAE,aAAY;QAChE,IAAMkC,KAAK,GAAG,IAAIC,KAAK,CAAC,eAAe,CAAC;QACxCjC,eAAe,CAACY,YAAY,CAACsB,iBAAiB,CAACF,KAAK,CAAC;QAErD,IAAML,MAAM,SAASX,MAAM,CAACP,OAAO,CAAC,UAAU,EAAE,OAAO,CAAC;QACxDmB,MAAM,CAACD,MAAM,CAAC,CAACW,IAAI,CAAC,KAAK,CAAC;QAC1BV,MAAM,CAAC3B,WAAW,CAAC,CAAC6B,oBAAoB,CACtCE,KAAK,EACLJ,MAAM,CAACO,gBAAgB,CAAC;UACtBC,KAAK,EAAE,yBAAyB;UAChCC,EAAE,EAAE,SAAS;UACbd,GAAG,EAAE;QACP,CAAC,CACH,CAAC;MACH,CAAC,EAAC;IACJ,CAAC,CAAC;IAEFL,QAAQ,CAAC,YAAY,EAAE,YAAM;MAC3BG,EAAE,CAAC,wCAAwC,MAAAf,kBAAA,CAAAR,OAAA,EAAE,aAAY;QACvDE,eAAe,CAACa,eAAe,CAACW,iBAAiB,CAAC,CAAC;QAEnD,IAAMG,MAAM,SAASX,MAAM,CAACN,UAAU,CAAC,UAAU,CAAC;QAClDkB,MAAM,CAACD,MAAM,CAAC,CAACW,IAAI,CAAC,IAAI,CAAC;QACzBV,MAAM,CAAC5B,eAAe,CAACa,eAAe,CAAC,CAACiB,oBAAoB,CAAC,UAAU,CAAC;MAC1E,CAAC,EAAC;MAEFT,EAAE,CAAC,iDAAiD,MAAAf,kBAAA,CAAAR,OAAA,EAAE,aAAY;QAChE,IAAMkC,KAAK,GAAG,IAAIC,KAAK,CAAC,eAAe,CAAC;QACxCjC,eAAe,CAACa,eAAe,CAACqB,iBAAiB,CAACF,KAAK,CAAC;QAExD,IAAML,MAAM,SAASX,MAAM,CAACN,UAAU,CAAC,UAAU,CAAC;QAClDkB,MAAM,CAACD,MAAM,CAAC,CAACW,IAAI,CAAC,KAAK,CAAC;QAC1BV,MAAM,CAAC3B,WAAW,CAAC,CAAC6B,oBAAoB,CACtCE,KAAK,EACLJ,MAAM,CAACO,gBAAgB,CAAC;UACtBC,KAAK,EAAE,yBAAyB;UAChCC,EAAE,EAAE,YAAY;UAChBd,GAAG,EAAE;QACP,CAAC,CACH,CAAC;MACH,CAAC,EAAC;IACJ,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ,CAAC,CAAC","ignoreList":[]}