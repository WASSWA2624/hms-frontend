678d2f8e4c6c724af6fc1e2c25728d4c
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.apiClient = void 0;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _config = require("../../config");
var _errors = require("../../errors");
var _interceptors = require("./interceptors");
var apiClient = exports.apiClient = function () {
  var _ref = (0, _asyncToGenerator2.default)(function* (config) {
    var url = config.url,
      _config$method = config.method,
      method = _config$method === void 0 ? 'GET' : _config$method,
      body = config.body,
      _config$headers = config.headers,
      headers = _config$headers === void 0 ? {} : _config$headers,
      _config$timeout = config.timeout,
      timeout = _config$timeout === void 0 ? _config.TIMEOUTS.API_REQUEST : _config$timeout;
    var authConfig = yield (0, _interceptors.attachAuthHeader)({
      url: url,
      method: method,
      body: body,
      headers: headers
    });
    var controller = new AbortController();
    var timeoutId = setTimeout(function () {
      return controller.abort();
    }, timeout);
    try {
      var _response$headers;
      var response = yield fetch(authConfig.url, {
        method: authConfig.method,
        headers: Object.assign({
          'Content-Type': 'application/json'
        }, authConfig.headers),
        body: authConfig.body ? JSON.stringify(authConfig.body) : undefined,
        signal: controller.signal
      });
      clearTimeout(timeoutId);
      if (!response.ok) {
        var error = {
          status: response.status,
          statusText: response.statusText,
          message: `API request failed: ${response.statusText}`
        };
        throw yield (0, _interceptors.handleAuthError)(error);
      }
      var contentType = ((_response$headers = response.headers) == null || _response$headers.get == null ? void 0 : _response$headers.get('content-type')) || '';
      var hasJson = contentType.includes('application/json');
      var data = hasJson ? yield response.json() : null;
      return {
        data: data,
        status: response.status
      };
    } catch (error) {
      clearTimeout(timeoutId);
      if (error.name === 'AbortError') {
        throw (0, _errors.handleError)(new Error('Request timeout'), {
          url: url
        });
      }
      throw yield (0, _interceptors.handleAuthError)(error);
    }
  });
  return function apiClient(_x) {
    return _ref.apply(this, arguments);
  };
}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfY29uZmlnIiwicmVxdWlyZSIsIl9lcnJvcnMiLCJfaW50ZXJjZXB0b3JzIiwiYXBpQ2xpZW50IiwiZXhwb3J0cyIsIl9yZWYiLCJfYXN5bmNUb0dlbmVyYXRvcjIiLCJkZWZhdWx0IiwiY29uZmlnIiwidXJsIiwiX2NvbmZpZyRtZXRob2QiLCJtZXRob2QiLCJib2R5IiwiX2NvbmZpZyRoZWFkZXJzIiwiaGVhZGVycyIsIl9jb25maWckdGltZW91dCIsInRpbWVvdXQiLCJUSU1FT1VUUyIsIkFQSV9SRVFVRVNUIiwiYXV0aENvbmZpZyIsImF0dGFjaEF1dGhIZWFkZXIiLCJjb250cm9sbGVyIiwiQWJvcnRDb250cm9sbGVyIiwidGltZW91dElkIiwic2V0VGltZW91dCIsImFib3J0IiwiX3Jlc3BvbnNlJGhlYWRlcnMiLCJyZXNwb25zZSIsImZldGNoIiwiT2JqZWN0IiwiYXNzaWduIiwiSlNPTiIsInN0cmluZ2lmeSIsInVuZGVmaW5lZCIsInNpZ25hbCIsImNsZWFyVGltZW91dCIsIm9rIiwiZXJyb3IiLCJzdGF0dXMiLCJzdGF0dXNUZXh0IiwibWVzc2FnZSIsImhhbmRsZUF1dGhFcnJvciIsImNvbnRlbnRUeXBlIiwiZ2V0IiwiaGFzSnNvbiIsImluY2x1ZGVzIiwiZGF0YSIsImpzb24iLCJuYW1lIiwiaGFuZGxlRXJyb3IiLCJFcnJvciIsIl94IiwiYXBwbHkiLCJhcmd1bWVudHMiXSwic291cmNlcyI6WyJjbGllbnQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEFQSSBDbGllbnRcclxuICogQ2VudHJhbGl6ZWQgZmV0Y2ggd3JhcHBlclxyXG4gKiBGaWxlOiBjbGllbnQuanNcclxuICovXHJcbmltcG9ydCB7IFRJTUVPVVRTIH0gZnJvbSAnQGNvbmZpZyc7XHJcbmltcG9ydCB7IGhhbmRsZUVycm9yIH0gZnJvbSAnQGVycm9ycyc7XHJcbmltcG9ydCB7IGF0dGFjaEF1dGhIZWFkZXIsIGhhbmRsZUF1dGhFcnJvciB9IGZyb20gJy4vaW50ZXJjZXB0b3JzJztcclxuXHJcbmNvbnN0IGFwaUNsaWVudCA9IGFzeW5jIChjb25maWcpID0+IHtcclxuICBjb25zdCB7XHJcbiAgICB1cmwsXHJcbiAgICBtZXRob2QgPSAnR0VUJyxcclxuICAgIGJvZHksXHJcbiAgICBoZWFkZXJzID0ge30sXHJcbiAgICB0aW1lb3V0ID0gVElNRU9VVFMuQVBJX1JFUVVFU1QsXHJcbiAgfSA9IGNvbmZpZztcclxuXHJcbiAgLy8gQXR0YWNoIGF1dGggaGVhZGVyXHJcbiAgY29uc3QgYXV0aENvbmZpZyA9IGF3YWl0IGF0dGFjaEF1dGhIZWFkZXIoeyB1cmwsIG1ldGhvZCwgYm9keSwgaGVhZGVycyB9KTtcclxuXHJcbiAgLy8gQ3JlYXRlIGFib3J0IGNvbnRyb2xsZXIgZm9yIHRpbWVvdXRcclxuICBjb25zdCBjb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpO1xyXG4gIGNvbnN0IHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4gY29udHJvbGxlci5hYm9ydCgpLCB0aW1lb3V0KTtcclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYXV0aENvbmZpZy51cmwsIHtcclxuICAgICAgbWV0aG9kOiBhdXRoQ29uZmlnLm1ldGhvZCxcclxuICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgLi4uYXV0aENvbmZpZy5oZWFkZXJzLFxyXG4gICAgICB9LFxyXG4gICAgICBib2R5OiBhdXRoQ29uZmlnLmJvZHkgPyBKU09OLnN0cmluZ2lmeShhdXRoQ29uZmlnLmJvZHkpIDogdW5kZWZpbmVkLFxyXG4gICAgICBzaWduYWw6IGNvbnRyb2xsZXIuc2lnbmFsLFxyXG4gICAgfSk7XHJcblxyXG4gICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7XHJcblxyXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xyXG4gICAgICBjb25zdCBlcnJvciA9IHtcclxuICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cyxcclxuICAgICAgICBzdGF0dXNUZXh0OiByZXNwb25zZS5zdGF0dXNUZXh0LFxyXG4gICAgICAgIG1lc3NhZ2U6IGBBUEkgcmVxdWVzdCBmYWlsZWQ6ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gLFxyXG4gICAgICB9O1xyXG4gICAgICB0aHJvdyBhd2FpdCBoYW5kbGVBdXRoRXJyb3IoZXJyb3IpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNvbnRlbnRUeXBlID0gcmVzcG9uc2UuaGVhZGVycz8uZ2V0Py4oJ2NvbnRlbnQtdHlwZScpIHx8ICcnO1xyXG4gICAgY29uc3QgaGFzSnNvbiA9IGNvbnRlbnRUeXBlLmluY2x1ZGVzKCdhcHBsaWNhdGlvbi9qc29uJyk7XHJcbiAgICBjb25zdCBkYXRhID0gaGFzSnNvbiA/IGF3YWl0IHJlc3BvbnNlLmpzb24oKSA6IG51bGw7XHJcbiAgICByZXR1cm4geyBkYXRhLCBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cyB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcclxuICAgIGlmIChlcnJvci5uYW1lID09PSAnQWJvcnRFcnJvcicpIHtcclxuICAgICAgdGhyb3cgaGFuZGxlRXJyb3IobmV3IEVycm9yKCdSZXF1ZXN0IHRpbWVvdXQnKSwgeyB1cmwgfSk7XHJcbiAgICB9XHJcbiAgICB0aHJvdyBhd2FpdCBoYW5kbGVBdXRoRXJyb3IoZXJyb3IpO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydCB7IGFwaUNsaWVudCB9O1xyXG5cclxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFLQSxJQUFBQSxPQUFBLEdBQUFDLE9BQUE7QUFDQSxJQUFBQyxPQUFBLEdBQUFELE9BQUE7QUFDQSxJQUFBRSxhQUFBLEdBQUFGLE9BQUE7QUFFQSxJQUFNRyxTQUFTLEdBQUFDLE9BQUEsQ0FBQUQsU0FBQTtFQUFBLElBQUFFLElBQUEsT0FBQUMs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