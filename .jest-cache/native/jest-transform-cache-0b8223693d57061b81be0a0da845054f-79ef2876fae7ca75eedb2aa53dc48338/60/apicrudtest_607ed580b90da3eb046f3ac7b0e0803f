3ee59bdbbceb18e411d7cee57298c23a
_getJestObj().mock("../../services/api/client", function () {
  return {
    apiClient: jest.fn()
  };
});
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _crud = require("../../services/api/crud");
var _client = require("../../services/api/client");
function _getJestObj() {
  var _require = require("@jest/globals"),
    jest = _require.jest;
  _getJestObj = function _getJestObj() {
    return jest;
  };
  return jest;
}
describe('crud api helpers', function () {
  beforeEach(function () {
    _client.apiClient.mockClear();
  });
  it('builds query strings deterministically', function () {
    expect((0, _crud.buildQueryString)()).toBe('');
    expect((0, _crud.buildQueryString)({})).toBe('');
    expect((0, _crud.buildQueryString)({
      page: 1,
      limit: 10
    })).toBe('?page=1&limit=10');
    expect((0, _crud.buildQueryString)({
      tags: ['a', 'b']
    })).toBe('?tags=a&tags=b');
  });
  it('creates CRUD api handlers', (0, _asyncToGenerator2.default)(function* () {
    var endpoints = {
      LIST: '/items',
      CREATE: '/items',
      GET: function GET(id) {
        return `/items/${id}`;
      },
      UPDATE: function UPDATE(id) {
        return `/items/${id}`;
      },
      DELETE: function DELETE(id) {
        return `/items/${id}`;
      }
    };
    var api = (0, _crud.createCrudApi)(endpoints);
    yield api.list({
      page: 2
    });
    yield api.get('1');
    yield api.create({
      name: 'Item'
    });
    yield api.update('1', {
      name: 'Updated'
    });
    yield api.remove('1');
    expect(_client.apiClient).toHaveBeenCalledWith({
      url: '/items?page=2',
      method: 'GET'
    });
    expect(_client.apiClient).toHaveBeenCalledWith({
      url: '/items/1',
      method: 'GET'
    });
    expect(_client.apiClient).toHaveBeenCalledWith({
      url: '/items',
      method: 'POST',
      body: {
        name: 'Item'
      }
    });
    expect(_client.apiClient).toHaveBeenCalledWith({
      url: '/items/1',
      method: 'PUT',
      body: {
        name: 'Updated'
      }
    });
    expect(_client.apiClient).toHaveBeenCalledWith({
      url: '/items/1',
      method: 'DELETE'
    });
  }));
  it('throws for missing endpoints', function () {
    expect(function () {
      return (0, _crud.createCrudApi)({});
    }).toThrow('Missing endpoint');
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZ2V0SmVzdE9iaiIsIm1vY2siLCJhcGlDbGllbnQiLCJqZXN0IiwiZm4iLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsImRlZmF1bHQiLCJfYXN5bmNUb0dlbmVyYXRvcjIiLCJfY3J1ZCIsIl9jbGllbnQiLCJfcmVxdWlyZSIsImRlc2NyaWJlIiwiYmVmb3JlRWFjaCIsIm1vY2tDbGVhciIsIml0IiwiZXhwZWN0IiwiYnVpbGRRdWVyeVN0cmluZyIsInRvQmUiLCJwYWdlIiwibGltaXQiLCJ0YWdzIiwiZW5kcG9pbnRzIiwiTElTVCIsIkNSRUFURSIsIkdFVCIsImlkIiwiVVBEQVRFIiwiREVMRVRFIiwiYXBpIiwiY3JlYXRlQ3J1ZEFwaSIsImxpc3QiLCJnZXQiLCJjcmVhdGUiLCJuYW1lIiwidXBkYXRlIiwicmVtb3ZlIiwidG9IYXZlQmVlbkNhbGxlZFdpdGgiLCJ1cmwiLCJtZXRob2QiLCJib2R5IiwidG9UaHJvdyJdLCJzb3VyY2VzIjpbImFwaS5jcnVkLnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENSVUQgQVBJIEZhY3RvcnkgVGVzdHNcclxuICogRmlsZTogYXBpLmNydWQudGVzdC5qc1xyXG4gKi9cclxuaW1wb3J0IHsgYnVpbGRRdWVyeVN0cmluZywgY3JlYXRlQ3J1ZEFwaSB9IGZyb20gJ0BzZXJ2aWNlcy9hcGkvY3J1ZCc7XHJcbmltcG9ydCB7IGFwaUNsaWVudCB9IGZyb20gJ0BzZXJ2aWNlcy9hcGkvY2xpZW50JztcclxuXHJcbmplc3QubW9jaygnQHNlcnZpY2VzL2FwaS9jbGllbnQnLCAoKSA9PiAoe1xyXG4gIGFwaUNsaWVudDogamVzdC5mbigpLFxyXG59KSk7XHJcblxyXG5kZXNjcmliZSgnY3J1ZCBhcGkgaGVscGVycycsICgpID0+IHtcclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIGFwaUNsaWVudC5tb2NrQ2xlYXIoKTtcclxuICB9KTtcclxuXHJcbiAgaXQoJ2J1aWxkcyBxdWVyeSBzdHJpbmdzIGRldGVybWluaXN0aWNhbGx5JywgKCkgPT4ge1xyXG4gICAgZXhwZWN0KGJ1aWxkUXVlcnlTdHJpbmcoKSkudG9CZSgnJyk7XHJcbiAgICBleHBlY3QoYnVpbGRRdWVyeVN0cmluZyh7fSkpLnRvQmUoJycpO1xyXG4gICAgZXhwZWN0KGJ1aWxkUXVlcnlTdHJpbmcoeyBwYWdlOiAxLCBsaW1pdDogMTAgfSkpLnRvQmUoJz9wYWdlPTEmbGltaXQ9MTAnKTtcclxuICAgIGV4cGVjdChidWlsZFF1ZXJ5U3RyaW5nKHsgdGFnczogWydhJywgJ2InXSB9KSkudG9CZSgnP3RhZ3M9YSZ0YWdzPWInKTtcclxuICB9KTtcclxuXHJcbiAgaXQoJ2NyZWF0ZXMgQ1JVRCBhcGkgaGFuZGxlcnMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCBlbmRwb2ludHMgPSB7XHJcbiAgICAgIExJU1Q6ICcvaXRlbXMnLFxyXG4gICAgICBDUkVBVEU6ICcvaXRlbXMnLFxyXG4gICAgICBHRVQ6IChpZCkgPT4gYC9pdGVtcy8ke2lkfWAsXHJcbiAgICAgIFVQREFURTogKGlkKSA9PiBgL2l0ZW1zLyR7aWR9YCxcclxuICAgICAgREVMRVRFOiAoaWQpID0+IGAvaXRlbXMvJHtpZH1gLFxyXG4gICAgfTtcclxuICAgIGNvbnN0IGFwaSA9IGNyZWF0ZUNydWRBcGkoZW5kcG9pbnRzKTtcclxuICAgIGF3YWl0IGFwaS5saXN0KHsgcGFnZTogMiB9KTtcclxuICAgIGF3YWl0IGFwaS5nZXQoJzEnKTtcclxuICAgIGF3YWl0IGFwaS5jcmVhdGUoeyBuYW1lOiAnSXRlbScgfSk7XHJcbiAgICBhd2FpdCBhcGkudXBkYXRlKCcxJywgeyBuYW1lOiAnVXBkYXRlZCcgfSk7XHJcbiAgICBhd2FpdCBhcGkucmVtb3ZlKCcxJyk7XHJcblxyXG4gICAgZXhwZWN0KGFwaUNsaWVudCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoeyB1cmw6ICcvaXRlbXM/cGFnZT0yJywgbWV0aG9kOiAnR0VUJyB9KTtcclxuICAgIGV4cGVjdChhcGlDbGllbnQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHsgdXJsOiAnL2l0ZW1zLzEnLCBtZXRob2Q6ICdHRVQnIH0pO1xyXG4gICAgZXhwZWN0KGFwaUNsaWVudCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoeyB1cmw6ICcvaXRlbXMnLCBtZXRob2Q6ICdQT1NUJywgYm9keTogeyBuYW1lOiAnSXRlbScgfSB9KTtcclxuICAgIGV4cGVjdChhcGlDbGllbnQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcclxuICAgICAgdXJsOiAnL2l0ZW1zLzEnLFxyXG4gICAgICBtZXRob2Q6ICdQVVQnLFxyXG4gICAgICBib2R5OiB7IG5hbWU6ICdVcGRhdGVkJyB9LFxyXG4gICAgfSk7XHJcbiAgICBleHBlY3QoYXBpQ2xpZW50KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7IHVybDogJy9pdGVtcy8xJywgbWV0aG9kOiAnREVMRVRFJyB9KTtcclxuICB9KTtcclxuXHJcbiAgaXQoJ3Rocm93cyBmb3IgbWlzc2luZyBlbmRwb2ludHMnLCAoKSA9PiB7XHJcbiAgICBleHBlY3QoKCkgPT4gY3JlYXRlQ3J1ZEFwaSh7fSkpLnRvVGhyb3coJ01pc3NpbmcgZW5kcG9pbnQnKTtcclxuICB9KTtcclxufSk7XHJcbiJdLCJtYXBwaW5ncyI6IkFBT0FBLFdBQUEsR0FBS0MsSUFBSSw4QkFBeUI7RUFBQSxPQUFPO0lBQ3ZDQyxTQUFTLEVBQUVDLElBQUksQ0FBQ0MsRUFBRSxDQUFDO0VBQ3JCLENBQUM7QUFBQSxDQUFDLENBQUM7QUFBQyxJQUFBQyxzQkFBQSxHQUFBQyxPQUFBLGlEQUFBQyxPQUFBO0FBQUEsSUFBQUMsa0JBQUEsR0FBQUgsc0JBQUEsQ0FBQUMsT0FBQTtBQUxKLElBQUFHLEtBQUEsR0FBQUgsT0FBQTtBQUNBLElBQUFJLE9BQUEsR0FBQUosT0FBQTtBQUFpRCxTQUFBTixZQUFBO0VBQUEsSUFBQVcsUUFBQSxHQUFBTCxPQUFBO0lBQUFILElBQUEsR0FBQVEsUUFBQSxDQUFBUixJQUFBO0VBQUFILFdBQUEsWUFB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