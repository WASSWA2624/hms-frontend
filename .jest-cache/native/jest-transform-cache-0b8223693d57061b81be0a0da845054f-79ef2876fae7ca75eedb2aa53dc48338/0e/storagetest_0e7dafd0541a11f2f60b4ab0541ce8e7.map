{"version":3,"names":["_getJestObj","mock","__esModule","default","mockAsyncStorage","mockSecureStore","handleError","jest","fn","_interopRequireDefault","require","_asyncToGenerator2","_require3","getItem","setItem","removeItem","isAvailableAsync","mockResolvedValue","getItemAsync","setItemAsync","deleteItemAsync","_require","async","secure","_require2","describe","beforeEach","clearAllMocks","it","testValue","key","JSON","stringify","result","expect","toEqual","toHaveBeenCalledWith","toBeNull","error","Error","mockRejectedValue","objectContaining","scope","op","toBe","data"],"sources":["storage.test.js"],"sourcesContent":["/**\r\n * Storage Services Tests\r\n * File: storage.test.js\r\n */\r\n// Mock AsyncStorage\r\nconst mockAsyncStorage = {\r\n  getItem: jest.fn(),\r\n  setItem: jest.fn(),\r\n  removeItem: jest.fn(),\r\n};\r\n\r\njest.mock('@react-native-async-storage/async-storage', () => ({\r\n  __esModule: true,\r\n  default: mockAsyncStorage,\r\n}));\r\n\r\n// Mock SecureStore\r\nconst mockSecureStore = {\r\n  isAvailableAsync: jest.fn().mockResolvedValue(true),\r\n  getItemAsync: jest.fn(),\r\n  setItemAsync: jest.fn(),\r\n  deleteItemAsync: jest.fn(),\r\n};\r\n\r\njest.mock('expo-secure-store', () => mockSecureStore);\r\n\r\n// Mock error handler (services must not log directly; errors are routed via @errors)\r\njest.mock('@errors', () => ({\r\n  handleError: jest.fn(),\r\n}));\r\n\r\nconst { async, secure } = require('@services/storage');\r\nconst { handleError } = require('@errors');\r\n\r\ndescribe('Storage Services', () => {\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  describe('AsyncStorage Service', () => {\r\n    describe('getItem', () => {\r\n      it('should retrieve and parse stored value', async () => {\r\n        const testValue = { key: 'value' };\r\n        mockAsyncStorage.getItem.mockResolvedValue(JSON.stringify(testValue));\r\n\r\n        const result = await async.getItem('test-key');\r\n        expect(result).toEqual(testValue);\r\n        expect(mockAsyncStorage.getItem).toHaveBeenCalledWith('test-key');\r\n      });\r\n\r\n      it('should return null when key does not exist', async () => {\r\n        mockAsyncStorage.getItem.mockResolvedValue(null);\r\n\r\n        const result = await async.getItem('non-existent');\r\n        expect(result).toBeNull();\r\n      });\r\n\r\n      it('should return null and report error on failure', async () => {\r\n        const error = new Error('Storage error');\r\n        mockAsyncStorage.getItem.mockRejectedValue(error);\r\n\r\n        const result = await async.getItem('test-key');\r\n        expect(result).toBeNull();\r\n        expect(handleError).toHaveBeenCalledWith(\r\n          error,\r\n          expect.objectContaining({\r\n            scope: 'services.storage.async',\r\n            op: 'getItem',\r\n            key: 'test-key',\r\n          })\r\n        );\r\n      });\r\n    });\r\n\r\n    describe('setItem', () => {\r\n      it('should store value as JSON string', async () => {\r\n        const testValue = { key: 'value' };\r\n        mockAsyncStorage.setItem.mockResolvedValue();\r\n\r\n        const result = await async.setItem('test-key', testValue);\r\n        expect(result).toBe(true);\r\n        expect(mockAsyncStorage.setItem).toHaveBeenCalledWith(\r\n          'test-key',\r\n          JSON.stringify(testValue)\r\n        );\r\n      });\r\n\r\n      it('should return false and report error on failure', async () => {\r\n        const error = new Error('Storage error');\r\n        mockAsyncStorage.setItem.mockRejectedValue(error);\r\n\r\n        const result = await async.setItem('test-key', { data: 'value' });\r\n        expect(result).toBe(false);\r\n        expect(handleError).toHaveBeenCalledWith(\r\n          error,\r\n          expect.objectContaining({\r\n            scope: 'services.storage.async',\r\n            op: 'setItem',\r\n            key: 'test-key',\r\n          })\r\n        );\r\n      });\r\n    });\r\n\r\n    describe('removeItem', () => {\r\n      it('should remove item from storage', async () => {\r\n        mockAsyncStorage.removeItem.mockResolvedValue();\r\n\r\n        const result = await async.removeItem('test-key');\r\n        expect(result).toBe(true);\r\n        expect(mockAsyncStorage.removeItem).toHaveBeenCalledWith('test-key');\r\n      });\r\n\r\n      it('should return false and report error on failure', async () => {\r\n        const error = new Error('Storage error');\r\n        mockAsyncStorage.removeItem.mockRejectedValue(error);\r\n\r\n        const result = await async.removeItem('test-key');\r\n        expect(result).toBe(false);\r\n        expect(handleError).toHaveBeenCalledWith(\r\n          error,\r\n          expect.objectContaining({\r\n            scope: 'services.storage.async',\r\n            op: 'removeItem',\r\n            key: 'test-key',\r\n          })\r\n        );\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('SecureStore Service', () => {\r\n    describe('getItem', () => {\r\n      it('should retrieve stored value', async () => {\r\n        const testValue = 'secure-value';\r\n        mockSecureStore.getItemAsync.mockResolvedValue(testValue);\r\n\r\n        const result = await secure.getItem('test-key');\r\n        expect(result).toBe(testValue);\r\n        expect(mockSecureStore.getItemAsync).toHaveBeenCalledWith('test-key');\r\n      });\r\n\r\n      it('should return null when key does not exist', async () => {\r\n        mockSecureStore.getItemAsync.mockResolvedValue(null);\r\n\r\n        const result = await secure.getItem('non-existent');\r\n        expect(result).toBeNull();\r\n      });\r\n\r\n      it('should return null and report error on failure', async () => {\r\n        const error = new Error('Storage error');\r\n        mockSecureStore.getItemAsync.mockRejectedValue(error);\r\n\r\n        const result = await secure.getItem('test-key');\r\n        expect(result).toBeNull();\r\n        expect(handleError).toHaveBeenCalledWith(\r\n          error,\r\n          expect.objectContaining({\r\n            scope: 'services.storage.secure',\r\n            op: 'getItem',\r\n            key: 'test-key',\r\n          })\r\n        );\r\n      });\r\n    });\r\n\r\n    describe('setItem', () => {\r\n      it('should store value securely', async () => {\r\n        const testValue = 'secure-value';\r\n        mockSecureStore.setItemAsync.mockResolvedValue();\r\n\r\n        const result = await secure.setItem('test-key', testValue);\r\n        expect(result).toBe(true);\r\n        expect(mockSecureStore.setItemAsync).toHaveBeenCalledWith('test-key', testValue);\r\n      });\r\n\r\n      it('should return false and report error on failure', async () => {\r\n        const error = new Error('Storage error');\r\n        mockSecureStore.setItemAsync.mockRejectedValue(error);\r\n\r\n        const result = await secure.setItem('test-key', 'value');\r\n        expect(result).toBe(false);\r\n        expect(handleError).toHaveBeenCalledWith(\r\n          error,\r\n          expect.objectContaining({\r\n            scope: 'services.storage.secure',\r\n            op: 'setItem',\r\n            key: 'test-key',\r\n          })\r\n        );\r\n      });\r\n    });\r\n\r\n    describe('removeItem', () => {\r\n      it('should remove item from secure storage', async () => {\r\n        mockSecureStore.deleteItemAsync.mockResolvedValue();\r\n\r\n        const result = await secure.removeItem('test-key');\r\n        expect(result).toBe(true);\r\n        expect(mockSecureStore.deleteItemAsync).toHaveBeenCalledWith('test-key');\r\n      });\r\n\r\n      it('should return false and report error on failure', async () => {\r\n        const error = new Error('Storage error');\r\n        mockSecureStore.deleteItemAsync.mockRejectedValue(error);\r\n\r\n        const result = await secure.removeItem('test-key');\r\n        expect(result).toBe(false);\r\n        expect(handleError).toHaveBeenCalledWith(\r\n          error,\r\n          expect.objectContaining({\r\n            scope: 'services.storage.secure',\r\n            op: 'removeItem',\r\n            key: 'test-key',\r\n          })\r\n        );\r\n      });\r\n    });\r\n  });\r\n});\r\n\r\n"],"mappings":"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","ignoreList":[]}