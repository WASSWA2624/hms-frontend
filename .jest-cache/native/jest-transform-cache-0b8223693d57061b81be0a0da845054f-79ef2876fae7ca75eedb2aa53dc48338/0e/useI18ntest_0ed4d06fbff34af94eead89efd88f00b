1dff83eea34d3fa1e8ce27510afe7538
var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard").default;
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _react = _interopRequireDefault(require("react"));
var _reactNative = require("@testing-library/react-native");
var _reactRedux = require("react-redux");
var _toolkit = require("@reduxjs/toolkit");
var _useI18n = _interopRequireDefault(require("../../hooks/useI18n"));
var _rootReducer = _interopRequireDefault(require("../../store/rootReducer"));
var i18n = _interopRequireWildcard(require("../../i18n"));
var _jsxRuntime = require("react/jsx-runtime");
var createMockStore = function createMockStore() {
  var preloadedState = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
  return (0, _toolkit.configureStore)({
    reducer: _rootReducer.default,
    preloadedState: preloadedState
  });
};
var TestComponent = function TestComponent(_ref) {
  var onResult = _ref.onResult;
  var api = (0, _useI18n.default)();
  _react.default.useEffect(function () {
    onResult(api);
  });
  return null;
};
describe('useI18n', function () {
  it('returns translator that resolves known keys', (0, _asyncToGenerator2.default)(function* () {
    var store = createMockStore({
      ui: {
        theme: 'light',
        locale: 'en',
        isLoading: false
      }
    });
    var result;
    (0, _reactNative.render)((0, _jsxRuntime.jsx)(_reactRedux.Provider, {
      store: store,
      children: (0, _jsxRuntime.jsx)(TestComponent, {
        onResult: function onResult(value) {
          return result = value;
        }
      })
    }));
    yield (0, _reactNative.waitFor)(function () {
      expect(result.locale).toBe('en');
      expect(result.t('common.save')).toBe('Save');
    });
  }));
  it('returns deterministic fallback for missing keys (never throws)', (0, _asyncToGenerator2.default)(function* () {
    var store = createMockStore({
      ui: {
        theme: 'light',
        locale: 'en',
        isLoading: false
      }
    });
    var result;
    (0, _reactNative.render)((0, _jsxRuntime.jsx)(_reactRedux.Provider, {
      store: store,
      children: (0, _jsxRuntime.jsx)(TestComponent, {
        onResult: function onResult(value) {
          return result = value;
        }
      })
    }));
    yield (0, _reactNative.waitFor)(function () {
      expect(result.t('missing.key.path')).toBe('missing.key.path');
    });
  }));
  it('supports interpolation when i18n implementation provides it', (0, _asyncToGenerator2.default)(function* () {
    var spy = jest.spyOn(i18n, 'createI18n').mockImplementation(function () {
      return {
        tSync: function tSync(key, params) {
          return key === 'greeting.hello' ? `Hi ${(params == null ? void 0 : params.name) || ''}`.trim() : key;
        }
      };
    });
    var store = createMockStore({
      ui: {
        theme: 'light',
        locale: 'en',
        isLoading: false
      }
    });
    var result;
    (0, _reactNative.render)((0, _jsxRuntime.jsx)(_reactRedux.Provider, {
      store: store,
      children: (0, _jsxRuntime.jsx)(TestComponent, {
        onResult: function onResult(value) {
          return result = value;
        }
      })
    }));
    yield (0, _reactNative.waitFor)(function () {
      expect(result.t('greeting.hello', {
        name: 'Ada'
      })).toBe('Hi Ada');
    });
    spy.mockRestore();
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9yZWFjdE5hdGl2ZSIsIl9yZWFjdFJlZHV4IiwiX3Rvb2xraXQiLCJfdXNlSTE4biIsIl9yb290UmVkdWNlciIsImkxOG4iLCJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsIl9qc3hSdW50aW1lIiwiY3JlYXRlTW9ja1N0b3JlIiwicHJlbG9hZGVkU3RhdGUiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJjb25maWd1cmVTdG9yZSIsInJlZHVjZXIiLCJyb290UmVkdWNlciIsIlRlc3RDb21wb25lbnQiLCJfcmVmIiwib25SZXN1bHQiLCJhcGkiLCJ1c2VJMThuIiwiUmVhY3QiLCJ1c2VFZmZlY3QiLCJkZXNjcmliZSIsIml0IiwiX2FzeW5jVG9HZW5lcmF0b3IyIiwiZGVmYXVsdCIsInN0b3JlIiwidWkiLCJ0aGVtZSIsImxvY2FsZSIsImlzTG9hZGluZyIsInJlc3VsdCIsInJlbmRlciIsImpzeCIsIlByb3ZpZGVyIiwiY2hpbGRyZW4iLCJ2YWx1ZSIsIndhaXRGb3IiLCJleHBlY3QiLCJ0b0JlIiwidCIsInNweSIsImplc3QiLCJzcHlPbiIsIm1vY2tJbXBsZW1lbnRhdGlvbiIsInRTeW5jIiwia2V5IiwicGFyYW1zIiwibmFtZSIsInRyaW0iLCJtb2NrUmVzdG9yZSJdLCJzb3VyY2VzIjpbInVzZUkxOG4udGVzdC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogdXNlSTE4biBIb29rIFRlc3RzXHJcbiAqIEZpbGU6IHVzZUkxOG4udGVzdC5qc1xyXG4gKi9cclxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IHsgcmVuZGVyLCB3YWl0Rm9yIH0gZnJvbSAnQHRlc3RpbmctbGlicmFyeS9yZWFjdC1uYXRpdmUnO1xyXG5pbXBvcnQgeyBQcm92aWRlciB9IGZyb20gJ3JlYWN0LXJlZHV4JztcclxuaW1wb3J0IHsgY29uZmlndXJlU3RvcmUgfSBmcm9tICdAcmVkdXhqcy90b29sa2l0JztcclxuaW1wb3J0IHVzZUkxOG4gZnJvbSAnQGhvb2tzL3VzZUkxOG4nO1xyXG5pbXBvcnQgcm9vdFJlZHVjZXIgZnJvbSAnQHN0b3JlL3Jvb3RSZWR1Y2VyJztcclxuaW1wb3J0ICogYXMgaTE4biBmcm9tICdAaTE4bic7XHJcblxyXG5jb25zdCBjcmVhdGVNb2NrU3RvcmUgPSAocHJlbG9hZGVkU3RhdGUgPSB7fSkgPT5cclxuICBjb25maWd1cmVTdG9yZSh7XHJcbiAgICByZWR1Y2VyOiByb290UmVkdWNlcixcclxuICAgIHByZWxvYWRlZFN0YXRlLFxyXG4gIH0pO1xyXG5cclxuY29uc3QgVGVzdENvbXBvbmVudCA9ICh7IG9uUmVzdWx0IH0pID0+IHtcclxuICBjb25zdCBhcGkgPSB1c2VJMThuKCk7XHJcbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcclxuICAgIG9uUmVzdWx0KGFwaSk7XHJcbiAgfSk7XHJcbiAgcmV0dXJuIG51bGw7XHJcbn07XHJcblxyXG5kZXNjcmliZSgndXNlSTE4bicsICgpID0+IHtcclxuICBpdCgncmV0dXJucyB0cmFuc2xhdG9yIHRoYXQgcmVzb2x2ZXMga25vd24ga2V5cycsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IHN0b3JlID0gY3JlYXRlTW9ja1N0b3JlKHtcclxuICAgICAgdWk6IHsgdGhlbWU6ICdsaWdodCcsIGxvY2FsZTogJ2VuJywgaXNMb2FkaW5nOiBmYWxzZSB9LFxyXG4gICAgfSk7XHJcblxyXG4gICAgbGV0IHJlc3VsdDtcclxuICAgIHJlbmRlcihcclxuICAgICAgPFByb3ZpZGVyIHN0b3JlPXtzdG9yZX0+XHJcbiAgICAgICAgPFRlc3RDb21wb25lbnQgb25SZXN1bHQ9eyh2YWx1ZSkgPT4gKHJlc3VsdCA9IHZhbHVlKX0gLz5cclxuICAgICAgPC9Qcm92aWRlcj5cclxuICAgICk7XHJcblxyXG4gICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQubG9jYWxlKS50b0JlKCdlbicpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnQoJ2NvbW1vbi5zYXZlJykpLnRvQmUoJ1NhdmUnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBpdCgncmV0dXJucyBkZXRlcm1pbmlzdGljIGZhbGxiYWNrIGZvciBtaXNzaW5nIGtleXMgKG5ldmVyIHRocm93cyknLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCBzdG9yZSA9IGNyZWF0ZU1vY2tTdG9yZSh7XHJcbiAgICAgIHVpOiB7IHRoZW1lOiAnbGlnaHQnLCBsb2NhbGU6ICdlbicsIGlzTG9hZGluZzogZmFsc2UgfSxcclxuICAgIH0pO1xyXG5cclxuICAgIGxldCByZXN1bHQ7XHJcbiAgICByZW5kZXIoXHJcbiAgICAgIDxQcm92aWRlciBzdG9yZT17c3RvcmV9PlxyXG4gICAgICAgIDxUZXN0Q29tcG9uZW50IG9uUmVzdWx0PXsodmFsdWUpID0+IChyZXN1bHQgPSB2YWx1ZSl9IC8+XHJcbiAgICAgIDwvUHJvdmlkZXI+XHJcbiAgICApO1xyXG5cclxuICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xyXG4gICAgICBleHBlY3QocmVzdWx0LnQoJ21pc3Npbmcua2V5LnBhdGgnKSkudG9CZSgnbWlzc2luZy5rZXkucGF0aCcpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCdzdXBwb3J0cyBpbnRlcnBvbGF0aW9uIHdoZW4gaTE4biBpbXBsZW1lbnRhdGlvbiBwcm92aWRlcyBpdCcsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IHNweSA9IGplc3Quc3B5T24oaTE4biwgJ2NyZWF0ZUkxOG4nKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcclxuICAgICAgdFN5bmM6IChrZXksIHBhcmFtcykgPT5cclxuICAgICAgICBrZXkgPT09ICdncmVldGluZy5oZWxsbycgPyBgSGkgJHtwYXJhbXM/Lm5hbWUgfHwgJyd9YC50cmltKCkgOiBrZXksXHJcbiAgICB9KSk7XHJcblxyXG4gICAgY29uc3Qgc3RvcmUgPSBjcmVhdGVNb2NrU3RvcmUoe1xyXG4gICAgICB1aTogeyB0aGVtZTogJ2xpZ2h0JywgbG9jYWxlOiAnZW4nLCBpc0xvYWRpbmc6IGZhbHNlIH0sXHJcbiAgICB9KTtcclxuXHJcbiAgICBsZXQgcmVzdWx0O1xyXG4gICAgcmVuZGVyKFxyXG4gICAgICA8UHJvdmlkZXIgc3RvcmU9e3N0b3JlfT5cclxuICAgICAgICA8VGVzdENvbXBvbmVudCBvblJlc3VsdD17KHZhbHVlKSA9PiAocmVzdWx0ID0gdmFsdWUpfSAvPlxyXG4gICAgICA8L1Byb3ZpZGVyPlxyXG4gICAgKTtcclxuXHJcbiAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcclxuICAgICAgZXhwZWN0KHJlc3VsdC50KCdncmVldGluZy5oZWxsbycsIHsgbmFtZTogJ0FkYScgfSkpLnRvQmUoJ0hpIEFkYScpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgc3B5Lm1vY2tSZXN0b3JlKCk7XHJcbiAgfSk7XHJcbn0pO1xyXG5cclxuIl0sIm1hcHBpbmdzIjoiOzs7QUFJQSxJQUFBQSxNQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxZQUFBLEdBQUFELE9BQUE7QUFDQSxJQUFBRSxXQUFBLEdBQUFGLE9BQUE7QUFDQSxJQUFBRyxRQUFBLEdBQUFILE9BQUE7QUFDQSxJQUFBSSxRQUFBLEdBQUFMLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBSyxZQUFBLEdBQUFOLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBTSxJQUFBLEdBQUFDLHVCQUFBLENBQUFQLE9BQUE7QUFBOEIsSUFBQVEsV0FBQSxHQUFBUixPQUFBO0FBRTlCLElBQU1TLGVBQWUsR0FBRyxTQUFsQkEsZUFBZUEsQ0FBQTtFQUFBLElBQUlDLGNBQWMsR0FBQUMsU0FBQSxDQUFBQyxNQUFBLFFBQUFELFNBQUEsUUFBQUUsU0FBQSxHQUFBRixTQUFBLE1BQUcsQ0FBQyxDQUFDO0VBQUEsT0FDMUMsSUFBQUcsdUJBQWMsRUFBQztJQUNiQyxP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