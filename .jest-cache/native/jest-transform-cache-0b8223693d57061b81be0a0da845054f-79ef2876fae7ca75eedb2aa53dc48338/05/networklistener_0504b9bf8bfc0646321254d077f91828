de85848e202689bbdb42d80244fbc245
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.subscribe = exports.stopListening = exports.startListening = exports.getIsOnline = exports.default = exports.checkConnectivity = exports.__unsafeResetForTests = void 0;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _netinfo = _interopRequireDefault(require("@react-native-community/netinfo"));
var _logging = require("../logging");
var isOnline = true;
var listeners = new Set();
var netInfoUnsubscribe = null;
var normalizeIsOnline = function normalizeIsOnline(state) {
  return Boolean(state == null ? void 0 : state.isConnected);
};
var notify = function notify() {
  listeners.forEach(function (listener) {
    try {
      listener(isOnline);
    } catch (_unused) {}
  });
};
var applyState = function applyState(state) {
  var nextIsOnline = normalizeIsOnline(state);
  var wasOnline = isOnline;
  isOnline = nextIsOnline;
  if (wasOnline !== nextIsOnline) {
    _logging.logger.info('Network status changed', {
      isOnline: isOnline
    });
    notify();
  }
  return isOnline;
};
var checkConnectivity = exports.checkConnectivity = function () {
  var _ref = (0, _asyncToGenerator2.default)(function* () {
    var state = yield _netinfo.default.fetch();
    return applyState(state);
  });
  return function checkConnectivity() {
    return _ref.apply(this, arguments);
  };
}();
var subscribe = exports.subscribe = function subscribe(listener) {
  listeners.add(listener);
  return function () {
    listeners.delete(listener);
  };
};
var startListening = exports.startListening = function startListening() {
  if (netInfoUnsubscribe) return netInfoUnsubscribe;
  netInfoUnsubscribe = _netinfo.default.addEventListener(function (state) {
    applyState(state);
  });
  return netInfoUnsubscribe;
};
var stopListening = exports.stopListening = function stopListening() {
  if (!netInfoUnsubscribe) return;
  try {
    netInfoUnsubscribe();
  } finally {
    netInfoUnsubscribe = null;
  }
};
var getIsOnline = exports.getIsOnline = function getIsOnline() {
  return isOnline;
};
var __unsafeResetForTests = exports.__unsafeResetForTests = function __unsafeResetForTests() {
  stopListening();
  isOnline = true;
  listeners = new Set();
};
var _default = exports.default = {
  checkConnectivity: checkConnectivity,
  subscribe: subscribe,
  startListening: startListening,
  stopListening: stopListening,
  getIsOnline: getIsOnline
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbmV0aW5mbyIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX2xvZ2dpbmciLCJpc09ubGluZSIsImxpc3RlbmVycyIsIlNldCIsIm5ldEluZm9VbnN1YnNjcmliZSIsIm5vcm1hbGl6ZUlzT25saW5lIiwic3RhdGUiLCJCb29sZWFuIiwiaXNDb25uZWN0ZWQiLCJub3RpZnkiLCJmb3JFYWNoIiwibGlzdGVuZXIiLCJfdW51c2VkIiwiYXBwbHlTdGF0ZSIsIm5leHRJc09ubGluZSIsIndhc09ubGluZSIsImxvZ2dlciIsImluZm8iLCJjaGVja0Nvbm5lY3Rpdml0eSIsImV4cG9ydHMiLCJfcmVmIiwiX2FzeW5jVG9HZW5lcmF0b3IyIiwiZGVmYXVsdCIsIk5ldEluZm8iLCJmZXRjaCIsImFwcGx5IiwiYXJndW1lbnRzIiwic3Vic2NyaWJlIiwiYWRkIiwiZGVsZXRlIiwic3RhcnRMaXN0ZW5pbmciLCJhZGRFdmVudExpc3RlbmVyIiwic3RvcExpc3RlbmluZyIsImdldElzT25saW5lIiwiX191bnNhZmVSZXNldEZvclRlc3RzIiwiX2RlZmF1bHQiXSwic291cmNlcyI6WyJuZXR3b3JrLmxpc3RlbmVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBOZXR3b3JrIExpc3RlbmVyXHJcbiAqIE1vbml0b3JzIG5ldHdvcmsgY29ubmVjdGl2aXR5XHJcbiAqIEZpbGU6IG5ldHdvcmsubGlzdGVuZXIuanNcclxuICovXHJcbmltcG9ydCBOZXRJbmZvIGZyb20gJ0ByZWFjdC1uYXRpdmUtY29tbXVuaXR5L25ldGluZm8nO1xyXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICdAbG9nZ2luZyc7XHJcblxyXG5sZXQgaXNPbmxpbmUgPSB0cnVlO1xyXG5sZXQgbGlzdGVuZXJzID0gbmV3IFNldCgpO1xyXG5sZXQgbmV0SW5mb1Vuc3Vic2NyaWJlID0gbnVsbDtcclxuXHJcbmNvbnN0IG5vcm1hbGl6ZUlzT25saW5lID0gKHN0YXRlKSA9PiBCb29sZWFuKHN0YXRlPy5pc0Nvbm5lY3RlZCk7XHJcblxyXG5jb25zdCBub3RpZnkgPSAoKSA9PiB7XHJcbiAgbGlzdGVuZXJzLmZvckVhY2goKGxpc3RlbmVyKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBsaXN0ZW5lcihpc09ubGluZSk7XHJcbiAgICB9IGNhdGNoIHtcclxuICAgICAgLy8gTGlzdGVuZXIgZXJyb3JzIG11c3Qgbm90IGJyZWFrIHRoZSBnbG9iYWwgY29ubmVjdGl2aXR5IG9ic2VydmVyLlxyXG4gICAgfVxyXG4gIH0pO1xyXG59O1xyXG5cclxuY29uc3QgYXBwbHlTdGF0ZSA9IChzdGF0ZSkgPT4ge1xyXG4gIGNvbnN0IG5leHRJc09ubGluZSA9IG5vcm1hbGl6ZUlzT25saW5lKHN0YXRlKTtcclxuICBjb25zdCB3YXNPbmxpbmUgPSBpc09ubGluZTtcclxuICBpc09ubGluZSA9IG5leHRJc09ubGluZTtcclxuXHJcbiAgaWYgKHdhc09ubGluZSAhPT0gbmV4dElzT25saW5lKSB7XHJcbiAgICBsb2dnZXIuaW5mbygnTmV0d29yayBzdGF0dXMgY2hhbmdlZCcsIHsgaXNPbmxpbmUgfSk7XHJcbiAgICBub3RpZnkoKTtcclxuICB9XHJcblxyXG4gIHJldHVybiBpc09ubGluZTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBjdXJyZW50IGNvbm5lY3Rpdml0eSBmcm9tIE5ldEluZm8gYW5kIHVwZGF0ZSBpbnRlcm5hbCBzdGF0ZS5cclxuICogTm90aWZpZXMgc3Vic2NyaWJlcnMgb25seSB3aGVuIHRoZSBvbmxpbmUgc3RhdHVzIGNoYW5nZXMuXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgY2hlY2tDb25uZWN0aXZpdHkgPSBhc3luYyAoKSA9PiB7XHJcbiAgY29uc3Qgc3RhdGUgPSBhd2FpdCBOZXRJbmZvLmZldGNoKCk7XHJcbiAgcmV0dXJuIGFwcGx5U3RhdGUoc3RhdGUpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFN1YnNjcmliZSB0byBvbmxpbmUtc3RhdHVzIGNoYW5nZXMuXHJcbiAqIFJldHVybnMgYW4gdW5zdWJzY3JpYmUgZnVuY3Rpb24uXHJcbiAqL1xyXG5leHBvcnQgY29uc3Qgc3Vic2NyaWJlID0gKGxpc3RlbmVyKSA9PiB7XHJcbiAgbGlzdGVuZXJzLmFkZChsaXN0ZW5lcik7XHJcbiAgcmV0dXJuICgpID0+IHtcclxuICAgIGxpc3RlbmVycy5kZWxldGUobGlzdGVuZXIpO1xyXG4gIH07XHJcbn07XHJcblxyXG4vKipcclxuICogU3RhcnQgbGlzdGVuaW5nIHRvIE5ldEluZm8gY2hhbmdlcy5cclxuICogSWRlbXBvdGVudDogc3Vic2VxdWVudCBjYWxscyByZXR1cm4gdGhlIHNhbWUgdW5zdWJzY3JpYmUgZnVuY3Rpb24uXHJcbiAqL1xyXG5leHBvcnQgY29uc3Qgc3RhcnRMaXN0ZW5pbmcgPSAoKSA9PiB7XHJcbiAgaWYgKG5ldEluZm9VbnN1YnNjcmliZSkgcmV0dXJuIG5ldEluZm9VbnN1YnNjcmliZTtcclxuXHJcbiAgbmV0SW5mb1Vuc3Vic2NyaWJlID0gTmV0SW5mby5hZGRFdmVudExpc3RlbmVyKChzdGF0ZSkgPT4ge1xyXG4gICAgYXBwbHlTdGF0ZShzdGF0ZSk7XHJcbiAgfSk7XHJcblxyXG4gIHJldHVybiBuZXRJbmZvVW5zdWJzY3JpYmU7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3Qgc3RvcExpc3RlbmluZyA9ICgpID0+IHtcclxuICBpZiAoIW5ldEluZm9VbnN1YnNjcmliZSkgcmV0dXJuO1xyXG4gIHRyeSB7XHJcbiAgICBuZXRJbmZvVW5zdWJzY3JpYmUoKTtcclxuICB9IGZpbmFsbHkge1xyXG4gICAgbmV0SW5mb1Vuc3Vic2NyaWJlID0gbnVsbDtcclxuICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0SXNPbmxpbmUgPSAoKSA9PiBpc09ubGluZTtcclxuXHJcbi8qKlxyXG4gKiBUZXN0aW5nLW9ubHkgcmVzZXQgaGVscGVyIHRvIGF2b2lkIHN0YXRlIGxlYWtpbmcgYWNyb3NzIHVuaXQgdGVzdHMuXHJcbiAqIEBwcml2YXRlXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgX191bnNhZmVSZXNldEZvclRlc3RzID0gKCkgPT4ge1xyXG4gIHN0b3BMaXN0ZW5pbmcoKTtcclxuICBpc09ubGluZSA9IHRydWU7XHJcbiAgbGlzdGVuZXJzID0gbmV3IFNldCgpO1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQge1xyXG4gIGNoZWNrQ29ubmVjdGl2aXR5LFxyXG4gIHN1YnNjcmliZSxcclxuICBzdGFydExpc3RlbmluZyxcclxuICBzdG9wTGlzdGVuaW5nLFxyXG4gIGdldElzT25saW5lLFxyXG59O1xyXG5cclxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFLQSxJQUFBQSxRQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxRQUFBLEdBQUFELE9BQUE7QUFFQSxJQUFJRSxRQUFRLEdBQUcsSUFBSTtBQUNuQixJQUFJQyxTQUFTLEdBQUcsSUFBSUMsR0FBRyxDQUFDLENBQUM7QUFDekIsSUFBSUMsa0JBQWtCLEdBQUcsSUFBSTtBQUU3QixJQUFNQyxpQkFBaUIsR0FBRyxTQUFwQkEsaUJBQWlCQSxDQUFJQyxLQUFLO0VBQUEsT0FBS0MsT0FBTyxDQUFDRCxLQUFLLG9CQUFMQSxLQUFLLENBQUVFLFdBQVcsQ0FBQztBQUFBO0FBRWhFLElBQU1DLE1BQU0sR0FBRyxTQUFUQSxNQUFNQSxDQUFBLEVBQVM7RUFDbkJQLFNBQVMsQ0FBQ1EsT0FBTyxDQUFDLFVBQUNDLFFBQVEsRUFBSztJQUM5QixJQUFJO01BQ0ZBLFFBQVEsQ0FBQ1YsUUFBUSxDQUFDO0lBQ3BCLENBQUMsQ0FBQyxPQUFBVyxPQUFBLEVBQU0sQ0FFUjtFQUNGLENBQUMsQ0FBQztBQUNKLENBQUM7QUFFRCxJQUFNQyxVQUFVLEdBQUcsU0FBYkEsVUFBVUEsQ0FBSVAsS0FBSyxFQUFLO0VBQzVCLElBQU1RLFlBQVksR0FBR1QsaUJBQWlCLENBQUNDLEtBQUssQ0FBQztFQUM3QyxJQUFNUyxTQUFTLEdBQUdkLFFBQVE7RUFDMUJBLFFBQVEsR0FBR2EsWUFBWTtFQUV2QixJQUFJQyxTQUFTLEtBQUtELFlBQVksRUFBRTtJQUM5QkUsZUFBTSxDQUFDQyxJQUFJLENBQUMsd0JBQXdCLEVBQUU7TUFBRWhCLFFBQVEsRUFBUkE7SUFBUyxDQUFDLENBQUM7SUFDbkRRLE1BQU0sQ0FBQyxDQUFDO0VBQ1Y7RUFFQSxPQUFPUixRQUFRO0FBQ2pCLENBQUM7QUFNTSxJQUFNaUIsaUJBQWlCLEdBQUFDLE9BQUEsQ0FBQUQsaUJBQUE7RUFBQSxJQUFBRSxJQUFBLE9BQUFDLGtCQUFBLENBQUFDLE9BQUEsRUFBRyxhQUFZO0lBQzNDLElBQU1oQixLQUFLLFNBQVNpQixnQkFBTyxDQUFDQyxLQUFLLENBQUMsQ0FBQztJQUNuQyxPQUFPWCxVQUFVLENBQUNQLEtBQUssQ0FBQztFQUMxQixDQUFDO0VBQUEsZ0JBSFlZLGlCQUFpQkEsQ0FBQTtJQUFBLE9BQUFFLElBQUEsQ0FBQUssS0FBQSxPQUFBQyxTQUFBO0VBQUE7QUFBQSxHQUc3QjtBQU1NLElBQU1DLFNBQVMsR0FBQVIsT0FBQSxDQUFBUSxTQUFBLEdBQUcsU0FBWkEsU0FBU0EsQ0FBSWhCLFFBQVEsRUFBSztFQUNyQ1QsU0FBUyxDQUFDMEIsR0FBRyxDQUFDakIsUUFBUSxDQUFDO0VBQ3ZCLE9BQU8sWUFBTTtJQUNYVCxTQUFTLENBQUMyQixNQUFNLENBQUNsQixRQUFRLENBQUM7RUFDNUIsQ0FBQztBQUNILENBQUM7QUFNTSxJQUFNbUIsY0FBYyxHQUFBWCxPQUFBLENBQUFXLGNBQUEsR0FBRyxTQUFqQkEsY0FBY0EsQ0FBQSxFQUFTO0VBQ2xDLElBQUkxQixrQkFBa0IsRUFBRSxPQUFPQSxrQkFBa0I7RUFFakRBLGtCQUFrQixHQUFHbUIsZ0JBQU8sQ0FBQ1EsZ0JBQWdCLENBQUMsVUFBQ3pCLEtBQUssRUFBSztJQUN2RE8sVUFBVSxDQUFDUCxLQUFLLENBQUM7RUFDbkIsQ0FBQyxDQUFDO0VBRUYsT0FBT0Ysa0JBQWtCO0FBQzNCLENBQUM7QUFFTSxJQUFNNEIsYUFBYSxHQUFBYixPQUFBLENBQUFhLGFBQUEsR0FBRyxTQUFoQkEsYUFBYUEsQ0FBQSxFQUFTO0VBQ2pDLElBQUksQ0FBQzVCLGtCQUFrQixFQUFFO0VBQ3pCLElBQUk7SUFDRkEsa0JBQWtCLENBQUMsQ0FBQztFQUN0QixDQUFDLFNBQVM7SUFDUkEsa0JBQWtCLEdBQUcsSUFBSTtFQUMzQjtBQUNGLENBQUM7QUFFTSxJQUFNNkIsV0FBVyxHQUFBZCxPQUFBLENBQUFjLFdBQUEsR0FBRyxTQUFkQSxXQUFXQSxDQUFBO0VBQUEsT0FBU2hDLFFBQVE7QUFBQTtBQU1sQyxJQUFNaUMscUJBQXFCLEdBQUFmLE9BQUEsQ0FBQWUscUJBQUEsR0FBRyxTQUF4QkEscUJBQXFCQSxDQUFBLEVBQVM7RUFDekNGLGFBQWEsQ0FBQyxDQUFDO0VBQ2YvQixRQUFRLEdBQUcsSUFBSTtFQUNmQyxTQUFTLEdBQUcsSUFBSUMsR0FBRyxDQUFDLENBQUM7QUFDdkIsQ0FBQztBQUFDLElBQUFnQyxRQUFBLEdBQUFoQixPQUFBLENBQUFHLE9BQUEsR0FFYTtFQUNiSixpQkFBaUIsRUFBakJBLGlCQUFpQjtFQUNqQlMsU0FBUyxFQUFUQSxTQUFTO0VBQ1RHLGNBQWMsRUFBZEEsY0FBYztFQUNkRSxhQUFhLEVBQWJBLGFBQWE7RUFDYkMsV0FBVyxFQUFYQTtBQUNGLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=