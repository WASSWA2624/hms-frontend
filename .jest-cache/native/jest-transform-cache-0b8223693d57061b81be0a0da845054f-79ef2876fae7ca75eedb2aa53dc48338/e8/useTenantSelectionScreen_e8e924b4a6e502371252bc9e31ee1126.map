{"version":3,"names":["useCallback","useMemo","useState","useRouter","useI18n","useNetwork","useAuth","identifyUseCase","loginUseCase","normalizePhoneNumber","cov_5v20n14lx","s","useTenantSelectionScreen","f","_ref","t","router","_ref2","isOffline","_ref3","login","_ref4","_ref5","_slicedToArray","tenants","setTenants","_ref6","_ref7","selectedTenantId","setSelectedTenantId","_ref8","_ref9","isLoading","setIsLoading","_ref0","_ref1","errorMessage","setErrorMessage","_ref10","_ref11","identifier","setIdentifier","_ref12","_ref13","password","setPassword","canSubmit","b","Boolean","loadTenants","_ref14","_asyncToGenerator","identifierValue","result","users","length","tenant_id","error","message","_x","apply","arguments","handleSelectTenant","tenantId","handleSubmit","isEmail","includes","payload","email","toLowerCase","phone","Object","assign","requiresFacilitySelection","push","pathname","params","facilities","JSON","stringify","loginPayload","replace","handleGoBack","back"],"sources":["useTenantSelectionScreen.js"],"sourcesContent":["/**\r\n * useTenantSelectionScreen Hook\r\n * Shared behavior/logic for TenantSelectionScreen across all platforms.\r\n * File: useTenantSelectionScreen.js\r\n */\r\nimport { useCallback, useMemo, useState } from 'react';\r\nimport { useRouter } from 'expo-router';\r\nimport { useI18n, useNetwork, useAuth } from '@hooks';\r\nimport { identifyUseCase, loginUseCase } from '@features/auth';\r\nimport { normalizePhoneNumber } from '@utils';\r\n\r\nconst useTenantSelectionScreen = () => {\r\n  const { t } = useI18n();\r\n  const router = useRouter();\r\n  const { isOffline } = useNetwork();\r\n  const { login } = useAuth();\r\n  const [tenants, setTenants] = useState([]);\r\n  const [selectedTenantId, setSelectedTenantId] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [errorMessage, setErrorMessage] = useState(null);\r\n  const [identifier, setIdentifier] = useState('');\r\n  const [password, setPassword] = useState('');\r\n\r\n  const canSubmit = useMemo(\r\n    () => Boolean(selectedTenantId) && !isLoading && !isOffline,\r\n    [selectedTenantId, isLoading, isOffline]\r\n  );\r\n\r\n  const loadTenants = useCallback(async (identifierValue) => {\r\n    if (!identifierValue) return;\r\n    \r\n    setIsLoading(true);\r\n    setErrorMessage(null);\r\n    setIdentifier(identifierValue);\r\n    \r\n    try {\r\n      const result = await identifyUseCase({ identifier: identifierValue });\r\n      if (result?.users && result.users.length > 0) {\r\n        setTenants(result.users);\r\n        if (result.users.length === 1) {\r\n          // Auto-select if only one tenant\r\n          setSelectedTenantId(result.users[0].tenant_id);\r\n        }\r\n      } else {\r\n        setErrorMessage(t('auth.tenantSelection.noTenantsFound'));\r\n      }\r\n    } catch (error) {\r\n      setErrorMessage(error?.message || t('auth.tenantSelection.error'));\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [t]);\r\n\r\n  const handleSelectTenant = useCallback((tenantId) => {\r\n    setSelectedTenantId(tenantId);\r\n  }, []);\r\n\r\n  const handleSubmit = useCallback(async () => {\r\n    if (!canSubmit) return false;\r\n    \r\n    setIsLoading(true);\r\n    setErrorMessage(null);\r\n    \r\n    try {\r\n      const isEmail = identifier.includes('@');\r\n      const payload = isEmail\r\n        ? { email: identifier.toLowerCase() }\r\n        : { phone: normalizePhoneNumber(identifier) };\r\n      \r\n      // Call login use case directly to check response\r\n      const result = await loginUseCase({\r\n        ...payload,\r\n        password,\r\n        tenant_id: selectedTenantId,\r\n      });\r\n      \r\n      // Check if facility selection is required\r\n      if (result?.requiresFacilitySelection) {\r\n        router.push({\r\n          pathname: '/facility-selection',\r\n          params: {\r\n            facilities: JSON.stringify(result.facilities),\r\n            loginPayload: JSON.stringify({\r\n              ...payload,\r\n              password,\r\n              tenant_id: selectedTenantId,\r\n            }),\r\n          },\r\n        });\r\n        return true;\r\n      }\r\n      \r\n      await login({\r\n        ...payload,\r\n        password,\r\n        tenant_id: selectedTenantId,\r\n      });\r\n      router.replace('/home');\r\n      return true;\r\n    } catch (error) {\r\n      setErrorMessage(error?.message || t('auth.tenantSelection.loginError'));\r\n      return false;\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [canSubmit, selectedTenantId, identifier, password, login, router, t]);\r\n\r\n  const handleGoBack = useCallback(() => {\r\n    router.back();\r\n  }, [router]);\r\n\r\n  return {\r\n    tenants,\r\n    selectedTenantId,\r\n    isLoading,\r\n    isOffline,\r\n    errorMessage,\r\n    canSubmit,\r\n    identifier,\r\n    password,\r\n    loadTenants,\r\n    handleSelectTenant,\r\n    handleSubmit,\r\n    handleGoBack,\r\n  };\r\n};\r\n\r\nexport default useTenantSelectionScreen;\r\n"],"mappings":"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","ignoreList":[]}