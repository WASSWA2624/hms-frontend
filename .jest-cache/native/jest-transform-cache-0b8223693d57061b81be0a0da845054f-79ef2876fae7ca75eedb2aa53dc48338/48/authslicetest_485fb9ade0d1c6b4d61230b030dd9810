5bece00904c1948a3cf33cc2dded73d7
_getJestObj().mock("../../features/auth", function () {
  return {
    loginUseCase: jest.fn(),
    registerUseCase: jest.fn(),
    logoutUseCase: jest.fn(),
    refreshSessionUseCase: jest.fn(),
    loadCurrentUserUseCase: jest.fn()
  };
});
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _toolkit = require("@reduxjs/toolkit");
var _auth = require("../../store/slices/auth.slice");
var _auth2 = require("../../features/auth");
function _getJestObj() {
  var _require = require("@jest/globals"),
    jest = _require.jest;
  _getJestObj = function _getJestObj() {
    return jest;
  };
  return jest;
}
var createStore = function createStore() {
  return (0, _toolkit.configureStore)({
    reducer: {
      auth: _auth.reducer
    }
  });
};
describe('auth.slice', function () {
  beforeEach(function () {
    _auth2.loginUseCase.mockResolvedValue({
      id: '1'
    });
    _auth2.registerUseCase.mockResolvedValue({
      id: '2'
    });
    _auth2.logoutUseCase.mockResolvedValue(true);
    _auth2.refreshSessionUseCase.mockResolvedValue({
      accessToken: 'a',
      refreshToken: 'b'
    });
    _auth2.loadCurrentUserUseCase.mockResolvedValue({
      id: '3'
    });
  });
  it('handles login/register/logout flows', (0, _asyncToGenerator2.default)(function* () {
    var store = createStore();
    yield store.dispatch(_auth.actions.login({
      email: 'user',
      password: 'pass'
    }));
    expect(store.getState().auth.isAuthenticated).toBe(true);
    yield store.dispatch(_auth.actions.register({
      email: 'user'
    }));
    expect(store.getState().auth.user).toEqual({
      id: '2'
    });
    yield store.dispatch(_auth.actions.logout());
    expect(store.getState().auth.user).toBeNull();
  }));
  it('handles refresh and load current user', (0, _asyncToGenerator2.default)(function* () {
    var store = createStore();
    yield store.dispatch(_auth.actions.refreshSession());
    expect(store.getState().auth.isAuthenticated).toBe(true);
    yield store.dispatch(_auth.actions.loadCurrentUser());
    expect(store.getState().auth.user).toEqual({
      id: '3'
    });
  }));
  it('stores error codes on failures', (0, _asyncToGenerator2.default)(function* () {
    var store = createStore();
    _auth2.loginUseCase.mockRejectedValueOnce({
      code: 'UNAUTHORIZED'
    });
    yield store.dispatch(_auth.actions.login({
      email: 'user',
      password: 'pass'
    }));
    expect(store.getState().auth.errorCode).toBe('UNAUTHORIZED');
  }));
  it('clears auth state', function () {
    var state = (0, _auth.reducer)({
      user: {
        id: '1'
      },
      isAuthenticated: true,
      isLoading: false,
      errorCode: 'ERROR',
      lastUpdated: null
    }, _auth.actions.clearAuth());
    expect(state.user).toBeNull();
    expect(state.isAuthenticated).toBe(false);
    var clearedError = (0, _auth.reducer)(state, _auth.actions.clearAuthError());
    expect(clearedError.errorCode).toBeNull();
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZ2V0SmVzdE9iaiIsIm1vY2siLCJsb2dpblVzZUNhc2UiLCJqZXN0IiwiZm4iLCJyZWdpc3RlclVzZUNhc2UiLCJsb2dvdXRVc2VDYXNlIiwicmVmcmVzaFNlc3Npb25Vc2VDYXNlIiwibG9hZEN1cnJlbnRVc2VyVXNlQ2FzZSIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiZGVmYXVsdCIsIl9hc3luY1RvR2VuZXJhdG9yMiIsIl90b29sa2l0IiwiX2F1dGgiLCJfYXV0aDIiLCJfcmVxdWlyZSIsImNyZWF0ZVN0b3JlIiwiY29uZmlndXJlU3RvcmUiLCJyZWR1Y2VyIiwiYXV0aCIsImRlc2NyaWJlIiwiYmVmb3JlRWFjaCIsIm1vY2tSZXNvbHZlZFZhbHVlIiwiaWQiLCJhY2Nlc3NUb2tlbiIsInJlZnJlc2hUb2tlbiIsIml0Iiwic3RvcmUiLCJkaXNwYXRjaCIsImFjdGlvbnMiLCJsb2dpbiIsImVtYWlsIiwicGFzc3dvcmQiLCJleHBlY3QiLCJnZXRTdGF0ZSIsImlzQXV0aGVudGljYXRlZCIsInRvQmUiLCJyZWdpc3RlciIsInVzZXIiLCJ0b0VxdWFsIiwibG9nb3V0IiwidG9CZU51bGwiLCJyZWZyZXNoU2Vzc2lvbiIsImxvYWRDdXJyZW50VXNlciIsIm1vY2tSZWplY3RlZFZhbHVlT25jZSIsImNvZGUiLCJlcnJvckNvZGUiLCJzdGF0ZSIsImlzTG9hZGluZyIsImxhc3RVcGRhdGVkIiwiY2xlYXJBdXRoIiwiY2xlYXJlZEVycm9yIiwiY2xlYXJBdXRoRXJyb3IiXSwic291cmNlcyI6WyJhdXRoLnNsaWNlLnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEF1dGggU2xpY2UgVGVzdHNcclxuICogRmlsZTogYXV0aC5zbGljZS50ZXN0LmpzXHJcbiAqL1xyXG5pbXBvcnQgeyBjb25maWd1cmVTdG9yZSB9IGZyb20gJ0ByZWR1eGpzL3Rvb2xraXQnO1xyXG5cclxuamVzdC5tb2NrKCdAZmVhdHVyZXMvYXV0aCcsICgpID0+ICh7XHJcbiAgbG9naW5Vc2VDYXNlOiBqZXN0LmZuKCksXHJcbiAgcmVnaXN0ZXJVc2VDYXNlOiBqZXN0LmZuKCksXHJcbiAgbG9nb3V0VXNlQ2FzZTogamVzdC5mbigpLFxyXG4gIHJlZnJlc2hTZXNzaW9uVXNlQ2FzZTogamVzdC5mbigpLFxyXG4gIGxvYWRDdXJyZW50VXNlclVzZUNhc2U6IGplc3QuZm4oKSxcclxufSkpO1xyXG5cclxuaW1wb3J0IHsgYWN0aW9ucywgcmVkdWNlciB9IGZyb20gJ0BzdG9yZS9zbGljZXMvYXV0aC5zbGljZSc7XHJcbmltcG9ydCB7XHJcbiAgbG9naW5Vc2VDYXNlLFxyXG4gIHJlZ2lzdGVyVXNlQ2FzZSxcclxuICBsb2dvdXRVc2VDYXNlLFxyXG4gIHJlZnJlc2hTZXNzaW9uVXNlQ2FzZSxcclxuICBsb2FkQ3VycmVudFVzZXJVc2VDYXNlLFxyXG59IGZyb20gJ0BmZWF0dXJlcy9hdXRoJztcclxuXHJcbmNvbnN0IGNyZWF0ZVN0b3JlID0gKCkgPT5cclxuICBjb25maWd1cmVTdG9yZSh7XHJcbiAgICByZWR1Y2VyOiB7XHJcbiAgICAgIGF1dGg6IHJlZHVjZXIsXHJcbiAgICB9LFxyXG4gIH0pO1xyXG5cclxuZGVzY3JpYmUoJ2F1dGguc2xpY2UnLCAoKSA9PiB7XHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBsb2dpblVzZUNhc2UubW9ja1Jlc29sdmVkVmFsdWUoeyBpZDogJzEnIH0pO1xyXG4gICAgcmVnaXN0ZXJVc2VDYXNlLm1vY2tSZXNvbHZlZFZhbHVlKHsgaWQ6ICcyJyB9KTtcclxuICAgIGxvZ291dFVzZUNhc2UubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XHJcbiAgICByZWZyZXNoU2Vzc2lvblVzZUNhc2UubW9ja1Jlc29sdmVkVmFsdWUoeyBhY2Nlc3NUb2tlbjogJ2EnLCByZWZyZXNoVG9rZW46ICdiJyB9KTtcclxuICAgIGxvYWRDdXJyZW50VXNlclVzZUNhc2UubW9ja1Jlc29sdmVkVmFsdWUoeyBpZDogJzMnIH0pO1xyXG4gIH0pO1xyXG5cclxuICBpdCgnaGFuZGxlcyBsb2dpbi9yZWdpc3Rlci9sb2dvdXQgZmxvd3MnLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCBzdG9yZSA9IGNyZWF0ZVN0b3JlKCk7XHJcbiAgICBhd2FpdCBzdG9yZS5kaXNwYXRjaChhY3Rpb25zLmxvZ2luKHsgZW1haWw6ICd1c2VyJywgcGFzc3dvcmQ6ICdwYXNzJyB9KSk7XHJcbiAgICBleHBlY3Qoc3RvcmUuZ2V0U3RhdGUoKS5hdXRoLmlzQXV0aGVudGljYXRlZCkudG9CZSh0cnVlKTtcclxuICAgIGF3YWl0IHN0b3JlLmRpc3BhdGNoKGFjdGlvbnMucmVnaXN0ZXIoeyBlbWFpbDogJ3VzZXInIH0pKTtcclxuICAgIGV4cGVjdChzdG9yZS5nZXRTdGF0ZSgpLmF1dGgudXNlcikudG9FcXVhbCh7IGlkOiAnMicgfSk7XHJcbiAgICBhd2FpdCBzdG9yZS5kaXNwYXRjaChhY3Rpb25zLmxvZ291dCgpKTtcclxuICAgIGV4cGVjdChzdG9yZS5nZXRTdGF0ZSgpLmF1dGgudXNlcikudG9CZU51bGwoKTtcclxuICB9KTtcclxuXHJcbiAgaXQoJ2hhbmRsZXMgcmVmcmVzaCBhbmQgbG9hZCBjdXJyZW50IHVzZXInLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCBzdG9yZSA9IGNyZWF0ZVN0b3JlKCk7XHJcbiAgICBhd2FpdCBzdG9yZS5kaXNwYXRjaChhY3Rpb25zLnJlZnJlc2hTZXNzaW9uKCkpO1xyXG4gICAgZXhwZWN0KHN0b3JlLmdldFN0YXRlKCkuYXV0aC5pc0F1dGhlbnRpY2F0ZWQpLnRvQmUodHJ1ZSk7XHJcbiAgICBhd2FpdCBzdG9yZS5kaXNwYXRjaChhY3Rpb25zLmxvYWRDdXJyZW50VXNlcigpKTtcclxuICAgIGV4cGVjdChzdG9yZS5nZXRTdGF0ZSgpLmF1dGgudXNlcikudG9FcXVhbCh7IGlkOiAnMycgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCdzdG9yZXMgZXJyb3IgY29kZXMgb24gZmFpbHVyZXMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCBzdG9yZSA9IGNyZWF0ZVN0b3JlKCk7XHJcbiAgICBsb2dpblVzZUNhc2UubW9ja1JlamVjdGVkVmFsdWVPbmNlKHsgY29kZTogJ1VOQVVUSE9SSVpFRCcgfSk7XHJcbiAgICBhd2FpdCBzdG9yZS5kaXNwYXRjaChhY3Rpb25zLmxvZ2luKHsgZW1haWw6ICd1c2VyJywgcGFzc3dvcmQ6ICdwYXNzJyB9KSk7XHJcbiAgICBleHBlY3Qoc3RvcmUuZ2V0U3RhdGUoKS5hdXRoLmVycm9yQ29kZSkudG9CZSgnVU5BVVRIT1JJWkVEJyk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCdjbGVhcnMgYXV0aCBzdGF0ZScsICgpID0+IHtcclxuICAgIGNvbnN0IHN0YXRlID0gcmVkdWNlcihcclxuICAgICAgeyB1c2VyOiB7IGlkOiAnMScgfSwgaXNBdXRoZW50aWNhdGVkOiB0cnVlLCBpc0xvYWRpbmc6IGZhbHNlLCBlcnJvckNvZGU6ICdFUlJPUicsIGxhc3RVcGRhdGVkOiBudWxsIH0sXHJcbiAgICAgIGFjdGlvbnMuY2xlYXJBdXRoKClcclxuICAgICk7XHJcbiAgICBleHBlY3Qoc3RhdGUudXNlcikudG9CZU51bGwoKTtcclxuICAgIGV4cGVjdChzdGF0ZS5pc0F1dGhlbnRpY2F0ZWQpLnRvQmUoZmFsc2UpO1xyXG4gICAgY29uc3QgY2xlYXJlZEVycm9yID0gcmVkdWNlcihzdGF0ZSwgYWN0aW9ucy5jbGVhckF1dGhFcnJvcigpKTtcclxuICAgIGV4cGVjdChjbGVhcmVkRXJyb3IuZXJyb3JDb2RlKS50b0JlTnVsbCgpO1xyXG4gIH0pO1xyXG59KTtcclxuIl0sIm1hcHBpbmdzIjoiQUFNQUEsV0FBQSxHQUFLQyxJQUFJLHdCQUFtQjtFQUFBLE9BQU87SUFDakNDLFlBQVksRUFBRUMsSUFBSSxDQUFDQyxFQUFFLENBQUMsQ0FBQztJQUN2QkMsZUFBZSxFQUFFRixJQUFJLENBQUNDLEVBQUUsQ0FBQyxDQUFDO0lBQzFCRSxhQUFhLEVBQUVILElBQUksQ0FBQ0MsRUFBRSxDQUFD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