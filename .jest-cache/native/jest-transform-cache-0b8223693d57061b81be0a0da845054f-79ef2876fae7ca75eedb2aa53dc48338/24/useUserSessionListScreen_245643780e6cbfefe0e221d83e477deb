a0b6a71d432cec22a661ed5ac0ae47fe
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _react = require("react");
var _expoRouter = require("expo-router");
var _hooks = require("../../../../hooks");
var resolveErrorMessage = function resolveErrorMessage(t, errorCode, loadErrorKey) {
  if (!errorCode) return null;
  if (errorCode === 'UNKNOWN_ERROR' || errorCode === 'NETWORK_ERROR') {
    return t(loadErrorKey);
  }
  var key = `errors.codes.${errorCode}`;
  var resolved = t(key);
  return resolved === key ? t(loadErrorKey) : resolved;
};
var useUserSessionListScreen = function useUserSessionListScreen() {
  var _useI18n = (0, _hooks.useI18n)(),
    t = _useI18n.t;
  var router = (0, _expoRouter.useRouter)();
  var _useNetwork = (0, _hooks.useNetwork)(),
    isOffline = _useNetwork.isOffline;
  var _useUserSession = (0, _hooks.useUserSession)(),
    list = _useUserSession.list,
    revoke = _useUserSession.revoke,
    data = _useUserSession.data,
    isLoading = _useUserSession.isLoading,
    errorCode = _useUserSession.errorCode,
    reset = _useUserSession.reset;
  var items = (0, _react.useMemo)(function () {
    var _data$items;
    return Array.isArray(data) ? data : (_data$items = data == null ? void 0 : data.items) != null ? _data$items : [];
  }, [data]);
  var errorMessage = (0, _react.useMemo)(function () {
    return resolveErrorMessage(t, errorCode, 'userSession.list.loadError');
  }, [t, errorCode]);
  var fetchList = (0, _react.useCallback)(function () {
    reset();
    list({
      page: 1,
      limit: 20
    });
  }, [list, reset]);
  (0, _react.useEffect)(function () {
    fetchList();
  }, [fetchList]);
  var handleRetry = (0, _react.useCallback)(function () {
    fetchList();
  }, [fetchList]);
  var handleSessionPress = (0, _react.useCallback)(function (id) {
    router.push(`/settings/user-sessions/${id}`);
  }, [router]);
  var handleRevoke = (0, _react.useCallback)(function () {
    var _ref = (0, _asyncToGenerator2.default)(function* (id, e) {
      if (e != null && e.stopPropagation) e.stopPropagation();
      try {
        yield revoke(id);
        fetchList();
      } catch (_unused) {}
    });
    return function (_x, _x2) {
      return _ref.apply(this, arguments);
    };
  }(), [revoke, fetchList]);
  return {
    items: items,
    isLoading: isLoading,
    hasError: Boolean(errorCode),
    errorMessage: errorMessage,
    isOffline: isOffline,
    onRetry: handleRetry,
    onSessionPress: handleSessionPress,
    onRevoke: handleRevoke
  };
};
var _default = exports.default = useUserSessionListScreen;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJyZXF1aXJlIiwiX2V4cG9Sb3V0ZXIiLCJfaG9va3MiLCJyZXNvbHZlRXJyb3JNZXNzYWdlIiwidCIsImVycm9yQ29kZSIsImxvYWRFcnJvcktleSIsImtleSIsInJlc29sdmVkIiwidXNlVXNlclNlc3Npb25MaXN0U2NyZWVuIiwiX3VzZUkxOG4iLCJ1c2VJMThuIiwicm91dGVyIiwidXNlUm91dGVyIiwiX3VzZU5ldHdvcmsiLCJ1c2VOZXR3b3JrIiwiaXNPZmZsaW5lIiwiX3VzZVVzZXJTZXNzaW9uIiwidXNlVXNlclNlc3Npb24iLCJsaXN0IiwicmV2b2tlIiwiZGF0YSIsImlzTG9hZGluZyIsInJlc2V0IiwiaXRlbXMiLCJ1c2VNZW1vIiwiX2RhdGEkaXRlbXMiLCJBcnJheSIsImlzQXJyYXkiLCJlcnJvck1lc3NhZ2UiLCJmZXRjaExpc3QiLCJ1c2VDYWxsYmFjayIsInBhZ2UiLCJsaW1pdCIsInVzZUVmZmVjdCIsImhhbmRsZVJldHJ5IiwiaGFuZGxlU2Vzc2lvblByZXNzIiwiaWQiLCJwdXNoIiwiaGFuZGxlUmV2b2tlIiwiX3JlZiIsIl9hc3luY1RvR2VuZXJhdG9yMiIsImRlZmF1bHQiLCJlIiwic3RvcFByb3BhZ2F0aW9uIiwiX3VudXNlZCIsIl94IiwiX3gyIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJoYXNFcnJvciIsIkJvb2xlYW4iLCJvblJldHJ5Iiwib25TZXNzaW9uUHJlc3MiLCJvblJldm9rZSIsIl9kZWZhdWx0IiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInVzZVVzZXJTZXNzaW9uTGlzdFNjcmVlbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogdXNlVXNlclNlc3Npb25MaXN0U2NyZWVuIEhvb2tcclxuICogU2hhcmVkIGxvZ2ljIGZvciBVc2VyU2Vzc2lvbkxpc3RTY3JlZW4gYWNyb3NzIHBsYXRmb3Jtcy5cclxuICogRmlsZTogdXNlVXNlclNlc3Npb25MaXN0U2NyZWVuLmpzXHJcbiAqL1xyXG5pbXBvcnQgeyB1c2VDYWxsYmFjaywgdXNlRWZmZWN0LCB1c2VNZW1vIH0gZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgeyB1c2VSb3V0ZXIgfSBmcm9tICdleHBvLXJvdXRlcic7XHJcbmltcG9ydCB7IHVzZUkxOG4sIHVzZU5ldHdvcmssIHVzZVVzZXJTZXNzaW9uIH0gZnJvbSAnQGhvb2tzJztcclxuXHJcbmNvbnN0IHJlc29sdmVFcnJvck1lc3NhZ2UgPSAodCwgZXJyb3JDb2RlLCBsb2FkRXJyb3JLZXkpID0+IHtcclxuICBpZiAoIWVycm9yQ29kZSkgcmV0dXJuIG51bGw7XHJcbiAgaWYgKGVycm9yQ29kZSA9PT0gJ1VOS05PV05fRVJST1InIHx8IGVycm9yQ29kZSA9PT0gJ05FVFdPUktfRVJST1InKSB7XHJcbiAgICByZXR1cm4gdChsb2FkRXJyb3JLZXkpO1xyXG4gIH1cclxuICBjb25zdCBrZXkgPSBgZXJyb3JzLmNvZGVzLiR7ZXJyb3JDb2RlfWA7XHJcbiAgY29uc3QgcmVzb2x2ZWQgPSB0KGtleSk7XHJcbiAgcmV0dXJuIHJlc29sdmVkID09PSBrZXkgPyB0KGxvYWRFcnJvcktleSkgOiByZXNvbHZlZDtcclxufTtcclxuXHJcbmNvbnN0IHVzZVVzZXJTZXNzaW9uTGlzdFNjcmVlbiA9ICgpID0+IHtcclxuICBjb25zdCB7IHQgfSA9IHVzZUkxOG4oKTtcclxuICBjb25zdCByb3V0ZXIgPSB1c2VSb3V0ZXIoKTtcclxuICBjb25zdCB7IGlzT2ZmbGluZSB9ID0gdXNlTmV0d29yaygpO1xyXG4gIGNvbnN0IHtcclxuICAgIGxpc3QsXHJcbiAgICByZXZva2UsXHJcbiAgICBkYXRhLFxyXG4gICAgaXNMb2FkaW5nLFxyXG4gICAgZXJyb3JDb2RlLFxyXG4gICAgcmVzZXQsXHJcbiAgfSA9IHVzZVVzZXJTZXNzaW9uKCk7XHJcblxyXG4gIGNvbnN0IGl0ZW1zID0gdXNlTWVtbyhcclxuICAgICgpID0+IChBcnJheS5pc0FycmF5KGRhdGEpID8gZGF0YSA6IChkYXRhPy5pdGVtcyA/PyBbXSkpLFxyXG4gICAgW2RhdGFdXHJcbiAgKTtcclxuICBjb25zdCBlcnJvck1lc3NhZ2UgPSB1c2VNZW1vKFxyXG4gICAgKCkgPT4gcmVzb2x2ZUVycm9yTWVzc2FnZSh0LCBlcnJvckNvZGUsICd1c2VyU2Vzc2lvbi5saXN0LmxvYWRFcnJvcicpLFxyXG4gICAgW3QsIGVycm9yQ29kZV1cclxuICApO1xyXG5cclxuICBjb25zdCBmZXRjaExpc3QgPSB1c2VDYWxsYmFjaygoKSA9PiB7XHJcbiAgICByZXNldCgpO1xyXG4gICAgbGlzdCh7IHBhZ2U6IDEsIGxpbWl0OiAyMCB9KTtcclxuICB9LCBbbGlzdCwgcmVzZXRdKTtcclxuXHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGZldGNoTGlzdCgpO1xyXG4gIH0sIFtmZXRjaExpc3RdKTtcclxuXHJcbiAgY29uc3QgaGFuZGxlUmV0cnkgPSB1c2VDYWxsYmFjaygoKSA9PiB7XHJcbiAgICBmZXRjaExpc3QoKTtcclxuICB9LCBbZmV0Y2hMaXN0XSk7XHJcblxyXG4gIGNvbnN0IGhhbmRsZVNlc3Npb25QcmVzcyA9IHVzZUNhbGxiYWNrKFxyXG4gICAgKGlkKSA9PiB7XHJcbiAgICAgIHJvdXRlci5wdXNoKGAvc2V0dGluZ3MvdXNlci1zZXNzaW9ucy8ke2lkfWApO1xyXG4gICAgfSxcclxuICAgIFtyb3V0ZXJdXHJcbiAgKTtcclxuXHJcbiAgY29uc3QgaGFuZGxlUmV2b2tlID0gdXNlQ2FsbGJhY2soXHJcbiAgICBhc3luYyAoaWQsIGUpID0+IHtcclxuICAgICAgaWYgKGU/LnN0b3BQcm9wYWdhdGlvbikgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBhd2FpdCByZXZva2UoaWQpO1xyXG4gICAgICAgIGZldGNoTGlzdCgpO1xyXG4gICAgICB9IGNhdGNoIHtcclxuICAgICAgICAvKiBlcnJvciBoYW5kbGVkIGJ5IGhvb2sgKi9cclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIFtyZXZva2UsIGZldGNoTGlzdF1cclxuICApO1xyXG5cclxuICByZXR1cm4ge1xyXG4gICAgaXRlbXMsXHJcbiAgICBpc0xvYWRpbmcsXHJcbiAgICBoYXNFcnJvcjogQm9vbGVhbihlcnJvckNvZGUpLFxyXG4gICAgZXJyb3JNZXNzYWdlLFxyXG4gICAgaXNPZmZsaW5lLFxyXG4gICAgb25SZXRyeTogaGFuZGxlUmV0cnksXHJcbiAgICBvblNlc3Npb25QcmVzczogaGFuZGxlU2Vzc2lvblByZXNzLFxyXG4gICAgb25SZXZva2U6IGhhbmRsZVJldm9rZSxcclxuICB9O1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgdXNlVXNlclNlc3Npb25MaXN0U2NyZWVuO1xyXG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUtBLElBQUFBLE1BQUEsR0FBQUMsT0FBQTtBQUNBLElBQUFDLFdBQUEsR0FBQUQsT0FBQTtBQUNBLElBQUFFLE1BQUEsR0FBQUYsT0FBQTtBQUVBLElBQU1HLG1CQUFtQixHQUFHLFNBQXRCQSxtQkFBbUJBLENBQUlDLENBQUMsRUFBRUMsU0FBUyxFQUFFQyxZQUFZLEVBQUs7RUFDMUQsSUFBSSxDQUFDRCxTQUFTLEVBQUUsT0FBTyxJQUFJO0VBQzNCLElBQUlBLFNBQVMsS0FBSyxlQUFlLElBQUlBLFNBQVMsS0FBSyxlQUFlLEVBQUU7SUFDbEUsT0FBT0QsQ0FBQyxDQUFDRSxZQUFZLENBQUM7RUFDeEI7RUFDQSxJQUFNQyxHQUFHLEdBQUcsZ0JBQWdCRixTQUFTLEVBQUU7RUFDdkMsSUFBTUcsUUFBUSxHQUFHSixDQUFDLENBQUNHLEdBQUcsQ0FBQztFQUN2QixPQUFPQyxRQUFRLEtBQUtELEdBQUcsR0FBR0gsQ0FBQyxDQUFDRSxZQUFZLENBQUMsR0FBR0UsUUFBUTtBQUN0RCxDQUFDO0FBRUQsSUFBTUMsd0JBQXdCLEdBQUcsU0FBM0JBLHdCQUF3QkEsQ0FBQSxFQUFTO0VBQ3JDLElBQUFDLFFBQUEsR0FBYyxJQUFBQyxjQUFPLEVBQUMsQ0FBQztJQUFmUCxDQUFDLEdBQUFNLFFBQUEsQ0FBRE4sQ0FBQztFQUNULElB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