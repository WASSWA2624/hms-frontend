{"version":3,"names":["useCallback","useEffect","useState","endpoints","useNetwork","HEALTH_POLL_MS","cov_4w150804r","s","useDatabaseHealth","f","_ref","isOffline","_ref2","_ref3","_slicedToArray","isConnected","setIsConnected","check","_asyncToGenerator","fetch","b","url","HEALTH","_res$headers$get","res","method","signal","AbortSignal","timeout","ok","data","headers","get","includes","json","dbOk","database","_unused","id","setInterval","clearInterval"],"sources":["useDatabaseHealth.js"],"sourcesContent":["/**\r\n * useDatabaseHealth Hook\r\n * Monitors backend database connectivity via health endpoint.\r\n * File: useDatabaseHealth.js\r\n */\r\nimport { useCallback, useEffect, useState } from 'react';\r\nimport { endpoints } from '@config';\r\nimport useNetwork from './useNetwork';\r\n\r\nconst HEALTH_POLL_MS = 30000;\r\n\r\nconst useDatabaseHealth = () => {\r\n  const { isOffline } = useNetwork();\r\n  const [isConnected, setIsConnected] = useState(true);\r\n\r\n  const check = useCallback(async () => {\r\n    if (typeof fetch === 'undefined') return;\r\n    const url = endpoints.HEALTH;\r\n    try {\r\n      const res = await fetch(url, { method: 'GET', signal: AbortSignal.timeout(5000) });\r\n      const ok = res.ok;\r\n      const data = res.ok && res.headers.get('content-type')?.includes('json') ? await res.json() : {};\r\n      const dbOk = data?.database === 'ok' || data?.database === true || (ok && typeof data.database === 'undefined');\r\n      setIsConnected(ok && (dbOk || typeof data.database === 'undefined'));\r\n    } catch {\r\n      setIsConnected(false);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (isOffline) {\r\n      setIsConnected(false);\r\n      return;\r\n    }\r\n    check();\r\n    const id = setInterval(check, HEALTH_POLL_MS);\r\n    return () => clearInterval(id);\r\n  }, [isOffline, check]);\r\n\r\n  return { isConnected };\r\n};\r\n\r\nexport default useDatabaseHealth;\r\n"],"mappings":"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","ignoreList":[]}