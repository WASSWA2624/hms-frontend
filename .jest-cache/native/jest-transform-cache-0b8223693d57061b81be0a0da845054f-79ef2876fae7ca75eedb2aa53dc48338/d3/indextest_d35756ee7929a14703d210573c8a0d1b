6ee4c110c227b0f60bc26ccd0b786cbd
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _i18n = require("../../i18n");
describe('i18n System', function () {
  var mockStorage = {
    getItem: jest.fn(),
    setItem: jest.fn()
  };
  beforeEach(function () {
    jest.clearAllMocks();
    mockStorage.getItem.mockResolvedValue(null);
    mockStorage.setItem.mockResolvedValue(true);
  });
  describe('createI18n', function () {
    it('should create i18n instance', function () {
      var i18n = (0, _i18n.createI18n)({
        storage: mockStorage
      });
      expect(i18n).toBeDefined();
      expect(typeof i18n.getDeviceLocale).toBe('function');
      expect(typeof i18n.getCurrentLocale).toBe('function');
      expect(typeof i18n.setLocale).toBe('function');
      expect(typeof i18n.t).toBe('function');
      expect(typeof i18n.tSync).toBe('function');
    });
    it('should create i18n instance without storage', function () {
      var i18n = (0, _i18n.createI18n)();
      expect(i18n).toBeDefined();
    });
  });
  describe('getDeviceLocale', function () {
    it('should return default locale (en) when device locale not supported', function () {
      var i18n = (0, _i18n.createI18n)({
        storage: mockStorage
      });
      var locale = i18n.getDeviceLocale();
      expect(locale).toBe('en');
    });
    it('should return en when device locale is en', function () {
      var originalIntl = global.Intl;
      global.Intl = {
        DateTimeFormat: jest.fn(function () {
          return {
            resolvedOptions: jest.fn(function () {
              return {
                locale: 'en'
              };
            })
          };
        })
      };
      var i18n = (0, _i18n.createI18n)({
        storage: mockStorage
      });
      var locale = i18n.getDeviceLocale();
      expect(locale).toBe('en');
      global.Intl = originalIntl;
    });
    it('should fallback to en when device locale is unsupported', function () {
      var originalIntl = global.Intl;
      global.Intl = {
        DateTimeFormat: jest.fn(function () {
          return {
            resolvedOptions: jest.fn(function () {
              return {
                locale: 'ja'
              };
            })
          };
        })
      };
      var i18n = (0, _i18n.createI18n)({
        storage: mockStorage
      });
      var locale = i18n.getDeviceLocale();
      expect(locale).toBe('en');
      global.Intl = originalIntl;
    });
  });
  describe('getCurrentLocale', function () {
    it('should return saved locale from storage when en', (0, _asyncToGenerator2.default)(function* () {
      var i18n = (0, _i18n.createI18n)({
        storage: mockStorage
      });
      mockStorage.getItem.mockResolvedValue('en');
      var locale = yield i18n.getCurrentLocale();
      expect(locale).toBe('en');
      expect(mockStorage.getItem).toHaveBeenCalledWith('user_locale');
    }));
    it('should return device locale when no saved locale', (0, _asyncToGenerator2.default)(function* () {
      mockStorage.getItem.mockResolvedValue(null);
      var i18n = (0, _i18n.createI18n)({
        storage: mockStorage
      });
      var locale = yield i18n.getCurrentLocale();
      expect(locale).toBe('en');
    }));
    it('should work without storage', (0, _asyncToGenerator2.default)(function* () {
      var i18n = (0, _i18n.createI18n)();
      var locale = yield i18n.getCurrentLocale();
      expect(locale).toBe('en');
    }));
  });
  describe('setLocale', function () {
    it('should save en locale to storage', (0, _asyncToGenerator2.default)(function* () {
      var i18n = (0, _i18n.createI18n)({
        storage: mockStorage
      });
      yield i18n.setLocale('en');
      expect(mockStorage.setItem).toHaveBeenCalledWith('user_locale', 'en');
    }));
    it('should throw error for unsupported locale', (0, _asyncToGenerator2.default)(function* () {
      var i18n = (0, _i18n.createI18n)({
        storage: mockStorage
      });
      yield expect(i18n.setLocale('fr')).rejects.toThrow('Unsupported locale: fr');
      expect(mockStorage.setItem).not.toHaveBeenCalled();
    }));
    it('should work without storage', (0, _asyncToGenerator2.default)(function* () {
      var i18n = (0, _i18n.createI18n)();
      yield i18n.setLocale('en');
    }));
  });
  describe('t (translation function)', function () {
    it('should translate key to en locale', (0, _asyncToGenerator2.default)(function* () {
      var i18n = (0, _i18n.createI18n)({
        storage: mockStorage
      });
      mockStorage.getItem.mockResolvedValue('en');
      var translation = yield i18n.t('common.save');
      expect(translation).toBe('Save');
    }));
    it('should replace parameters in translation', (0, _asyncToGenerator2.default)(function* () {
      var i18n = (0, _i18n.createI18n)({
        storage: mockStorage
      });
      mockStorage.getItem.mockResolvedValue('en');
      var translation = yield i18n.t('common.save', {});
      expect(typeof translation).toBe('string');
    }));
    it('should fallback to key when translation not found', (0, _asyncToGenerator2.default)(function* () {
      var i18n = (0, _i18n.createI18n)({
        storage: mockStorage
      });
      mockStorage.getItem.mockResolvedValue('en');
      var translation = yield i18n.t('nonexistent.key');
      expect(translation).toBe('nonexistent.key');
    }));
  });
  describe('tSync (synchronous translation function)', function () {
    it('should translate key synchronously', function () {
      var i18n = (0, _i18n.createI18n)({
        storage: mockStorage
      });
      var translation = i18n.tSync('common.save');
      expect(translation).toBe('Save');
    });
    it('should replace parameters in translation', function () {
      var i18n = (0, _i18n.createI18n)({
        storage: mockStorage
      });
      var translation = i18n.tSync('common.save', {});
      expect(typeof translation).toBe('string');
    });
    it('should fallback to key when translation not found', function () {
      var i18n = (0, _i18n.createI18n)({
        storage: mockStorage
      });
      var translation = i18n.tSync('nonexistent.key');
      expect(translation).toBe('nonexistent.key');
    });
  });
  describe('supportedLocales', function () {
    it('should export list of supported locales (only en in Phase 1)', function () {
      var i18n = (0, _i18n.createI18n)({
        storage: mockStorage
      });
      expect(i18n.supportedLocales).toEqual(['en']);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaTE4biIsInJlcXVpcmUiLCJkZXNjcmliZSIsIm1vY2tTdG9yYWdlIiwiZ2V0SXRlbSIsImplc3QiLCJmbiIsInNldEl0ZW0iLCJiZWZvcmVFYWNoIiwiY2xlYXJBbGxNb2NrcyIsIm1vY2tSZXNvbHZlZFZhbHVlIiwiaXQiLCJpMThuIiwiY3JlYXRlSTE4biIsInN0b3JhZ2UiLCJleHBlY3QiLCJ0b0JlRGVmaW5lZCIsImdldERldmljZUxvY2FsZSIsInRvQmUiLCJnZXRDdXJyZW50TG9jYWxlIiwic2V0TG9jYWxlIiwidCIsInRTeW5jIiwibG9jYWxlIiwib3JpZ2luYWxJbnRsIiwiZ2xvYmFsIiwiSW50bCIsIkRhdGVUaW1lRm9ybWF0IiwicmVzb2x2ZWRPcHRpb25zIiwiX2FzeW5jVG9HZW5lcmF0b3IyIiwiZGVmYXVsdCIsInRvSGF2ZUJlZW5DYWxsZWRXaXRoIiwicmVqZWN0cyIsInRvVGhyb3ciLCJub3QiLCJ0b0hhdmVCZWVuQ2FsbGVkIiwidHJhbnNsYXRpb24iLCJzdXBwb3J0ZWRMb2NhbGVzIiwidG9FcXVhbCJdLCJzb3VyY2VzIjpbImluZGV4LnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIGkxOG4gVGVzdHNcclxuICogRmlsZTogaW5kZXgudGVzdC5qc1xyXG4gKiBcclxuICogTk9URTogRHVyaW5nIFBoYXNlIDEsIG9ubHkgJ2VuJyBsb2NhbGUgaXMgY3JlYXRlZCBhbmQgdGVzdGVkLlxyXG4gKiBBbGwgb3RoZXIgbG9jYWxlcyB3aWxsIGJlIGNyZWF0ZWQgaW4gUGhhc2UgMTIgKEZpbmFsaXphdGlvbikuXHJcbiAqL1xyXG5pbXBvcnQgeyBjcmVhdGVJMThuIH0gZnJvbSAnQGkxOG4nO1xyXG5cclxuZGVzY3JpYmUoJ2kxOG4gU3lzdGVtJywgKCkgPT4ge1xyXG4gIGNvbnN0IG1vY2tTdG9yYWdlID0ge1xyXG4gICAgZ2V0SXRlbTogamVzdC5mbigpLFxyXG4gICAgc2V0SXRlbTogamVzdC5mbigpLFxyXG4gIH07XHJcblxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgICBtb2NrU3RvcmFnZS5nZXRJdGVtLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xyXG4gICAgbW9ja1N0b3JhZ2Uuc2V0SXRlbS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2NyZWF0ZUkxOG4nLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBpMThuIGluc3RhbmNlJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBpMThuID0gY3JlYXRlSTE4bih7IHN0b3JhZ2U6IG1vY2tTdG9yYWdlIH0pO1xyXG4gICAgICBleHBlY3QoaTE4bikudG9CZURlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KHR5cGVvZiBpMThuLmdldERldmljZUxvY2FsZSkudG9CZSgnZnVuY3Rpb24nKTtcclxuICAgICAgZXhwZWN0KHR5cGVvZiBpMThuLmdldEN1cnJlbnRMb2NhbGUpLnRvQmUoJ2Z1bmN0aW9uJyk7XHJcbiAgICAgIGV4cGVjdCh0eXBlb2YgaTE4bi5zZXRMb2NhbGUpLnRvQmUoJ2Z1bmN0aW9uJyk7XHJcbiAgICAgIGV4cGVjdCh0eXBlb2YgaTE4bi50KS50b0JlKCdmdW5jdGlvbicpO1xyXG4gICAgICBleHBlY3QodHlwZW9mIGkxOG4udFN5bmMpLnRvQmUoJ2Z1bmN0aW9uJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBpMThuIGluc3RhbmNlIHdpdGhvdXQgc3RvcmFnZScsICgpID0+IHtcclxuICAgICAgY29uc3QgaTE4biA9IGNyZWF0ZUkxOG4oKTtcclxuICAgICAgZXhwZWN0KGkxOG4pLnRvQmVEZWZpbmVkKCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2dldERldmljZUxvY2FsZScsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGRlZmF1bHQgbG9jYWxlIChlbikgd2hlbiBkZXZpY2UgbG9jYWxlIG5vdCBzdXBwb3J0ZWQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGkxOG4gPSBjcmVhdGVJMThuKHsgc3RvcmFnZTogbW9ja1N0b3JhZ2UgfSk7XHJcbiAgICAgIGNvbnN0IGxvY2FsZSA9IGkxOG4uZ2V0RGV2aWNlTG9jYWxlKCk7XHJcbiAgICAgIC8vIER1cmluZyBQaGFzZSAxLCBvbmx5ICdlbicgaXMgc3VwcG9ydGVkLCBzbyBpdCBzaG91bGQgcmV0dXJuICdlbidcclxuICAgICAgZXhwZWN0KGxvY2FsZSkudG9CZSgnZW4nKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGVuIHdoZW4gZGV2aWNlIGxvY2FsZSBpcyBlbicsICgpID0+IHtcclxuICAgICAgLy8gTW9jayBJbnRsIHRvIHJldHVybiAnZW4nXHJcbiAgICAgIGNvbnN0IG9yaWdpbmFsSW50bCA9IGdsb2JhbC5JbnRsO1xyXG4gICAgICBnbG9iYWwuSW50bCA9IHtcclxuICAgICAgICBEYXRlVGltZUZvcm1hdDogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgcmVzb2x2ZWRPcHRpb25zOiBqZXN0LmZuKCgpID0+ICh7IGxvY2FsZTogJ2VuJyB9KSksXHJcbiAgICAgICAgfSkpLFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgaTE4biA9IGNyZWF0ZUkxOG4oeyBzdG9yYWdlOiBtb2NrU3RvcmFnZSB9KTtcclxuICAgICAgY29uc3QgbG9jYWxlID0gaTE4bi5nZXREZXZpY2VMb2NhbGUoKTtcclxuICAgICAgZXhwZWN0KGxvY2FsZSkudG9CZSgnZW4nKTtcclxuXHJcbiAgICAgIGdsb2JhbC5JbnRsID0gb3JpZ2luYWxJbnRsO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBmYWxsYmFjayB0byBlbiB3aGVuIGRldmljZSBsb2NhbGUgaXMgdW5zdXBwb3J0ZWQnLCAoKSA9PiB7XHJcbiAgICAgIC8vIE1vY2sgSW50bCB0byByZXR1cm4gdW5zdXBwb3J0ZWQgbG9jYWxlXHJcbiAgICAgIGNvbnN0IG9yaWdpbmFsSW50bCA9IGdsb2JhbC5JbnRsO1xyXG4gICAgICBnbG9iYWwuSW50bCA9IHtcclxuICAgICAgICBEYXRlVGltZUZvcm1hdDogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgcmVzb2x2ZWRPcHRpb25zOiBqZXN0LmZuKCgpID0+ICh7IGxvY2FsZTogJ2phJyB9KSksXHJcbiAgICAgICAgfSkpLFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgaTE4biA9IGNyZWF0ZUkxOG4oeyBzdG9yYWdlOiBtb2NrU3RvcmFnZSB9KTtcclxuICAgICAgY29uc3QgbG9jYWxlID0gaTE4bi5nZXREZXZpY2VMb2NhbGUoKTtcclxuICAgICAgZXhwZWN0KGxvY2FsZSkudG9CZSgnZW4nKTtcclxuXHJcbiAgICAgIGdsb2JhbC5JbnRsID0gb3JpZ2luYWxJbnRsO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdnZXRDdXJyZW50TG9jYWxlJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gc2F2ZWQgbG9jYWxlIGZyb20gc3RvcmFnZSB3aGVuIGVuJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBpMThuID0gY3JlYXRlSTE4bih7IHN0b3JhZ2U6IG1vY2tTdG9yYWdlIH0pO1xyXG4gICAgICBtb2NrU3RvcmFnZS5nZXRJdGVtLm1vY2tSZXNvbHZlZFZhbHVlKCdlbicpO1xyXG4gICAgICBjb25zdCBsb2NhbGUgPSBhd2FpdCBpMThuLmdldEN1cnJlbnRMb2NhbGUoKTtcclxuICAgICAgZXhwZWN0KGxvY2FsZSkudG9CZSgnZW4nKTtcclxuICAgICAgZXhwZWN0KG1vY2tTdG9yYWdlLmdldEl0ZW0pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd1c2VyX2xvY2FsZScpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZGV2aWNlIGxvY2FsZSB3aGVuIG5vIHNhdmVkIGxvY2FsZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgbW9ja1N0b3JhZ2UuZ2V0SXRlbS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcclxuICAgICAgY29uc3QgaTE4biA9IGNyZWF0ZUkxOG4oeyBzdG9yYWdlOiBtb2NrU3RvcmFnZSB9KTtcclxuICAgICAgY29uc3QgbG9jYWxlID0gYXdhaXQgaTE4bi5nZXRDdXJyZW50TG9jYWxlKCk7XHJcbiAgICAgIGV4cGVjdChsb2NhbGUpLnRvQmUoJ2VuJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHdvcmsgd2l0aG91dCBzdG9yYWdlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBpMThuID0gY3JlYXRlSTE4bigpO1xyXG4gICAgICBjb25zdCBsb2NhbGUgPSBhd2FpdCBpMThuLmdldEN1cnJlbnRMb2NhbGUoKTtcclxuICAgICAgZXhwZWN0KGxvY2FsZSkudG9CZSgnZW4nKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnc2V0TG9jYWxlJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBzYXZlIGVuIGxvY2FsZSB0byBzdG9yYWdlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBpMThuID0gY3JlYXRlSTE4bih7IHN0b3JhZ2U6IG1vY2tTdG9yYWdlIH0pO1xyXG4gICAgICBhd2FpdCBpMThuLnNldExvY2FsZSgnZW4nKTtcclxuICAgICAgZXhwZWN0KG1vY2tTdG9yYWdlLnNldEl0ZW0pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd1c2VyX2xvY2FsZScsICdlbicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBmb3IgdW5zdXBwb3J0ZWQgbG9jYWxlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBpMThuID0gY3JlYXRlSTE4bih7IHN0b3JhZ2U6IG1vY2tTdG9yYWdlIH0pO1xyXG4gICAgICBhd2FpdCBleHBlY3QoaTE4bi5zZXRMb2NhbGUoJ2ZyJykpLnJlamVjdHMudG9UaHJvdygnVW5zdXBwb3J0ZWQgbG9jYWxlOiBmcicpO1xyXG4gICAgICBleHBlY3QobW9ja1N0b3JhZ2Uuc2V0SXRlbSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgd29yayB3aXRob3V0IHN0b3JhZ2UnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGkxOG4gPSBjcmVhdGVJMThuKCk7XHJcbiAgICAgIGF3YWl0IGkxOG4uc2V0TG9jYWxlKCdlbicpO1xyXG4gICAgICAvLyBTaG91bGQgbm90IHRocm93XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ3QgKHRyYW5zbGF0aW9uIGZ1bmN0aW9uKScsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgdHJhbnNsYXRlIGtleSB0byBlbiBsb2NhbGUnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGkxOG4gPSBjcmVhdGVJMThuKHsgc3RvcmFnZTogbW9ja1N0b3JhZ2UgfSk7XHJcbiAgICAgIG1vY2tTdG9yYWdlLmdldEl0ZW0ubW9ja1Jlc29sdmVkVmFsdWUoJ2VuJyk7XHJcbiAgICAgIGNvbnN0IHRyYW5zbGF0aW9uID0gYXdhaXQgaTE4bi50KCdjb21tb24uc2F2ZScpO1xyXG4gICAgICBleHBlY3QodHJhbnNsYXRpb24pLnRvQmUoJ1NhdmUnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmVwbGFjZSBwYXJhbWV0ZXJzIGluIHRyYW5zbGF0aW9uJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBpMThuID0gY3JlYXRlSTE4bih7IHN0b3JhZ2U6IG1vY2tTdG9yYWdlIH0pO1xyXG4gICAgICBtb2NrU3RvcmFnZS5nZXRJdGVtLm1vY2tSZXNvbHZlZFZhbHVlKCdlbicpO1xyXG4gICAgICAvLyBUZXN0IHdpdGggYSBrZXkgdGhhdCBoYXMgcGFyYW1ldGVycyAoaWYgZXhpc3RzIGluIGVuLmpzb24pXHJcbiAgICAgIC8vIEZvciBub3csIHRlc3QgdGhhdCBpdCBkb2Vzbid0IGNyYXNoXHJcbiAgICAgIGNvbnN0IHRyYW5zbGF0aW9uID0gYXdhaXQgaTE4bi50KCdjb21tb24uc2F2ZScsIHt9KTtcclxuICAgICAgZXhwZWN0KHR5cGVvZiB0cmFuc2xhdGlvbikudG9CZSgnc3RyaW5nJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGZhbGxiYWNrIHRvIGtleSB3aGVuIHRyYW5zbGF0aW9uIG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgaTE4biA9IGNyZWF0ZUkxOG4oeyBzdG9yYWdlOiBtb2NrU3RvcmFnZSB9KTtcclxuICAgICAgbW9ja1N0b3JhZ2UuZ2V0SXRlbS5tb2NrUmVzb2x2ZWRWYWx1ZSgnZW4nKTtcclxuICAgICAgY29uc3QgdHJhbnNsYXRpb24gPSBhd2FpdCBpMThuLnQoJ25vbmV4aXN0ZW50LmtleScpO1xyXG4gICAgICBleHBlY3QodHJhbnNsYXRpb24pLnRvQmUoJ25vbmV4aXN0ZW50LmtleScpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCd0U3luYyAoc3luY2hyb25vdXMgdHJhbnNsYXRpb24gZnVuY3Rpb24pJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCB0cmFuc2xhdGUga2V5IHN5bmNocm9ub3VzbHknLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGkxOG4gPSBjcmVhdGVJMThuKHsgc3RvcmFnZTogbW9ja1N0b3JhZ2UgfSk7XHJcbiAgICAgIGNvbnN0IHRyYW5zbGF0aW9uID0gaTE4bi50U3luYygnY29tbW9uLnNhdmUnKTtcclxuICAgICAgZXhwZWN0KHRyYW5zbGF0aW9uKS50b0JlKCdTYXZlJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJlcGxhY2UgcGFyYW1ldGVycyBpbiB0cmFuc2xhdGlvbicsICgpID0+IHtcclxuICAgICAgY29uc3QgaTE4biA9IGNyZWF0ZUkxOG4oeyBzdG9yYWdlOiBtb2NrU3RvcmFnZSB9KTtcclxuICAgICAgLy8gVGVzdCBwYXJhbWV0ZXIgaW50ZXJwb2xhdGlvblxyXG4gICAgICBjb25zdCB0cmFuc2xhdGlvbiA9IGkxOG4udFN5bmMoJ2NvbW1vbi5zYXZlJywge30pO1xyXG4gICAgICBleHBlY3QodHlwZW9mIHRyYW5zbGF0aW9uKS50b0JlKCdzdHJpbmcnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgZmFsbGJhY2sgdG8ga2V5IHdoZW4gdHJhbnNsYXRpb24gbm90IGZvdW5kJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBpMThuID0gY3JlYXRlSTE4bih7IHN0b3JhZ2U6IG1vY2tTdG9yYWdlIH0pO1xyXG4gICAgICBjb25zdCB0cmFuc2xhdGlvbiA9IGkxOG4udFN5bmMoJ25vbmV4aXN0ZW50LmtleScpO1xyXG4gICAgICBleHBlY3QodHJhbnNsYXRpb24pLnRvQmUoJ25vbmV4aXN0ZW50LmtleScpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdzdXBwb3J0ZWRMb2NhbGVzJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBleHBvcnQgbGlzdCBvZiBzdXBwb3J0ZWQgbG9jYWxlcyAob25seSBlbiBpbiBQaGFzZSAxKScsICgpID0+IHtcclxuICAgICAgY29uc3QgaTE4biA9IGNyZWF0ZUkxOG4oeyBzdG9yYWdlOiBtb2NrU3RvcmFnZSB9KTtcclxuICAgICAgZXhwZWN0KGkxOG4uc3VwcG9ydGVkTG9jYWxlcykudG9FcXVhbChbJ2VuJ10pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG5cclxuIl0sIm1hcHBpbmdzIjoiOztBQU9BLElBQUFBLEtBQUEsR0FBQUMsT0FBQTtBQUVBQyxRQUFRLENBQUMsYUFBYSxFQUFFLFlBQU07RUFDNUIsSUFBTUMsV0FBVyxHQUFHO0lBQ2xCQyxPQUFPLEVBQUVDLElBQUksQ0FBQ0MsRUFBRSxDQUFDLENBQUM7SUFDbEJDLE9BQU8sRUFB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