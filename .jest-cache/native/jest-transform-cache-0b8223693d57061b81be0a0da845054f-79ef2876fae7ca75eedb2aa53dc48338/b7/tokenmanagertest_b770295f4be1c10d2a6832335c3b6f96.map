{"version":3,"names":["_getJestObj","mock","secure","mockSecureStorage","_interopRequireDefault","require","default","_asyncToGenerator2","_require2","jest","getItem","fn","setItem","removeItem","_require","tokenManager","base64Encode","value","globalThis","btoa","Buffer","from","toString","Error","describe","beforeEach","clearAllMocks","it","token","mockResolvedValue","result","getAccessToken","expect","toBe","toHaveBeenCalledWith","toBeNull","getRefreshToken","accessToken","refreshToken","setTokens","mockResolvedValueOnce","clearTokens","isTokenExpired","undefined","expiredTime","Math","floor","Date","now","payload","exp","JSON","stringify","futureTime"],"sources":["token.manager.test.js"],"sourcesContent":["/**\r\n * Token Manager Tests\r\n * File: token.manager.test.js\r\n */\r\n// Mock storage service\r\nconst mockSecureStorage = {\r\n  getItem: jest.fn(),\r\n  setItem: jest.fn(),\r\n  removeItem: jest.fn(),\r\n};\r\n\r\njest.mock('@services/storage', () => ({\r\n  secure: mockSecureStorage,\r\n}));\r\n\r\nconst { tokenManager } = require('@security');\r\n\r\nconst base64Encode = (value) => {\r\n  if (typeof globalThis?.btoa === 'function') return globalThis.btoa(value);\r\n  // eslint-disable-next-line no-undef\r\n  if (typeof Buffer !== 'undefined') {\r\n    // eslint-disable-next-line no-undef\r\n    return Buffer.from(value, 'utf8').toString('base64');\r\n  }\r\n  throw new Error('NO_BASE64_ENCODER');\r\n};\r\n\r\ndescribe('Token Manager', () => {\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  describe('getAccessToken', () => {\r\n    it('should retrieve access token from secure storage', async () => {\r\n      const token = 'access-token-123';\r\n      mockSecureStorage.getItem.mockResolvedValue(token);\r\n\r\n      const result = await tokenManager.getAccessToken();\r\n      expect(result).toBe(token);\r\n      expect(mockSecureStorage.getItem).toHaveBeenCalledWith('access_token');\r\n    });\r\n\r\n    it('should return null when token does not exist', async () => {\r\n      mockSecureStorage.getItem.mockResolvedValue(null);\r\n\r\n      const result = await tokenManager.getAccessToken();\r\n      expect(result).toBeNull();\r\n    });\r\n  });\r\n\r\n  describe('getRefreshToken', () => {\r\n    it('should retrieve refresh token from secure storage', async () => {\r\n      const token = 'refresh-token-123';\r\n      mockSecureStorage.getItem.mockResolvedValue(token);\r\n\r\n      const result = await tokenManager.getRefreshToken();\r\n      expect(result).toBe(token);\r\n      expect(mockSecureStorage.getItem).toHaveBeenCalledWith('refresh_token');\r\n    });\r\n\r\n    it('should return null when token does not exist', async () => {\r\n      mockSecureStorage.getItem.mockResolvedValue(null);\r\n\r\n      const result = await tokenManager.getRefreshToken();\r\n      expect(result).toBeNull();\r\n    });\r\n  });\r\n\r\n  describe('setTokens', () => {\r\n    it('should store both access and refresh tokens', async () => {\r\n      const accessToken = 'access-token-123';\r\n      const refreshToken = 'refresh-token-123';\r\n      mockSecureStorage.setItem.mockResolvedValue(true);\r\n\r\n      const result = await tokenManager.setTokens(accessToken, refreshToken);\r\n      expect(result).toBe(true);\r\n      expect(mockSecureStorage.setItem).toHaveBeenCalledWith('access_token', accessToken);\r\n      expect(mockSecureStorage.setItem).toHaveBeenCalledWith('refresh_token', refreshToken);\r\n    });\r\n\r\n    it('should return false if any token storage fails', async () => {\r\n      const accessToken = 'access-token-123';\r\n      const refreshToken = 'refresh-token-123';\r\n      mockSecureStorage.setItem\r\n        .mockResolvedValueOnce(true)\r\n        .mockResolvedValueOnce(false);\r\n\r\n      const result = await tokenManager.setTokens(accessToken, refreshToken);\r\n      expect(result).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('clearTokens', () => {\r\n    it('should remove both tokens from secure storage', async () => {\r\n      mockSecureStorage.removeItem.mockResolvedValue(true);\r\n\r\n      await tokenManager.clearTokens();\r\n      expect(mockSecureStorage.removeItem).toHaveBeenCalledWith('access_token');\r\n      expect(mockSecureStorage.removeItem).toHaveBeenCalledWith('refresh_token');\r\n    });\r\n  });\r\n\r\n  describe('isTokenExpired', () => {\r\n    it('should return true for null or undefined token', () => {\r\n      expect(tokenManager.isTokenExpired(null)).toBe(true);\r\n      expect(tokenManager.isTokenExpired(undefined)).toBe(true);\r\n      expect(tokenManager.isTokenExpired('')).toBe(true);\r\n    });\r\n\r\n    it('should return true for expired token', () => {\r\n      const expiredTime = Math.floor((Date.now() - 1000) / 1000); // 1 second ago\r\n      const payload = { exp: expiredTime };\r\n      const token = `header.${base64Encode(JSON.stringify(payload))}.signature`;\r\n\r\n      expect(tokenManager.isTokenExpired(token)).toBe(true);\r\n    });\r\n\r\n    it('should return false for valid token', () => {\r\n      const futureTime = Math.floor((Date.now() + 3600000) / 1000); // 1 hour from now\r\n      const payload = { exp: futureTime };\r\n      const token = `header.${base64Encode(JSON.stringify(payload))}.signature`;\r\n\r\n      expect(tokenManager.isTokenExpired(token)).toBe(false);\r\n    });\r\n\r\n    it('should return true for invalid token format', () => {\r\n      expect(tokenManager.isTokenExpired('invalid-token')).toBe(true);\r\n      expect(tokenManager.isTokenExpired('header.payload')).toBe(true);\r\n      expect(tokenManager.isTokenExpired('not.a.valid.jwt.token')).toBe(true);\r\n    });\r\n\r\n    it('should return true for token with invalid base64 payload', () => {\r\n      const token = 'header.invalid-base64.signature';\r\n      expect(tokenManager.isTokenExpired(token)).toBe(true);\r\n    });\r\n  });\r\n});\r\n\r\n"],"mappings":"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","ignoreList":[]}