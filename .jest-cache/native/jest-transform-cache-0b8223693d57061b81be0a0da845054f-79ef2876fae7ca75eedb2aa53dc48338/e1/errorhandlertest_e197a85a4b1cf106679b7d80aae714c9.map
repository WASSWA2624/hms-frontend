{"version":3,"names":["_getJestObj","mock","logger","error","jest","fn","_error","require","_logging","_require","describe","beforeEach","clearAllMocks","test","normalized","normalizeError","expect","toHaveProperty","code","toBe","undefined","networkError","name","severity","authError","status","forbiddenError","serverError","statusCode","message","safeMessage","toBeTruthy","handleError","context","toHaveBeenCalled","toHaveBeenCalledWith","objectContaining","toBeDefined"],"sources":["error.handler.test.js"],"sourcesContent":["/**\r\n * Error Handler Tests\r\n * File: error.handler.test.js\r\n */\r\nimport { normalizeError, handleError } from '@errors/error.handler';\r\nimport { logger } from '@logging';\r\n\r\njest.mock('@logging', () => ({\r\n  logger: {\r\n    error: jest.fn(),\r\n  },\r\n}));\r\n\r\ndescribe('errors/error.handler.js', () => {\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  describe('normalizeError', () => {\r\n    test('should normalize null error', () => {\r\n      const normalized = normalizeError(null);\r\n      expect(normalized).toHaveProperty('code');\r\n      expect(normalized).toHaveProperty('message');\r\n      expect(normalized).toHaveProperty('safeMessage');\r\n      expect(normalized).toHaveProperty('severity');\r\n      expect(normalized.code).toBe('UNKNOWN_ERROR');\r\n    });\r\n\r\n    test('should normalize undefined error', () => {\r\n      const normalized = normalizeError(undefined);\r\n      expect(normalized.code).toBe('UNKNOWN_ERROR');\r\n    });\r\n\r\n    test('should normalize network errors', () => {\r\n      const networkError = { name: 'NetworkError' };\r\n      const normalized = normalizeError(networkError);\r\n      expect(normalized.code).toBe('NETWORK_ERROR');\r\n      expect(normalized.severity).toBe('warning');\r\n    });\r\n\r\n    test('should normalize 401 unauthorized errors', () => {\r\n      const authError = { status: 401 };\r\n      const normalized = normalizeError(authError);\r\n      expect(normalized.code).toBe('UNAUTHORIZED');\r\n      expect(normalized.severity).toBe('error');\r\n    });\r\n\r\n    test('should normalize 403 forbidden errors', () => {\r\n      const forbiddenError = { status: 403 };\r\n      const normalized = normalizeError(forbiddenError);\r\n      expect(normalized.code).toBe('FORBIDDEN');\r\n      expect(normalized.severity).toBe('error');\r\n    });\r\n\r\n    test('should normalize 500+ server errors', () => {\r\n      const serverError = { status: 500 };\r\n      const normalized = normalizeError(serverError);\r\n      expect(normalized.code).toBe('SERVER_ERROR');\r\n      expect(normalized.severity).toBe('error');\r\n    });\r\n\r\n    test('should normalize errors with statusCode', () => {\r\n      const error = { statusCode: 401 };\r\n      const normalized = normalizeError(error);\r\n      expect(normalized.code).toBe('UNAUTHORIZED');\r\n    });\r\n\r\n    test('should normalize errors with code', () => {\r\n      const error = { code: 'CUSTOM_ERROR', message: 'Custom error message' };\r\n      const normalized = normalizeError(error);\r\n      expect(normalized.code).toBe('CUSTOM_ERROR');\r\n      expect(normalized.message).toBe('Custom error message');\r\n    });\r\n\r\n    test('should use safeMessage from i18n', () => {\r\n      const error = { code: 'NETWORK_ERROR' };\r\n      const normalized = normalizeError(error);\r\n      expect(normalized.safeMessage).toBeTruthy();\r\n      expect(typeof normalized.safeMessage).toBe('string');\r\n    });\r\n  });\r\n\r\n  describe('handleError', () => {\r\n    test('should handle error and log it', () => {\r\n      const error = { code: 'TEST_ERROR', message: 'Test error' };\r\n      const normalized = handleError(error, { context: 'test' });\r\n      expect(logger.error).toHaveBeenCalled();\r\n      expect(normalized).toHaveProperty('code');\r\n    });\r\n\r\n    test('should include context in log', () => {\r\n      const error = { code: 'TEST_ERROR' };\r\n      handleError(error, { context: 'test' });\r\n      expect(logger.error).toHaveBeenCalledWith(\r\n        'Handled error',\r\n        expect.objectContaining({\r\n          context: { context: 'test' },\r\n        })\r\n      );\r\n    });\r\n\r\n    test('should handle invalid context gracefully', () => {\r\n      const error = { code: 'TEST_ERROR' };\r\n      const normalized = handleError(error, 'invalid context');\r\n      expect(normalized).toBeDefined();\r\n      expect(logger.error).toHaveBeenCalled();\r\n    });\r\n  });\r\n});\r\n\r\n"],"mappings":"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","ignoreList":[]}