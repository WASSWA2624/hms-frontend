753794cba89f1681d485a0cac67baeee
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _react = _interopRequireDefault(require("react"));
var _reactNative = require("@testing-library/react-native");
var _reactTestRenderer = require("react-test-renderer");
var _useCrud = _interopRequireDefault(require("../../hooks/useCrud"));
var _jsxRuntime = require("react/jsx-runtime");
var TestComponent = function TestComponent(_ref) {
  var actions = _ref.actions,
    onResult = _ref.onResult;
  var api = (0, _useCrud.default)(actions);
  _react.default.useEffect(function () {
    onResult(api);
  });
  return null;
};
describe('useCrud', function () {
  it('runs actions and updates async state', (0, _asyncToGenerator2.default)(function* () {
    var action = jest.fn().mockResolvedValue({
      ok: true
    });
    var api;
    (0, _reactNative.render)((0, _jsxRuntime.jsx)(TestComponent, {
      actions: {
        list: action
      },
      onResult: function onResult(value) {
        return api = value;
      }
    }));
    yield (0, _reactNative.waitFor)(function () {
      expect(api.isLoading).toBe(false);
      expect(api.errorCode).toBeNull();
    });
    yield (0, _reactTestRenderer.act)((0, _asyncToGenerator2.default)(function* () {
      yield api.list();
    }));
    yield (0, _reactNative.waitFor)(function () {
      expect(api.isLoading).toBe(false);
      expect(api.data).toEqual({
        ok: true
      });
    });
  }));
  it('stores error codes when action fails', (0, _asyncToGenerator2.default)(function* () {
    var action = jest.fn().mockRejectedValue({
      code: 'UNAUTHORIZED'
    });
    var api;
    (0, _reactNative.render)((0, _jsxRuntime.jsx)(TestComponent, {
      actions: {
        get: action
      },
      onResult: function onResult(value) {
        return api = value;
      }
    }));
    yield (0, _reactTestRenderer.act)((0, _asyncToGenerator2.default)(function* () {
      try {
        yield api.get('1');
      } catch (error) {
        expect(error.code).toBe('UNAUTHORIZED');
      }
    }));
    yield (0, _reactNative.waitFor)(function () {
      expect(api.errorCode).toBe('UNAUTHORIZED');
    });
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9yZWFjdE5hdGl2ZSIsIl9yZWFjdFRlc3RSZW5kZXJlciIsIl91c2VDcnVkIiwiX2pzeFJ1bnRpbWUiLCJUZXN0Q29tcG9uZW50IiwiX3JlZiIsImFjdGlvbnMiLCJvblJlc3VsdCIsImFwaSIsInVzZUNydWQiLCJSZWFjdCIsInVzZUVmZmVjdCIsImRlc2NyaWJlIiwiaXQiLCJfYXN5bmNUb0dlbmVyYXRvcjIiLCJkZWZhdWx0IiwiYWN0aW9uIiwiamVzdCIsImZuIiwibW9ja1Jlc29sdmVkVmFsdWUiLCJvayIsInJlbmRlciIsImpzeCIsImxpc3QiLCJ2YWx1ZSIsIndhaXRGb3IiLCJleHBlY3QiLCJpc0xvYWRpbmciLCJ0b0JlIiwiZXJyb3JDb2RlIiwidG9CZU51bGwiLCJhY3QiLCJkYXRhIiwidG9FcXVhbCIsIm1vY2tSZWplY3RlZFZhbHVlIiwiY29kZSIsImdldCIsImVycm9yIl0sInNvdXJjZXMiOlsidXNlQ3J1ZC50ZXN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiB1c2VDcnVkIEhvb2sgVGVzdHNcclxuICogRmlsZTogdXNlQ3J1ZC50ZXN0LmpzXHJcbiAqL1xyXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgeyByZW5kZXIsIHdhaXRGb3IgfSBmcm9tICdAdGVzdGluZy1saWJyYXJ5L3JlYWN0LW5hdGl2ZSc7XHJcbmltcG9ydCB7IGFjdCB9IGZyb20gJ3JlYWN0LXRlc3QtcmVuZGVyZXInO1xyXG5pbXBvcnQgdXNlQ3J1ZCBmcm9tICdAaG9va3MvdXNlQ3J1ZCc7XHJcblxyXG5jb25zdCBUZXN0Q29tcG9uZW50ID0gKHsgYWN0aW9ucywgb25SZXN1bHQgfSkgPT4ge1xyXG4gIGNvbnN0IGFwaSA9IHVzZUNydWQoYWN0aW9ucyk7XHJcbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcclxuICAgIG9uUmVzdWx0KGFwaSk7XHJcbiAgfSk7XHJcbiAgcmV0dXJuIG51bGw7XHJcbn07XHJcblxyXG5kZXNjcmliZSgndXNlQ3J1ZCcsICgpID0+IHtcclxuICBpdCgncnVucyBhY3Rpb25zIGFuZCB1cGRhdGVzIGFzeW5jIHN0YXRlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgYWN0aW9uID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgb2s6IHRydWUgfSk7XHJcbiAgICBsZXQgYXBpO1xyXG4gICAgcmVuZGVyKDxUZXN0Q29tcG9uZW50IGFjdGlvbnM9e3sgbGlzdDogYWN0aW9uIH19IG9uUmVzdWx0PXsodmFsdWUpID0+IChhcGkgPSB2YWx1ZSl9IC8+KTtcclxuXHJcbiAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcclxuICAgICAgZXhwZWN0KGFwaS5pc0xvYWRpbmcpLnRvQmUoZmFsc2UpO1xyXG4gICAgICBleHBlY3QoYXBpLmVycm9yQ29kZSkudG9CZU51bGwoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGF3YWl0IGFjdChhc3luYyAoKSA9PiB7XHJcbiAgICAgIGF3YWl0IGFwaS5saXN0KCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcclxuICAgICAgZXhwZWN0KGFwaS5pc0xvYWRpbmcpLnRvQmUoZmFsc2UpO1xyXG4gICAgICBleHBlY3QoYXBpLmRhdGEpLnRvRXF1YWwoeyBvazogdHJ1ZSB9KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBpdCgnc3RvcmVzIGVycm9yIGNvZGVzIHdoZW4gYWN0aW9uIGZhaWxzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgYWN0aW9uID0gamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKHsgY29kZTogJ1VOQVVUSE9SSVpFRCcgfSk7XHJcbiAgICBsZXQgYXBpO1xyXG4gICAgcmVuZGVyKDxUZXN0Q29tcG9uZW50IGFjdGlvbnM9e3sgZ2V0OiBhY3Rpb24gfX0gb25SZXN1bHQ9eyh2YWx1ZSkgPT4gKGFwaSA9IHZhbHVlKX0gLz4pO1xyXG5cclxuICAgIGF3YWl0IGFjdChhc3luYyAoKSA9PiB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgYXdhaXQgYXBpLmdldCgnMScpO1xyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGV4cGVjdChlcnJvci5jb2RlKS50b0JlKCdVTkFVVEhPUklaRUQnKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XHJcbiAgICAgIGV4cGVjdChhcGkuZXJyb3JDb2RlKS50b0JlKCdVTkFVVEhPUklaRUQnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTtcclxuIl0sIm1hcHBpbmdzIjoiOztBQUlBLElBQUFBLE1BQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLFlBQUEsR0FBQUQsT0FBQTtBQUNBLElBQUFFLGtCQUFBLEdBQUFGLE9BQUE7QUFDQSxJQUFBRyxRQUFBLEdBQUFKLHNCQUFBLENBQUFDLE9BQUE7QUFBcUMsSUFBQUksV0FBQSxHQUFBSixPQUFBO0FBRXJDLElBQU1LLGFBQWEsR0FBRyxTQUFoQkEsYUFBYUEsQ0FBQUMsSUFBQSxFQUE4QjtFQUFBLElBQXhCQyxPQUFPLEdBQUFELElBQUEsQ0FBUEMsT0FBTztJQUFFQyxRQUFRLEdBQUFGLElBQUEsQ0FBUkUsUUFBUTtFQUN4QyxJQUFNQyxHQUFHLEdBQUcsSUFBQUMsZ0JBQU8sRUFBQ0gsT0FBTyxDQUFDO0VBQzVCSSxjQUFLLENBQUNDLFNBQVMsQ0FBQyxZQUFNO0lBQ3BCSixRQUFRLENBQUNDLEdBQUcsQ0FBQztFQUNmLENBQUMsQ0FBQztFQUNGLE9BQU8sSUFBSTtBQUNiLENBQUM7QUFFREksUUFBUSxDQUFDLFNBQVMsRUFBRSxZQUFNO0VBQ3hCQyxFQUFFLENBQUMsc0NBQXNDLE1BQUFDLGtCQUFBLENBQUFDLE9BQUEsRUFBRSxhQUFZO0lBQ3JELElBQU1DLE1BQU0sR0FBR0MsSUFBSSxDQUFDQyxFQUFFLENBQUMsQ0FBQyxDQUFDQyxpQkFBaUIsQ0FBQztNQUFFQyxFQUFFLEVBQUU7SUFBSyxDQUFDLENBQUM7SUFDeEQsSUFBSVosR0FBRztJQUNQLElBQUFhLG1CQUFNLEVBQUMsSUFBQWxCLFdBQUEsQ0FBQW1CLEdBQUEsRUFBQ2xCLGFBQWE7TUFBQ0UsT0FBTyxFQUFFO1FBQUVpQixJQUFJLEVBQUVQO01BQU8sQ0FBRTtNQUFDVCxRQUFRLEVBQUUsU0FBVkEsUUFBUUEsQ0FBR2lCLEtBQUs7UUFBQSxPQUFNaEIsR0FBRyxHQUFHZ0IsS0FBSztNQUFBO0lBQUUsQ0FBRSxDQUFDLENBQUM7SUFFeEYsTUFBTSxJQUFBQyxvQkFBTyxFQUFDLFlBQU07TUFDbEJDLE1BQU0sQ0FBQ2xCLEdBQUcsQ0FBQ21CLFNBQVMsQ0FBQyxDQUFDQyxJQUFJLENBQUMsS0FBSyxDQUFDO01BQ2pDRixNQUFNLENBQUNsQixHQUFHLENBQUNxQixTQUFTLENBQUMsQ0FBQ0MsUUFBUSxDQUFDLENBQUM7SUFDbEMsQ0FBQyxDQUFDO0lBRUYsTUFBTSxJQUFBQyxzQkFBRyxNQUFBakIsa0JBQUEsQ0FBQUMsT0FBQSxFQUFDLGFBQVk7TUFDcEIsTUFBTVAsR0FBRyxDQUFDZSxJQUFJLENBQUMsQ0FBQztJQUNsQixDQUFDLEVBQUM7SUFFRixNQUFNLElBQUFFLG9CQUFPLEVBQUMsWUFBTTtNQUNsQkMsTUFBTSxDQUFDbEIsR0FBRyxDQUFDbUIsU0FBUyxDQUFDLENBQUNDLElBQUksQ0FBQyxLQUFLLENBQUM7TUFDakNGLE1BQU0sQ0FBQ2xCLEdBQUcsQ0FBQ3dCLElBQUksQ0FBQyxDQUFDQyxPQUFPLENBQUM7UUFBRWIsRUFBRSxFQUFFO01BQUssQ0FBQyxDQUFDO0lBQ3hDLENBQUMsQ0FBQztFQUNKLENBQUMsRUFBQztFQUVGUCxFQUFFLENBQUMsc0NBQXNDLE1BQUFDLGtCQUFBLENBQUFDLE9BQUEsRUFBRSxhQUFZO0lBQ3JELElBQU1DLE1BQU0sR0FBR0MsSUFBSSxDQUFDQyxFQUFFLENBQUMsQ0FBQyxDQUFDZ0IsaUJBQWlCLENBQUM7TUFBRUMsSUFBSSxFQUFFO0lBQWUsQ0FBQyxDQUFDO0lBQ3BFLElBQUkzQixHQUFHO0lBQ1AsSUFBQWEsbUJBQU0sRUFBQyxJQUFBbEIsV0FBQSxDQUFBbUIsR0FBQSxFQUFDbEIsYUFBYTtNQUFDRSxPQUFPLEVBQUU7UUFBRThCLEdBQUcsRUFBRXBCO01BQU8sQ0FBRTtNQUFDVCxRQUFRLEVBQUUsU0FBVkEsUUFBUUEsQ0FBR2lCLEtBQUs7UUFBQSxPQUFNaEIsR0FBRyxHQUFHZ0IsS0FBSztNQUFBO0lBQUUsQ0FBRSxDQUFDLENBQUM7SUFFdkYsTUFBTSxJQUFBTyxzQkFBRyxNQUFBakIsa0JBQUEsQ0FBQUMsT0FBQSxFQUFDLGFBQVk7TUFDcEIsSUFBSTtRQUNGLE1BQU1QLEdBQUcsQ0FBQzRCLEdBQUcsQ0FBQyxHQUFHLENBQUM7TUFDcEIsQ0FBQyxDQUFDLE9BQU9DLEtBQUssRUFBRTtRQUNkWCxNQUFNLENBQUNXLEtBQUssQ0FBQ0YsSUFBSSxDQUFDLENBQUNQLElBQUksQ0FBQyxjQUFjLENBQUM7TUFDekM7SUFDRixDQUFDLEVBQUM7SUFFRixNQUFNLElBQUFILG9CQUFPLEVBQUMsWUFBTTtNQUNsQkMsTUFBTSxDQUFDbEIsR0FBRyxDQUFDcUIsU0FBUyxDQUFDLENBQUNELElBQUksQ0FBQyxjQUFjLENBQUM7SUFDNUMsQ0FBQyxDQUFDO0VBQ0osQ0FBQyxFQUFDO0FBQ0osQ0FBQyxDQUFDIiwiaWdub3JlTGlzdCI6W119